{"version":3,"sources":["WikEdDiff.js","components/comparision.js","components/articleTitle.js","components/task.js","actions/tasks.js","config.js","containers/Task.js","containers/ArticleList.js","components/articleList.js","components/TaskPage.js","actions/app.js","containers/TaskPage.js","components/mainPage.js","components/TypoRow.js","components/TypoManagement.js","components/Header.js","containers/Header.js","containers/TypoPage.js","components/App.js","containers/App.js","actions/auth.js","reducers/app.js","reducers/auth.js","reducers/tasks.js","reducers/index.js","store.js","index.js"],"names":["WikEdDiff","this","config","fullDiff","showBlockMoves","charDiff","repeatedDiff","recursiveDiff","recursionMax","unlinkBlocks","unlinkMax","blockMinLength","coloredBlocks","noUnicodeSymbols","stripTrailingNewline","debug","timer","unitTesting","regExpLetters","replace","regExpNewLines","regExpNewLinesAll","regExpBlanks","regExpFullStops","regExpNewParagraph","regExpExclamationMarks","regExpQuestionMarks","clipHeadingLeft","clipParagraphLeftMax","clipParagraphLeftMin","clipLineLeftMax","clipLineLeftMin","clipBlankLeftMax","clipBlankLeftMin","clipCharsLeft","clipHeadingRight","clipParagraphRightMax","clipParagraphRightMin","clipLineRightMax","clipLineRightMin","clipBlankRightMax","clipBlankRightMin","clipCharsRight","clipLinesRightMax","clipLinesLeftMax","clipSkipLines","clipSkipChars","cssMarkLeft","cssMarkRight","stylesheet","regExp","split","paragraph","RegExp","line","sentence","chunk","word","character","blankOnlyToken","slideStop","slideBorder","countWords","countChunks","blankBlock","clipLine","clipHeading","clipParagraph","clipBlank","clipTrimNewLinesLeft","clipTrimNewLinesRight","clipTrimBlanksLeft","clipTrimBlanksRight","refillChange","msg","wiked-diff-empty","wiked-diff-same","wiked-diff-ins","wiked-diff-del","wiked-diff-block-left","wiked-diff-block-right","wiked-diff-block-left-nounicode","wiked-diff-block-right-nounicode","wiked-diff-error","htmlCode","noChangeStart","noChangeEnd","containerStart","containerEnd","fragmentStart","fragmentEnd","separator","insertStart","insertStartBlank","insertEnd","deleteStart","deleteStartBlank","deleteEnd","blockStart","blockColoredStart","blockEnd","markLeft","markLeftColored","markRight","markRightColored","newline","tab","space","omittedChars","errorStart","errorEnd","refillError","blockHandler","event","element","type","undefined","window","number","id","block","document","getElementById","mark","onmouseover","onmouseout","wikEdDiffBlockHandler","onclick","className","container","spans","getElementsByTagName","spansLength","length","i","indexOf","corrElement","top","cursor","corrElementPos","node","offsetTop","offsetParent","pageYOffset","documentElement","scrollTop","pageY","clientY","getComputedStyle","parseInt","getPropertyValue","scroll","newText","oldText","symbols","token","hashTable","linked","bordersDown","bordersUp","blocks","maxWords","groups","sections","recursionTimer","error","fragments","html","init","addStyleSheet","GM_info","script","toString","addScript","diff","oldString","newString","time","substr","WikEdDiffText","text","htmlEscape","charAt","splitText","timeEnd","calculateDiff","splitRefine","slideGaps","splitRefineChars","words","enumerateTokens","detectBlocks","tokens","getDiffFragments","unitTests","clipDiffFragments","getDiffHtml","gaps","gap","first","j","newLink","link","oldLink","push","newFirst","newLast","newTokens","oldFirst","oldLast","oldTokens","charSplit","next","gapsLength","tokenFirst","tokenLast","shorterToken","longerToken","newToken","oldToken","left","right","ident","tokenLength","pos","newGapLength","oldGapLength","textLinked","regExpSlideBorder","regExpSlideStop","gapStart","gapFront","gapBack","prev","front","back","gapFrontBlankTest","test","frontStop","level","recurse","repeating","newStart","oldStart","up","recursionLevel","bordersUpNext","bordersDownNext","Object","prototype","hasOwnProperty","call","newCount","oldCount","hashToArray","symbolsLength","newTokenObj","oldTokenObj","unique","match","concat","wordsLength","bordersLength","iMatch","jMatch","last","repeat","dirUp","timeRecursionEnd","debugText","getSameBlocks","getSections","getGroups","setFixed","unlinkCount","unlinked","getDelBlocks","positionDelBlocks","getInsBlocks","setInsGroups","insertMarks","console","log","debugGroups","debugBlocks","splice","iStart","jStart","count","oldBlock","newBlock","oldNumber","newNumber","wordCount","chars","section","group","fixed","moved","sort","a","b","blocksLength","sectionStart","sectionEnd","oldMax","sectionOldMax","groupStart","groupEnd","movedFrom","color","sectionsLength","cache","maxChars","maxPath","pathObj","findMaxPath","path","maxPathLength","start","returnObj","slice","unshift","groupsLength","unlinkSingleBlock","blocksOld","blocksOldLength","delBlock","prevBlockNumber","prevBlock","nextBlockNumber","nextBlock","refBlock","sortBlocks","_this","pushBlock","blockInfo","assign","exec","index","substring","mid","markerType","end","comp","blockGroup","lookupSorted","movedGroup","movedOldNumber","markGroup","groupsSort","groupsSortLength","markType","markText","movedBlock","fragmentsLength","fragment","minRight","minLeft","textLength","regExpMatch","lines","lastIndex","headings","headingsEnd","paragraphs","rangeRight","rangeLeft","rangeRightType","rangeLeftType","rangeLeftMax","headingsLength","paragraphsLength","linesLength","rangeRightMin","startPos","lastPos","skipLines","textLeft","omittedLeft","textRight","omittedRight","debugFragments","version","htmlFragments","blank","title","htmlCustomize","markupBlanks","join","highlight","name","dump","debugShortenText","debugBorders","borders","max","label","Date","getTime","noLog","toFixed","timerEnd","timerLength","object","code","createElement","innerText","textContent","appendChild","css","style","styleSheet","cssText","createTextNode","deepCopy","source","target","key","parent","wordParse","matchLength","current","splitLength","module","exports","require","Comparision","orig","changed","wpDiff","react_default","dangerouslySetInnerHTML","__html","ArticleTitle","wiki","urlSafeWikititle","encodeURI","urlSafeTitle","href","rel","fontSize","Task","props","classCallCheck","possibleConstructorReturn","getPrototypeOf","saveArticle","result","isAuth","saveArticleData","textForSave","state","textAreaText","toast","warn","autoClose","origText","loading","status","articleEditing","savingProcess","handleChange","bind","assertThisInitialized","setAsIncorrect","toggleArticleEditing","toggleArticleEditing1","setTextareaText","goToNextArticle","articleParams","changedText","textToAdd","setState","setArticleData","prevProps","article","task","newValue","arguments","value","_this$props","_this$props$articlePa","lang","_this$state","role","disabled","onClick","rows","onChange","Component","setArticle","_ref","setArticleLoading","payload","setArticleSaving","setArticleListLoading","setTask","setArticlesToList","list","urlendpoint","handleArticleSet","cb","dispatch","getState","currTask","tasks","taskId","articleTitle","currentArticle","app","url","fetch","then","response","json","_ref2","message","handleArticleSave","_state$tasks$currentA","_state$tasks$currentA2","params","dataToSend","job","wikitext","method","headers","Content-Type","body","JSON","stringify","data","info","catch","connect","auth","articleLoading","setChangedText","hadleTextChange","articles","articleId","selectArticle","map","TaskPage","setup","containers_ArticleList","containers_Task","setWikiLanguage","language","setArticleList","langProp","withRouter","articlesLoading","ownProps","setInitialAppData","currLanguage","description","wikis","setWikiLang","setInitialState","useEffect","wikiLang","Fragment","location","hasArticles","url_id","TypoRow","setupDate","checked","[object Object]","objectSpread","handleTestChange","tests","toConsumableArray","item","addNewTest","expected","actual","saveData","_this$state$data","search_for","trim","success","dataToSendToParent","isNew","rowID","row","onDataUpdate","width","for","replace_with","comment","active","regex","case","whole","dumpsearch","minor","cleanValue","typoObject","typoObject2","keys","reduce","accumulator","TypoManagement","addNew","page","numberOfRows","expanded","Math","round","handleDataUpdate","typoData","_this2","_this$state2","react_table_es","columns","Header","accessor","defaultPageSize","SubComponent","components_TypoRow","_original","onPageChange","onExpandedChange","username","taskList","filter","NavDropdown","Item","nav_title","wikiList","Navbar","expand","bg","variant","Brand","Toggle","aria-controls","Collapse","Nav","OverlayTrigger","placement","delay","show","overlay","Tooltip","Link","NotFound","pathname","App","initialLoad","react_router_dom","containers_Header","react_router","exact","component","TypoPage","MainPage","react_toastify","position","hideProgressBar","newestOnTop","closeOnClick","rtl","pauseOnVisibilityChange","draggable","pauseOnHover","setWikiLanguages","defaultState","action","errorMessage","newState","currentID","_action$payload","articleToRemove","newStatus","combineReducers","loggerMiddleware","createLogger","store","createStore","rootReducer","applyMiddleware","thunkMiddleware","rootElement","ReactDOM","render","es","containers_App"],"mappings":"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","file":"static/js/main.5512f18a.chunk.js","sourcesContent":["/* eslint-disable */\r\n// <syntaxhighlight lang=\"JavaScript\">\r\n\r\n// ==UserScript==\r\n// @name        wikEd diff\r\n// @version     1.2.4\r\n// @date        October 23, 2014\r\n// @description improved word-based diff library with block move detection\r\n// @homepage    https://en.wikipedia.org/wiki/User:Cacycle/diff\r\n// @source      https://en.wikipedia.org/wiki/User:Cacycle/diff.js\r\n// @author      Cacycle (https://en.wikipedia.org/wiki/User:Cacycle)\r\n// @license     released into the public domain\r\n// ==/UserScript==\r\n\r\n/**\r\n * wikEd diff: inline-style difference engine with block move support\r\n *\r\n * Improved JavaScript diff library that returns html/css-formatted new text version with\r\n * highlighted deletions, insertions, and block moves. It is compatible with all browsers and is\r\n * not dependent on external libraries.\r\n *\r\n * WikEdDiff.php and the JavaScript library wikEd diff are synced one-to-one ports. Changes and\r\n * fixes are to be applied to both versions.\r\n *\r\n * JavaScript library (mirror): https://en.wikipedia.org/wiki/User:Cacycle/diff\r\n * JavaScript online tool: http://cacycle.altervista.org/wikEd-diff-tool.html\r\n * MediaWiki extension: https://www.mediawiki.org/wiki/Extension:wikEdDiff\r\n *\r\n * This difference engine applies a word-based algorithm that uses unique words as anchor points\r\n * to identify matching text and moved blocks (Paul Heckel: A technique for isolating differences\r\n * between files. Communications of the ACM 21(4):264 (1978)).\r\n *\r\n * Additional features:\r\n *\r\n * - Visual inline style, changes are shown in a single output text\r\n * - Block move detection and highlighting\r\n * - Resolution down to characters level\r\n * - Unicode and multilingual support\r\n * - Stepwise split (paragraphs, lines, sentences, words, characters)\r\n * - Recursive diff\r\n * - Optimized code for resolving unmatched sequences\r\n * - Minimization of length of moved blocks\r\n * - Alignment of ambiguous unmatched sequences to next line break or word border\r\n * - Clipping of unchanged irrelevant parts from the output (optional)\r\n * - Fully customizable\r\n * - Text split optimized for MediaWiki source texts\r\n * - Well commented and documented code\r\n *\r\n * Datastructures (abbreviations from publication):\r\n *\r\n * class WikEdDiffText:  diff text object (new or old version)\r\n *   .text                 text of version\r\n *   .words[]              word count table\r\n *   .first                index of first token in tokens list\r\n *   .last                 index of last token in tokens list\r\n *\r\n *   .tokens[]:          token list for new or old string (doubly-linked list) (N and O)\r\n *     .prev               previous list item\r\n *     .next               next list item\r\n *     .token              token string\r\n *     .link               index of corresponding token in new or old text (OA and NA)\r\n *     .number             list enumeration number\r\n *     .unique             token is unique word in text\r\n *\r\n * class WikEdDiff:      diff object\r\n *   .config[]:            configuration settings, see top of code for customization options\r\n *      .regExp[]:            all regular expressions\r\n *          .split             regular expressions used for splitting text into tokens\r\n *      .htmlCode            HTML code fragments used for creating the output\r\n *      .msg                 output messages\r\n *   .newText              new text\r\n *   .oldText              old text\r\n *   .maxWords             word count of longest linked block\r\n *   .html                 diff html\r\n *   .error                flag: result has not passed unit tests\r\n *   .bordersDown[]        linked region borders downwards, [new index, old index]\r\n *   .bordersUp[]          linked region borders upwards, [new index, old index]\r\n *   .symbols:             symbols table for whole text at all refinement levels\r\n *     .token[]              hash table of parsed tokens for passes 1 - 3, points to symbol[i]\r\n *     .symbol[]:            array of objects that hold token counters and pointers:\r\n *       .newCount             new text token counter (NC)\r\n *       .oldCount             old text token counter (OC)\r\n *       .newToken             token index in text.newText.tokens\r\n *       .oldToken             token index in text.oldText.tokens\r\n *     .linked               flag: at least one unique token pair has been linked\r\n *\r\n *   .blocks[]:            array, block data (consecutive text tokens) in new text order\r\n *     .oldBlock             number of block in old text order\r\n *     .newBlock             number of block in new text order\r\n *     .oldNumber            old text token number of first token\r\n *     .newNumber            new text token number of first token\r\n *     .oldStart             old text token index of first token\r\n *     .count                number of tokens\r\n *     .unique               contains unique linked token\r\n *     .words                word count\r\n *     .chars                char length\r\n *     .type                 '=', '-', '+', '|' (same, deletion, insertion, mark)\r\n *     .section              section number\r\n *     .group                group number of block\r\n *     .fixed                belongs to a fixed (not moved) group\r\n *     .moved                moved block group number corresponding with mark block\r\n *     .text                 text of block tokens\r\n *\r\n *   .sections[]:          array, block sections with no block move crosses outside a section\r\n *     .blockStart           first block in section\r\n *     .blockEnd             last block in section\r\n *   .groups[]:            array, section blocks that are consecutive in old text order\r\n *     .oldNumber            first block oldNumber\r\n *     .blockStart           first block index\r\n *     .blockEnd             last block index\r\n *     .unique               contains unique linked token\r\n *     .maxWords             word count of longest linked block\r\n *     .words                word count\r\n *     .chars                char count\r\n *     .fixed                not moved from original position\r\n *     .movedFrom            group position this group has been moved from\r\n *     .color                color number of moved group\r\n *\r\n *   .fragments[]:         diff fragment list ready for markup, abstraction layer for customization\r\n *     .text                 block or mark text\r\n *     .color                moved block or mark color number\r\n *     .type                 '=', '-', '+'   same, deletion, insertion\r\n *                           '<', '>'        mark left, mark right\r\n *                           '(<', '(>', ')' block start and end\r\n *                           '~', ' ~', '~ ' omission indicators\r\n *                           '[', ']', ','   fragment start and end, fragment separator\r\n *                           '{', '}'        container start and end\r\n *                           'r'             reFill change\r\n *\r\n */\r\n\r\n// JSHint options\r\n/* jshint -W004, -W100, newcap: true, browser: true, jquery: true, sub: true, bitwise: true,\r\n\tcurly: true, evil: true, forin: true, freeze: true, globalstrict: true, immed: true,\r\n\tlatedef: true, loopfunc: true, quotmark: single, strict: true, undef: true */\r\n/* global console */\r\n\r\n// Turn on ECMAScript 5 strict mode\r\n'use strict';\r\n\r\n/** Define global objects. */\r\nvar wikEdDiffConfig;\r\nvar WED;\r\n\r\n\r\n/**\r\n * wikEd diff main class.\r\n *\r\n * @class WikEdDiff\r\n */\r\nvar WikEdDiff = function () {\r\n\r\n\t/** @var array config Configuration and customization settings. */\r\n\tthis.config = {\r\n\r\n\t\t/** Core diff settings (with default values). */\r\n\r\n\t\t/**\r\n\t\t * @var bool config.fullDiff\r\n\t\t *   Show complete un-clipped diff text (false)\r\n\t\t */\r\n\t\t'fullDiff': false,\r\n\r\n\t\t/**\r\n\t\t * @var bool config.showBlockMoves\r\n\t\t *   Enable block move layout with highlighted blocks and marks at the original positions (true)\r\n\t\t */\r\n\t\t'showBlockMoves': true,\r\n\r\n\t\t/**\r\n\t\t * @var bool config.charDiff\r\n\t\t *   Enable character-refined diff (true)\r\n\t\t */\r\n\t\t'charDiff': true,\r\n\r\n\t\t/**\r\n\t\t * @var bool config.repeatedDiff\r\n\t\t *   Enable repeated diff to resolve problematic sequences (true)\r\n\t\t */\r\n\t\t'repeatedDiff': true,\r\n\r\n\t\t/**\r\n\t\t * @var bool config.recursiveDiff\r\n\t\t *   Enable recursive diff to resolve problematic sequences (true)\r\n\t\t */\r\n\t\t'recursiveDiff': true,\r\n\r\n\t\t/**\r\n\t\t * @var int config.recursionMax\r\n\t\t *   Maximum recursion depth (10)\r\n\t\t */\r\n\t\t'recursionMax': 10,\r\n\r\n\t\t/**\r\n\t\t * @var bool config.unlinkBlocks\r\n\t\t *   Reject blocks if they are too short and their words are not unique,\r\n\t\t *   prevents fragmentated diffs for very different versions (true)\r\n\t\t */\r\n\t\t'unlinkBlocks': true,\r\n\r\n\t\t/**\r\n\t\t * @var int config.unlinkMax\r\n\t\t *   Maximum number of rejection cycles (5)\r\n\t\t */\r\n\t\t'unlinkMax': 5,\r\n\r\n\t\t/**\r\n\t\t * @var int config.blockMinLength\r\n\t\t *   Reject blocks if shorter than this number of real words (3)\r\n\t\t */\r\n\t\t'blockMinLength': 3,\r\n\r\n\t\t/**\r\n\t\t * @var bool config.coloredBlocks\r\n\t\t *   Display blocks in differing colors (rainbow color scheme) (false)\r\n\t\t */\r\n\t\t'coloredBlocks': false,\r\n\r\n\t\t/**\r\n\t\t * @var bool config.coloredBlocks\r\n\t\t *   Do not use UniCode block move marks (legacy browsers) (false)\r\n\t\t */\r\n\t\t'noUnicodeSymbols': false,\r\n\r\n\t\t/**\r\n\t\t * @var bool config.stripTrailingNewline\r\n\t\t *   Strip trailing newline off of texts (true in .js, false in .php)\r\n\t\t */\r\n\t\t'stripTrailingNewline': true,\r\n\r\n\t\t/**\r\n\t\t * @var bool config.debug\r\n\t\t *   Show debug infos and stats (block, group, and fragment data) in debug console (false)\r\n\t\t */\r\n\t\t'debug': false,\r\n\r\n\t\t/**\r\n\t\t * @var bool config.timer\r\n\t\t *   Show timing results in debug console (false)\r\n\t\t */\r\n\t\t'timer': false,\r\n\r\n\t\t/**\r\n\t\t * @var bool config.unitTesting\r\n\t\t *   Run unit tests to prove correct working, display results in debug console (false)\r\n\t\t */\r\n\t\t'unitTesting': false,\r\n\r\n\t\t/** RegExp character classes. */\r\n\r\n\t\t// UniCode letter support for regexps\r\n\t\t// From http://xregexp.com/addons/unicode/unicode-base.js v1.0.0\r\n\t\t'regExpLetters':\r\n\t\t\t'a-zA-Z0-9' + (\r\n\t\t\t\t'00AA00B500BA00C0-00D600D8-00F600F8-02C102C6-02D102E0-02E402EC02EE0370-037403760377037A-' +\r\n\t\t\t\t'037D03860388-038A038C038E-03A103A3-03F503F7-0481048A-05270531-055605590561-058705D0-05EA' +\r\n\t\t\t\t'05F0-05F20620-064A066E066F0671-06D306D506E506E606EE06EF06FA-06FC06FF07100712-072F074D-' +\r\n\t\t\t\t'07A507B107CA-07EA07F407F507FA0800-0815081A082408280840-085808A008A2-08AC0904-0939093D' +\r\n\t\t\t\t'09500958-09610971-09770979-097F0985-098C098F09900993-09A809AA-09B009B209B6-09B909BD09CE' +\r\n\t\t\t\t'09DC09DD09DF-09E109F009F10A05-0A0A0A0F0A100A13-0A280A2A-0A300A320A330A350A360A380A39' +\r\n\t\t\t\t'0A59-0A5C0A5E0A72-0A740A85-0A8D0A8F-0A910A93-0AA80AAA-0AB00AB20AB30AB5-0AB90ABD0AD00AE0' +\r\n\t\t\t\t'0AE10B05-0B0C0B0F0B100B13-0B280B2A-0B300B320B330B35-0B390B3D0B5C0B5D0B5F-0B610B710B83' +\r\n\t\t\t\t'0B85-0B8A0B8E-0B900B92-0B950B990B9A0B9C0B9E0B9F0BA30BA40BA8-0BAA0BAE-0BB90BD00C05-0C0C' +\r\n\t\t\t\t'0C0E-0C100C12-0C280C2A-0C330C35-0C390C3D0C580C590C600C610C85-0C8C0C8E-0C900C92-0CA80CAA-' +\r\n\t\t\t\t'0CB30CB5-0CB90CBD0CDE0CE00CE10CF10CF20D05-0D0C0D0E-0D100D12-0D3A0D3D0D4E0D600D610D7A-' +\r\n\t\t\t\t'0D7F0D85-0D960D9A-0DB10DB3-0DBB0DBD0DC0-0DC60E01-0E300E320E330E40-0E460E810E820E840E87' +\r\n\t\t\t\t'0E880E8A0E8D0E94-0E970E99-0E9F0EA1-0EA30EA50EA70EAA0EAB0EAD-0EB00EB20EB30EBD0EC0-0EC4' +\r\n\t\t\t\t'0EC60EDC-0EDF0F000F40-0F470F49-0F6C0F88-0F8C1000-102A103F1050-1055105A-105D106110651066' +\r\n\t\t\t\t'106E-10701075-1081108E10A0-10C510C710CD10D0-10FA10FC-1248124A-124D1250-12561258125A-125D' +\r\n\t\t\t\t'1260-1288128A-128D1290-12B012B2-12B512B8-12BE12C012C2-12C512C8-12D612D8-13101312-1315' +\r\n\t\t\t\t'1318-135A1380-138F13A0-13F41401-166C166F-167F1681-169A16A0-16EA1700-170C170E-17111720-' +\r\n\t\t\t\t'17311740-17511760-176C176E-17701780-17B317D717DC1820-18771880-18A818AA18B0-18F51900-191C' +\r\n\t\t\t\t'1950-196D1970-19741980-19AB19C1-19C71A00-1A161A20-1A541AA71B05-1B331B45-1B4B1B83-1BA0' +\r\n\t\t\t\t'1BAE1BAF1BBA-1BE51C00-1C231C4D-1C4F1C5A-1C7D1CE9-1CEC1CEE-1CF11CF51CF61D00-1DBF1E00-1F15' +\r\n\t\t\t\t'1F18-1F1D1F20-1F451F48-1F4D1F50-1F571F591F5B1F5D1F5F-1F7D1F80-1FB41FB6-1FBC1FBE1FC2-1FC4' +\r\n\t\t\t\t'1FC6-1FCC1FD0-1FD31FD6-1FDB1FE0-1FEC1FF2-1FF41FF6-1FFC2071207F2090-209C21022107210A-2113' +\r\n\t\t\t\t'21152119-211D212421262128212A-212D212F-2139213C-213F2145-2149214E218321842C00-2C2E2C30-' +\r\n\t\t\t\t'2C5E2C60-2CE42CEB-2CEE2CF22CF32D00-2D252D272D2D2D30-2D672D6F2D80-2D962DA0-2DA62DA8-2DAE' +\r\n\t\t\t\t'2DB0-2DB62DB8-2DBE2DC0-2DC62DC8-2DCE2DD0-2DD62DD8-2DDE2E2F300530063031-3035303B303C3041-' +\r\n\t\t\t\t'3096309D-309F30A1-30FA30FC-30FF3105-312D3131-318E31A0-31BA31F0-31FF3400-4DB54E00-9FCC' +\r\n\t\t\t\t'A000-A48CA4D0-A4FDA500-A60CA610-A61FA62AA62BA640-A66EA67F-A697A6A0-A6E5A717-A71FA722-' +\r\n\t\t\t\t'A788A78B-A78EA790-A793A7A0-A7AAA7F8-A801A803-A805A807-A80AA80C-A822A840-A873A882-A8B3' +\r\n\t\t\t\t'A8F2-A8F7A8FBA90A-A925A930-A946A960-A97CA984-A9B2A9CFAA00-AA28AA40-AA42AA44-AA4BAA60-' +\r\n\t\t\t\t'AA76AA7AAA80-AAAFAAB1AAB5AAB6AAB9-AABDAAC0AAC2AADB-AADDAAE0-AAEAAAF2-AAF4AB01-AB06AB09-' +\r\n\t\t\t\t'AB0EAB11-AB16AB20-AB26AB28-AB2EABC0-ABE2AC00-D7A3D7B0-D7C6D7CB-D7FBF900-FA6DFA70-FAD9' +\r\n\t\t\t\t'FB00-FB06FB13-FB17FB1DFB1F-FB28FB2A-FB36FB38-FB3CFB3EFB40FB41FB43FB44FB46-FBB1FBD3-FD3D' +\r\n\t\t\t\t'FD50-FD8FFD92-FDC7FDF0-FDFBFE70-FE74FE76-FEFCFF21-FF3AFF41-FF5AFF66-FFBEFFC2-FFC7FFCA-' +\r\n\t\t\t\t'FFCFFFD2-FFD7FFDA-FFDC'\r\n\t\t\t).replace( /(\\w{4})/g, '\\\\u$1' ),\r\n\r\n\t\t// New line characters without and with \\n and \\r\r\n\t\t'regExpNewLines': '\\\\u0085\\\\u2028',\r\n\t\t'regExpNewLinesAll': '\\\\n\\\\r\\\\u0085\\\\u2028',\r\n\r\n\t\t// Breaking white space characters without \\n, \\r, and \\f\r\n\t\t'regExpBlanks': ' \\\\t\\\\x0b\\\\u2000-\\\\u200b\\\\u202f\\\\u205f\\\\u3000',\r\n\r\n\t\t// Full stops without '.'\r\n\t\t'regExpFullStops':\r\n\t\t\t'\\\\u0589\\\\u06D4\\\\u0701\\\\u0702\\\\u0964\\\\u0DF4\\\\u1362\\\\u166E\\\\u1803\\\\u1809' +\r\n\t\t\t'\\\\u2CF9\\\\u2CFE\\\\u2E3C\\\\u3002\\\\uA4FF\\\\uA60E\\\\uA6F3\\\\uFE52\\\\uFF0E\\\\uFF61',\r\n\r\n\t\t// New paragraph characters without \\n and \\r\r\n\t\t'regExpNewParagraph': '\\\\f\\\\u2029',\r\n\r\n\t\t// Exclamation marks without '!'\r\n\t\t'regExpExclamationMarks':\r\n\t\t\t'\\\\u01C3\\\\u01C3\\\\u01C3\\\\u055C\\\\u055C\\\\u07F9\\\\u1944\\\\u1944' +\r\n\t\t\t'\\\\u203C\\\\u203C\\\\u2048\\\\u2048\\\\uFE15\\\\uFE57\\\\uFF01',\r\n\r\n\t\t// Question marks without '?'\r\n\t\t'regExpQuestionMarks':\r\n\t\t\t'\\\\u037E\\\\u055E\\\\u061F\\\\u1367\\\\u1945\\\\u2047\\\\u2049' +\r\n\t\t\t'\\\\u2CFA\\\\u2CFB\\\\u2E2E\\\\uA60F\\\\uA6F7\\\\uFE56\\\\uFF1F',\r\n\r\n\t\t/** Clip settings. */\r\n\r\n\t\t// Find clip position: characters from right\r\n\t\t'clipHeadingLeft':      1500,\r\n\t\t'clipParagraphLeftMax': 1500,\r\n\t\t'clipParagraphLeftMin':  500,\r\n\t\t'clipLineLeftMax':      1000,\r\n\t\t'clipLineLeftMin':       500,\r\n\t\t'clipBlankLeftMax':     1000,\r\n\t\t'clipBlankLeftMin':      500,\r\n\t\t'clipCharsLeft':         500,\r\n\r\n\t\t// Find clip position: characters from right\r\n\t\t'clipHeadingRight':      1500,\r\n\t\t'clipParagraphRightMax': 1500,\r\n\t\t'clipParagraphRightMin':  500,\r\n\t\t'clipLineRightMax':      1000,\r\n\t\t'clipLineRightMin':       500,\r\n\t\t'clipBlankRightMax':     1000,\r\n\t\t'clipBlankRightMin':      500,\r\n\t\t'clipCharsRight':         500,\r\n\r\n\t\t// Maximum number of lines to search for clip position\r\n\t\t'clipLinesRightMax': 10,\r\n\t\t'clipLinesLeftMax': 10,\r\n\r\n\t\t// Skip clipping if ranges are too close\r\n\t\t'clipSkipLines': 5,\r\n\t\t'clipSkipChars': 1000,\r\n\r\n\t\t// Css stylesheet\r\n\t\t'cssMarkLeft': '◀',\r\n\t\t'cssMarkRight': '▶',\r\n\t\t'stylesheet':\r\n\r\n\t\t\t// Insert\r\n\t\t\t'.wikEdDiffInsert {' +\r\n\t\t\t'font-weight: bold; background-color: #bbddff; ' +\r\n\t\t\t'color: #222; border-radius: 0.25em; padding: 0.2em 1px; ' +\r\n\t\t\t'} ' +\r\n\t\t\t'.wikEdDiffInsertBlank { background-color: #66bbff; } ' +\r\n\t\t\t'.wikEdDiffFragment:hover .wikEdDiffInsertBlank { background-color: #bbddff; } ' +\r\n\r\n\t\t\t// Delete\r\n\t\t\t'.wikEdDiffDelete {' +\r\n\t\t\t'font-weight: bold; background-color: #ffe49c; ' +\r\n\t\t\t'color: #222; border-radius: 0.25em; padding: 0.2em 1px; ' +\r\n\t\t\t'} ' +\r\n\t\t\t'.wikEdDiffDeleteBlank { background-color: #ffd064; } ' +\r\n\t\t\t'.wikEdDiffFragment:hover .wikEdDiffDeleteBlank { background-color: #ffe49c; } ' +\r\n\r\n\t\t\t// Block\r\n\t\t\t'.wikEdDiffBlock {' +\r\n\t\t\t'font-weight: bold; background-color: #e8e8e8; ' +\r\n\t\t\t'border-radius: 0.25em; padding: 0.2em 1px; margin: 0 1px; ' +\r\n\t\t\t'} ' +\r\n\t\t\t'.wikEdDiffBlock { } ' +\r\n\t\t\t'.wikEdDiffBlock0 { background-color: #ffff80; } ' +\r\n\t\t\t'.wikEdDiffBlock1 { background-color: #d0ff80; } ' +\r\n\t\t\t'.wikEdDiffBlock2 { background-color: #ffd8f0; } ' +\r\n\t\t\t'.wikEdDiffBlock3 { background-color: #c0ffff; } ' +\r\n\t\t\t'.wikEdDiffBlock4 { background-color: #fff888; } ' +\r\n\t\t\t'.wikEdDiffBlock5 { background-color: #bbccff; } ' +\r\n\t\t\t'.wikEdDiffBlock6 { background-color: #e8c8ff; } ' +\r\n\t\t\t'.wikEdDiffBlock7 { background-color: #ffbbbb; } ' +\r\n\t\t\t'.wikEdDiffBlock8 { background-color: #a0e8a0; } ' +\r\n\t\t\t'.wikEdDiffBlockHighlight {' +\r\n\t\t\t'background-color: #777; color: #fff; ' +\r\n\t\t\t'border: solid #777; border-width: 1px 0; ' +\r\n\t\t\t'} ' +\r\n\r\n\t\t\t// Mark\r\n\t\t\t'.wikEdDiffMarkLeft, .wikEdDiffMarkRight {' +\r\n\t\t\t'font-weight: bold; background-color: #ffe49c; ' +\r\n\t\t\t'color: #666; border-radius: 0.25em; padding: 0.2em; margin: 0 1px; ' +\r\n\t\t\t'} ' +\r\n\t\t\t'.wikEdDiffMarkLeft:before { content: \"{cssMarkLeft}\"; } ' +\r\n\t\t\t'.wikEdDiffMarkRight:before { content: \"{cssMarkRight}\"; } ' +\r\n\t\t\t'.wikEdDiffMarkLeft.wikEdDiffNoUnicode:before { content: \"<\"; } ' +\r\n\t\t\t'.wikEdDiffMarkRight.wikEdDiffNoUnicode:before { content: \">\"; } ' +\r\n\t\t\t'.wikEdDiffMark { background-color: #e8e8e8; color: #666; } ' +\r\n\t\t\t'.wikEdDiffMark0 { background-color: #ffff60; } ' +\r\n\t\t\t'.wikEdDiffMark1 { background-color: #c8f880; } ' +\r\n\t\t\t'.wikEdDiffMark2 { background-color: #ffd0f0; } ' +\r\n\t\t\t'.wikEdDiffMark3 { background-color: #a0ffff; } ' +\r\n\t\t\t'.wikEdDiffMark4 { background-color: #fff860; } ' +\r\n\t\t\t'.wikEdDiffMark5 { background-color: #b0c0ff; } ' +\r\n\t\t\t'.wikEdDiffMark6 { background-color: #e0c0ff; } ' +\r\n\t\t\t'.wikEdDiffMark7 { background-color: #ffa8a8; } ' +\r\n\t\t\t'.wikEdDiffMark8 { background-color: #98e898; } ' +\r\n\t\t\t'.wikEdDiffMarkHighlight { background-color: #777; color: #fff; } ' +\r\n\r\n\t\t\t// Wrappers\r\n\t\t\t'.wikEdDiffContainer { } ' +\r\n\t\t\t'.wikEdDiffFragment {' +\r\n\t\t\t'white-space: pre-wrap; background: #fff; border: #bbb solid; ' +\r\n\t\t\t'border-width: 1px 1px 1px 0.5em; border-radius: 0.5em; font-family: sans-serif; ' +\r\n\t\t\t'font-size: 88%; line-height: 1.6; box-shadow: 2px 2px 2px #ddd; padding: 1em; margin: 0; ' +\r\n\t\t\t'} ' +\r\n\t\t\t'.wikEdDiffNoChange { background: #f0f0f0; border: 1px #bbb solid; border-radius: 0.5em; ' +\r\n\t\t\t'line-height: 1.6; box-shadow: 2px 2px 2px #ddd; padding: 0.5em; margin: 1em 0; ' +\r\n\t\t\t'text-align: center; ' +\r\n\t\t\t'} ' +\r\n\t\t\t'.wikEdDiffSeparator { margin-bottom: 1em; } ' +\r\n\t\t\t'.wikEdDiffOmittedChars { } ' +\r\n\r\n\t\t\t// Newline\r\n\t\t\t'.wikEdDiffNewline:before { content: \"¶\"; color: transparent; } ' +\r\n\t\t\t'.wikEdDiffBlock:hover .wikEdDiffNewline:before { color: #aaa; } ' +\r\n\t\t\t'.wikEdDiffBlockHighlight .wikEdDiffNewline:before { color: transparent; } ' +\r\n\t\t\t'.wikEdDiffBlockHighlight:hover .wikEdDiffNewline:before { color: #ccc; } ' +\r\n\t\t\t'.wikEdDiffBlockHighlight:hover .wikEdDiffInsert .wikEdDiffNewline:before, ' +\r\n\t\t\t'.wikEdDiffInsert:hover .wikEdDiffNewline:before' +\r\n\t\t\t'{ color: #999; } ' +\r\n\t\t\t'.wikEdDiffBlockHighlight:hover .wikEdDiffDelete .wikEdDiffNewline:before, ' +\r\n\t\t\t'.wikEdDiffDelete:hover .wikEdDiffNewline:before' +\r\n\t\t\t'{ color: #aaa; } ' +\r\n\r\n\t\t\t// Tab\r\n\t\t\t'.wikEdDiffTab { position: relative; } ' +\r\n\t\t\t'.wikEdDiffTabSymbol { position: absolute; top: -0.2em; } ' +\r\n\t\t\t'.wikEdDiffTabSymbol:before { content: \"→\"; font-size: smaller; color: #ccc; } ' +\r\n\t\t\t'.wikEdDiffBlock .wikEdDiffTabSymbol:before { color: #aaa; } ' +\r\n\t\t\t'.wikEdDiffBlockHighlight .wikEdDiffTabSymbol:before { color: #aaa; } ' +\r\n\t\t\t'.wikEdDiffInsert .wikEdDiffTabSymbol:before { color: #aaa; } ' +\r\n\t\t\t'.wikEdDiffDelete .wikEdDiffTabSymbol:before { color: #bbb; } ' +\r\n\r\n\t\t\t// Space\r\n\t\t\t'.wikEdDiffSpace { position: relative; } ' +\r\n\t\t\t'.wikEdDiffSpaceSymbol { position: absolute; top: -0.2em; left: -0.05em; } ' +\r\n\t\t\t'.wikEdDiffSpaceSymbol:before { content: \"·\"; color: transparent; } ' +\r\n\t\t\t'.wikEdDiffBlock:hover .wikEdDiffSpaceSymbol:before { color: #999; } ' +\r\n\t\t\t'.wikEdDiffBlockHighlight .wikEdDiffSpaceSymbol:before { color: transparent; } ' +\r\n\t\t\t'.wikEdDiffBlockHighlight:hover .wikEdDiffSpaceSymbol:before { color: #ddd; } ' +\r\n\t\t\t'.wikEdDiffBlockHighlight:hover .wikEdDiffInsert .wikEdDiffSpaceSymbol:before,' +\r\n\t\t\t'.wikEdDiffInsert:hover .wikEdDiffSpaceSymbol:before ' +\r\n\t\t\t'{ color: #888; } ' +\r\n\t\t\t'.wikEdDiffBlockHighlight:hover .wikEdDiffDelete .wikEdDiffSpaceSymbol:before,' +\r\n\t\t\t'.wikEdDiffDelete:hover .wikEdDiffSpaceSymbol:before ' +\r\n\t\t\t'{ color: #999; } ' +\r\n\r\n\t\t\t// Error\r\n\t\t\t'.wikEdDiffError .wikEdDiffFragment,' +\r\n\t\t\t'.wikEdDiffError .wikEdDiffNoChange' +\r\n\t\t\t'{ background: #faa; } ' +\r\n\r\n\t\t\t// reFill Change\r\n\t\t\t'.wikEdRefillChange {' +\r\n\t\t\t'font-weight: bold; background-color: #00bb00; cursor: pointer; ' +\r\n\t\t\t'color: #eee; border-radius: 0.25em; padding: 0.2em 1px; ' +\r\n\t\t\t'}' +\r\n\r\n\t\t\t'.wikEdRefillError {' +\r\n\t\t\t'font-weight: bold; background-color: #bb0000; cursor: pointer; ' +\r\n\t\t\t'color: #eee; border-radius: 0.25em; padding: 0.2em 1px; ' +\r\n\t\t\t'}'\r\n\t};\r\n\r\n\t/** Add regular expressions to configuration settings. */\r\n\r\n\tthis.config.regExp = {\r\n\r\n\t\t// RegExps for splitting text\r\n\t\t'split': {\r\n\r\n\t\t\t// Split into paragraphs, after double newlines\r\n\t\t\t'paragraph': new RegExp(\r\n\t\t\t\t'(\\\\r\\\\n|\\\\n|\\\\r){2,}|[' +\r\n\t\t\t\tthis.config.regExpNewParagraph +\r\n\t\t\t\t']',\r\n\t\t\t\t'g'\r\n\t\t\t),\r\n\r\n\t\t\t// Split into lines\r\n\t\t\t'line': new RegExp(\r\n\t\t\t\t'\\\\r\\\\n|\\\\n|\\\\r|[' +\r\n\t\t\t\tthis.config.regExpNewLinesAll +\r\n\t\t\t\t']',\r\n\t\t\t\t'g'\r\n\t\t\t),\r\n\r\n\t\t\t// Split into sentences /[^ ].*?[.!?:;]+(?= |$)/\r\n\t\t\t'sentence': new RegExp(\r\n\t\t\t\t'[^' +\r\n\t\t\t\tthis.config.regExpBlanks +\r\n\t\t\t\t'].*?[.!?:;' +\r\n\t\t\t\tthis.config.regExpFullStops +\r\n\t\t\t\tthis.config.regExpExclamationMarks +\r\n\t\t\t\tthis.config.regExpQuestionMarks +\r\n\t\t\t\t']+(?=[' +\r\n\t\t\t\tthis.config.regExpBlanks +\r\n\t\t\t\t']|$)',\r\n\t\t\t\t'g'\r\n\t\t\t),\r\n\r\n\t\t\t// Split into inline chunks\r\n\t\t\t'chunk': new RegExp(\r\n\t\t\t\t'\\\\[\\\\[[^\\\\[\\\\]\\\\n]+\\\\]\\\\]|' +       // [[wiki link]]\r\n\t\t\t\t'\\\\{\\\\{[^\\\\{\\\\}\\\\n]+\\\\}\\\\}|' +       // {{template}}\r\n\t\t\t\t'\\\\[[^\\\\[\\\\]\\\\n]+\\\\]|' +             // [ext. link]\r\n\t\t\t\t'<\\\\/?[^<>\\\\[\\\\]\\\\{\\\\}\\\\n]+>|' +     // <html>\r\n\t\t\t\t'\\\\[\\\\[[^\\\\[\\\\]\\\\|\\\\n]+\\\\]\\\\]\\\\||' + // [[wiki link|\r\n\t\t\t\t'\\\\{\\\\{[^\\\\{\\\\}\\\\|\\\\n]+\\\\||' +       // {{template|\r\n\t\t\t\t'\\\\b((https?:|)\\\\/\\\\/)[^\\\\x00-\\\\x20\\\\s\"\\\\[\\\\]\\\\x7f]+|' + // link\r\n\t\t\t\t'RFL\\\\w\\\\d+LFR', // reFill change\r\n\t\t\t\t'g'\r\n\t\t\t),\r\n\r\n\t\t\t// Split into words, multi-char markup, and chars\r\n\t\t\t// regExpLetters speed-up: \\\\w+\r\n\t\t\t'word': new RegExp(\r\n\t\t\t\t'(\\\\w+|[_' +\r\n\t\t\t\tthis.config.regExpLetters +\r\n\t\t\t\t'])+([\\'’][_' +\r\n\t\t\t\tthis.config.regExpLetters +\r\n\t\t\t\t']*)*|\\\\[\\\\[|\\\\]\\\\]|\\\\{\\\\{|\\\\}\\\\}|&\\\\w+;|\\'\\'\\'|\\'\\'|==+|\\\\{\\\\||\\\\|\\\\}|\\\\|-|.',\r\n\t\t\t\t'g'\r\n\t\t\t),\r\n\r\n\t\t\t// Split into chars\r\n\t\t\t'character': /./g\r\n\t\t},\r\n\r\n\t\t// RegExp to detect blank tokens\r\n\t\t'blankOnlyToken': new RegExp(\r\n\t\t\t'[^' +\r\n\t\t\tthis.config.regExpBlanks +\r\n\t\t\tthis.config.regExpNewLinesAll +\r\n\t\t\tthis.config.regExpNewParagraph +\r\n\t\t\t']'\r\n\t\t),\r\n\r\n\t\t// RegExps for sliding gaps: newlines and space/word breaks\r\n\t\t'slideStop': new RegExp(\r\n\t\t\t'[' +\r\n\t\t\tthis.config.regExpNewLinesAll +\r\n\t\t\tthis.config.regExpNewParagraph +\r\n\t\t\t']$'\r\n\t\t),\r\n\t\t'slideBorder': new RegExp(\r\n\t\t\t'[' +\r\n\t\t\tthis.config.regExpBlanks +\r\n\t\t\t']$'\r\n\t\t),\r\n\r\n\t\t// RegExps for counting words\r\n\t\t'countWords': new RegExp(\r\n\t\t\t'(\\\\w+|[_' +\r\n\t\t\tthis.config.regExpLetters +\r\n\t\t\t'])+([\\'’][_' +\r\n\t\t\tthis.config.regExpLetters +\r\n\t\t\t']*)*',\r\n\t\t\t'g'\r\n\t\t),\r\n\t\t'countChunks': new RegExp(\r\n\t\t\t'\\\\[\\\\[[^\\\\[\\\\]\\\\n]+\\\\]\\\\]|' +       // [[wiki link]]\r\n\t\t\t'\\\\{\\\\{[^\\\\{\\\\}\\\\n]+\\\\}\\\\}|' +       // {{template}}\r\n\t\t\t'\\\\[[^\\\\[\\\\]\\\\n]+\\\\]|' +             // [ext. link]\r\n\t\t\t'<\\\\/?[^<>\\\\[\\\\]\\\\{\\\\}\\\\n]+>|' +     // <html>\r\n\t\t\t'\\\\[\\\\[[^\\\\[\\\\]\\\\|\\\\n]+\\\\]\\\\]\\\\||' + // [[wiki link|\r\n\t\t\t'\\\\{\\\\{[^\\\\{\\\\}\\\\|\\\\n]+\\\\||' +       // {{template|\r\n\t\t\t'\\\\b((https?:|)\\\\/\\\\/)[^\\\\x00-\\\\x20\\\\s\"\\\\[\\\\]\\\\x7f]+', // link\r\n\t\t\t'g'\r\n\t\t),\r\n\r\n\t\t// RegExp detecting blank-only and single-char blocks\r\n\t\t'blankBlock': /^([^\\t\\S]+|[^\\t])$/,\r\n\r\n\t\t// RegExps for clipping\r\n\t\t'clipLine': new RegExp(\r\n\t\t\t'[' + this.config.regExpNewLinesAll +\r\n\t\t\tthis.config.regExpNewParagraph +\r\n\t\t\t']+',\r\n\t\t\t'g'\r\n\t\t),\r\n\t\t'clipHeading': new RegExp(\r\n\t\t\t'( ^|\\\\n)(==+.+?==+|\\\\{\\\\||\\\\|\\\\}).*?(?=\\\\n|$)', 'g' ),\r\n\t\t'clipParagraph': new RegExp(\r\n\t\t\t'( (\\\\r\\\\n|\\\\n|\\\\r){2,}|[' +\r\n\t\t\tthis.config.regExpNewParagraph +\r\n\t\t\t'])+',\r\n\t\t\t'g'\r\n\t\t),\r\n\t\t'clipBlank': new RegExp(\r\n\t\t\t'[' +\r\n\t\t\tthis.config.regExpBlanks + ']+',\r\n\t\t\t'g'\r\n\t\t),\r\n\t\t'clipTrimNewLinesLeft': new RegExp(\r\n\t\t\t'[' +\r\n\t\t\tthis.config.regExpNewLinesAll +\r\n\t\t\tthis.config.regExpNewParagraph +\r\n\t\t\t']+$',\r\n\t\t\t'g'\r\n\t\t),\r\n\t\t'clipTrimNewLinesRight': new RegExp(\r\n\t\t\t'^[' +\r\n\t\t\tthis.config.regExpNewLinesAll +\r\n\t\t\tthis.config.regExpNewParagraph +\r\n\t\t\t']+',\r\n\t\t\t'g'\r\n\t\t),\r\n\t\t'clipTrimBlanksLeft': new RegExp(\r\n\t\t\t'[' +\r\n\t\t\tthis.config.regExpBlanks +\r\n\t\t\tthis.config.regExpNewLinesAll +\r\n\t\t\tthis.config.regExpNewParagraph +\r\n\t\t\t']+$',\r\n\t\t\t'g'\r\n\t\t),\r\n\t\t'clipTrimBlanksRight': new RegExp(\r\n\t\t\t'^[' +\r\n\t\t\tthis.config.regExpBlanks +\r\n\t\t\tthis.config.regExpNewLinesAll +\r\n\t\t\tthis.config.regExpNewParagraph +\r\n\t\t\t']+',\r\n\t\t\t'g'\r\n\t\t),\r\n\t\t'refillChange': new RegExp(\r\n\t\t\t'RFL(\\\\w)(\\\\d+)LFR',\r\n\t\t\t'g'\r\n\t\t)\r\n\t};\r\n\r\n\t/** Add messages to configuration settings. */\r\n\r\n\tthis.config.msg = {\r\n    'wiked-diff-empty': '(No difference)',\r\n    'wiked-diff-same':  '=',\r\n    'wiked-diff-ins':   '+',\r\n    'wiked-diff-del':   '-',\r\n    'wiked-diff-block-left':  '◀',\r\n    'wiked-diff-block-right': '▶',\r\n    'wiked-diff-block-left-nounicode':  '<',\r\n    'wiked-diff-block-right-nounicode': '>',\r\n\t\t'wiked-diff-error': 'Error: diff not consistent with versions!'\r\n\t};\r\n\r\n\t/**\r\n\t * Add output html fragments to configuration settings.\r\n\t * Dynamic replacements:\r\n\t *   {number}: class/color/block/mark/id number\r\n\t *   {title}: title attribute (popup)\r\n\t *   {nounicode}: noUnicodeSymbols fallback\r\n\t */\r\n\tthis.config.htmlCode = {\r\n\t\t'noChangeStart':\r\n\t\t\t'<div class=\"wikEdDiffNoChange\" title=\"' +\r\n\t\t\tthis.config.msg['wiked-diff-same'] +\r\n\t\t\t'\">',\r\n\t\t'noChangeEnd': '</div>',\r\n\r\n\t\t'containerStart': '<div class=\"wikEdDiffContainer\" id=\"wikEdDiffContainer\">',\r\n\t\t'containerEnd': '</div>',\r\n\r\n\t\t'fragmentStart': '<pre class=\"wikEdDiffFragment\" style=\"white-space: pre-wrap;\">',\r\n\t\t'fragmentEnd': '</pre>',\r\n\t\t'separator': '<div class=\"wikEdDiffSeparator\"></div>',\r\n\r\n\t\t'insertStart':\r\n\t\t\t'<span class=\"wikEdDiffInsert\" title=\"' +\r\n\t\t\tthis.config.msg['wiked-diff-ins'] +\r\n\t\t\t'\">',\r\n\t\t'insertStartBlank':\r\n\t\t\t'<span class=\"wikEdDiffInsert wikEdDiffInsertBlank\" title=\"' +\r\n\t\t\tthis.config.msg['wiked-diff-ins'] +\r\n\t\t\t'\">',\r\n\t\t'insertEnd': '</span>',\r\n\r\n\t\t'deleteStart':\r\n\t\t\t'<span class=\"wikEdDiffDelete\" title=\"' +\r\n\t\t\tthis.config.msg['wiked-diff-del'] +\r\n\t\t\t'\">',\r\n\t\t'deleteStartBlank':\r\n\t\t\t'<span class=\"wikEdDiffDelete wikEdDiffDeleteBlank\" title=\"' +\r\n\t\t\tthis.config.msg['wiked-diff-del'] +\r\n\t\t\t'\">',\r\n\t\t'deleteEnd': '</span>',\r\n\r\n\t\t'blockStart':\r\n\t\t\t'<span class=\"wikEdDiffBlock\"' +\r\n\t\t\t'title=\"{title}\" id=\"wikEdDiffBlock{number}\"' +\r\n\t\t\t'onmouseover=\"wikEdDiffBlockHandler(undefined, this, \\'mouseover\\');\">',\r\n\t\t'blockColoredStart':\r\n\t\t\t'<span class=\"wikEdDiffBlock wikEdDiffBlock wikEdDiffBlock{number}\"' +\r\n\t\t\t'title=\"{title}\" id=\"wikEdDiffBlock{number}\"' +\r\n\t\t\t'onmouseover=\"wikEdDiffBlockHandler(undefined, this, \\'mouseover\\');\">',\r\n\t\t'blockEnd': '</span>',\r\n\r\n\t\t'markLeft':\r\n\t\t\t'<span class=\"wikEdDiffMarkLeft{nounicode}\"' +\r\n\t\t\t'title=\"{title}\" id=\"wikEdDiffMark{number}\"' +\r\n\t\t\t'onmouseover=\"wikEdDiffBlockHandler(undefined, this, \\'mouseover\\');\"></span>',\r\n\t\t'markLeftColored':\r\n\t\t\t'<span class=\"wikEdDiffMarkLeft{nounicode} wikEdDiffMark wikEdDiffMark{number}\"' +\r\n\t\t\t'title=\"{title}\" id=\"wikEdDiffMark{number}\"' +\r\n\t\t\t'onmouseover=\"wikEdDiffBlockHandler(undefined, this, \\'mouseover\\');\"></span>',\r\n\r\n\t\t'markRight':\r\n\t\t\t'<span class=\"wikEdDiffMarkRight{nounicode}\"' +\r\n\t\t\t'title=\"{title}\" id=\"wikEdDiffMark{number}\"' +\r\n\t\t\t'onmouseover=\"wikEdDiffBlockHandler(undefined, this, \\'mouseover\\');\"></span>',\r\n\t\t'markRightColored':\r\n\t\t\t'<span class=\"wikEdDiffMarkRight{nounicode} wikEdDiffMark wikEdDiffMark{number}\"' +\r\n\t\t\t'title=\"{title}\" id=\"wikEdDiffMark{number}\"' +\r\n\t\t\t'onmouseover=\"wikEdDiffBlockHandler(undefined, this, \\'mouseover\\');\"></span>',\r\n\r\n\t\t'newline': '<span class=\"wikEdDiffNewline\">\\n</span>',\r\n\t\t'tab': '<span class=\"wikEdDiffTab\"><span class=\"wikEdDiffTabSymbol\"></span>\\t</span>',\r\n\t\t'space': '<span class=\"wikEdDiffSpace\"><span class=\"wikEdDiffSpaceSymbol\"></span> </span>',\r\n\r\n\t\t'omittedChars': '<span class=\"wikEdDiffOmittedChars\">…</span>',\r\n\r\n\t\t'errorStart': '<div class=\"wikEdDiffError\" title=\"Error: diff not consistent with versions!\">',\r\n\t\t'errorEnd': '</div>',\r\n\r\n\t\t'refillChange': '<span class=\"wikEdRefillChange\" data-id=\"{number}\" title=\"reFill #{number}\" onclick=\"window.refillChangeClickHandler({number})\">&#128393;</span>',\r\n\t\t'refillError': '<span class=\"wikEdRefillError\" data-id=\"{number}\" title=\"reFill #{number}\" onclick=\"window.refillErrorClickHandler({number})\">&#128393;</span>'\r\n\t};\r\n\r\n\t/*\r\n\t * Add JavaScript event handler function to configuration settings\r\n\t * Highlights corresponding block and mark elements on hover and jumps between them on click\r\n\t * Code for use in non-jQuery environments and legacy browsers (at least IE 8 compatible)\r\n\t *\r\n\t * @option Event|undefined event Browser event if available\r\n\t * @option element Node DOM node\r\n\t * @option type string Event type\r\n\t */\r\n\tthis.config.blockHandler = function ( event, element, type ) {\r\n\r\n\t\t// IE compatibility\r\n\t\tif ( event === undefined && window.event !== undefined ) {\r\n\t\t\tevent = window.event;\r\n\t\t}\r\n\r\n\t\t// Get mark/block elements\r\n\t\tvar number = element.id.replace( /\\D/g, '' );\r\n\t\tvar block = document.getElementById( 'wikEdDiffBlock' + number );\r\n\t\tvar mark = document.getElementById( 'wikEdDiffMark' + number );\r\n\t\tif ( block === null || mark === null ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Highlight corresponding mark/block pairs\r\n\t\tif ( type === 'mouseover' ) {\r\n\t\t\telement.onmouseover = null;\r\n\t\t\telement.onmouseout = function ( event ) {\r\n\t\t\t\twindow.wikEdDiffBlockHandler( event, element, 'mouseout' );\r\n\t\t\t};\r\n\t\t\telement.onclick = function ( event ) {\r\n\t\t\t\twindow.wikEdDiffBlockHandler( event, element, 'click' );\r\n\t\t\t};\r\n\t\t\tblock.className += ' wikEdDiffBlockHighlight';\r\n\t\t\tmark.className += ' wikEdDiffMarkHighlight';\r\n\t\t}\r\n\r\n\t\t// Remove mark/block highlighting\r\n\t\tif ( type === 'mouseout' || type === 'click' ) {\r\n\t\t\telement.onmouseout = null;\r\n\t\t\telement.onmouseover = function ( event ) {\r\n\t\t\t\twindow.wikEdDiffBlockHandler( event, element, 'mouseover' );\r\n\t\t\t};\r\n\r\n\t\t\t// Reset, allow outside container (e.g. legend)\r\n\t\t\tif ( type !== 'click' ) {\r\n\t\t\t\tblock.className = block.className.replace( / wikEdDiffBlockHighlight/g, '' );\r\n\t\t\t\tmark.className = mark.className.replace( / wikEdDiffMarkHighlight/g, '' );\r\n\r\n\t\t\t\t// GetElementsByClassName\r\n\t\t\t\tvar container = document.getElementById( 'wikEdDiffContainer' );\r\n\t\t\t\tif ( container !== null ) {\r\n\t\t\t\t\tvar spans = container.getElementsByTagName( 'span' );\r\n\t\t\t\t\tvar spansLength = spans.length;\r\n\t\t\t\t\tfor ( var i = 0; i < spansLength; i ++ ) {\r\n\t\t\t\t\t\tif ( spans[i] !== block && spans[i] !== mark ) {\r\n\t\t\t\t\t\t\tif ( spans[i].className.indexOf( ' wikEdDiffBlockHighlight' ) !== -1 ) {\r\n\t\t\t\t\t\t\t\tspans[i].className = spans[i].className.replace( / wikEdDiffBlockHighlight/g, '' );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if ( spans[i].className.indexOf( ' wikEdDiffMarkHighlight') !== -1 ) {\r\n\t\t\t\t\t\t\t\tspans[i].className = spans[i].className.replace( / wikEdDiffMarkHighlight/g, '' );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Scroll to corresponding mark/block element\r\n\t\tif ( type === 'click' ) {\r\n\r\n\t\t\t// Get corresponding element\r\n\t\t\tvar corrElement;\r\n\t\t\tif ( element === block ) {\r\n\t\t\t\tcorrElement = mark;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tcorrElement = block;\r\n\t\t\t}\r\n\r\n\t\t\t// Get element height (getOffsetTop)\r\n\t\t\tvar corrElementPos = 0;\r\n\t\t\tvar node = corrElement;\r\n\t\t\tdo {\r\n\t\t\t\tcorrElementPos += node.offsetTop;\r\n\t\t\t} while ( ( node = node.offsetParent ) !== null );\r\n\r\n\t\t\t// Get scroll height\r\n\t\t\tvar top;\r\n\t\t\tif ( window.pageYOffset !== undefined ) {\r\n\t\t\t\ttop = window.pageYOffset;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\ttop = document.documentElement.scrollTop;\r\n\t\t\t}\r\n\r\n\t\t\t// Get cursor pos\r\n\t\t\tvar cursor;\r\n\t\t\tif ( event.pageY !== undefined ) {\r\n\t\t\t\tcursor = event.pageY;\r\n\t\t\t}\r\n\t\t\telse if ( event.clientY !== undefined ) {\r\n\t\t\t\tcursor = event.clientY + top;\r\n\t\t\t}\r\n\r\n\t\t\t// Get line height\r\n\t\t\tvar line = 12;\r\n\t\t\tif ( window.getComputedStyle !== undefined ) {\r\n\t\t\t\tline = parseInt( window.getComputedStyle( corrElement ).getPropertyValue( 'line-height' ) );\r\n\t\t\t}\r\n\r\n\t\t\t// Scroll element under mouse cursor\r\n\t\t\twindow.scroll( 0, corrElementPos + top - cursor + line / 2 );\r\n\t\t}\r\n\t\treturn;\r\n\t};\r\n\r\n\t/** Internal data structures. */\r\n\r\n\t/** @var WikEdDiffText newText New text version object with text and token list */\r\n\tthis.newText = null;\r\n\r\n\t/** @var WikEdDiffText oldText Old text version object with text and token list */\r\n\tthis.oldText = null;\r\n\r\n\t/** @var object symbols Symbols table for whole text at all refinement levels */\r\n\tthis.symbols = {\r\n\t\ttoken: [],\r\n\t\thashTable: {},\r\n\t\tlinked: false\r\n\t};\r\n\r\n\t/** @var array bordersDown Matched region borders downwards */\r\n\tthis.bordersDown = [];\r\n\r\n\t/** @var array bordersUp Matched region borders upwards */\r\n\tthis.bordersUp = [];\r\n\r\n\t/** @var array blocks Block data (consecutive text tokens) in new text order */\r\n\tthis.blocks = [];\r\n\r\n\t/** @var int maxWords Maximal detected word count of all linked blocks */\r\n\tthis.maxWords = 0;\r\n\r\n\t/** @var array groups Section blocks that are consecutive in old text order */\r\n\tthis.groups = [];\r\n\r\n\t/** @var array sections Block sections with no block move crosses outside a section */\r\n\tthis.sections = [];\r\n\r\n\t/** @var object timer Debug timer array: string 'label' => float milliseconds. */\r\n\tthis.timer = {};\r\n\r\n\t/** @var array recursionTimer Count time spent in recursion level in milliseconds. */\r\n\tthis.recursionTimer = [];\r\n\r\n\t/** Output data. */\r\n\r\n\t/** @var bool error Unit tests have detected a diff error */\r\n\tthis.error = false;\r\n\r\n\t/** @var array fragments Diff fragment list for markup, abstraction layer for customization */\r\n\tthis.fragments = [];\r\n\r\n\t/** @var string html Html code of diff */\r\n\tthis.html = '';\r\n\r\n\r\n\t/**\r\n\t * Constructor, initialize settings, load js and css.\r\n\t *\r\n\t * @param[in] object wikEdDiffConfig Custom customization settings\r\n\t * @param[out] object config Settings\r\n\t */\r\n\r\n\tthis.init = function () {\r\n\r\n\t\t// Import customizations from wikEdDiffConfig{}\r\n\t\tif ( typeof wikEdDiffConfig === 'object' ) {\r\n\t\t\tthis.deepCopy( wikEdDiffConfig, this.config );\r\n\t\t}\r\n\r\n\t\t// Add CSS stylescheet\r\n\t\tthis.addStyleSheet( this.config.stylesheet );\r\n\r\n\t\t// Load block handler script\r\n\t\tif ( this.config.showBlockMoves === true ) {\r\n\r\n\t\t\t// Add block handler to head if running under Greasemonkey\r\n\t\t\tif ( typeof GM_info === 'object' ) {\r\n\t\t\t\tvar script = 'var wikEdDiffBlockHandler = ' + this.config.blockHandler.toString() + ';';\r\n\t\t\t\tthis.addScript( script );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\twindow.wikEdDiffBlockHandler = this.config.blockHandler;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Main diff method.\r\n\t *\r\n\t * @param string oldString Old text version\r\n\t * @param string newString New text version\r\n\t * @param[out] array fragment\r\n\t *   Diff fragment list ready for markup, abstraction layer for customized diffs\r\n\t * @param[out] string html Html code of diff\r\n\t * @return string Html code of diff\r\n\t */\r\n\tthis.diff = function ( oldString, newString ) {\r\n\r\n\t\t// Start total timer\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.time( 'total' );\r\n\t\t}\r\n\r\n\t\t// Start diff timer\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.time( 'diff' );\r\n\t\t}\r\n\r\n\t\t// Reset error flag\r\n\t\tthis.error = false;\r\n\r\n\t\t// Strip trailing newline (.js only)\r\n\t\tif ( this.config.stripTrailingNewline === true ) {\r\n\t\t\tif ( newString.substr( -1 ) === '\\n' && oldString.substr( -1 === '\\n' ) ) {\r\n\t\t\t\tnewString = newString.substr( 0, newString.length - 1 );\r\n\t\t\t\toldString = oldString.substr( 0, oldString.length - 1 );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Load version strings into WikEdDiffText objects\r\n\t\tthis.newText = new WikEdDiff.WikEdDiffText( newString, this );\r\n\t\tthis.oldText = new WikEdDiff.WikEdDiffText( oldString, this );\r\n\r\n\t\t// Trap trivial changes: no change\r\n\t\tif ( this.newText.text === this.oldText.text ) {\r\n\t\t\tthis.html =\r\n\t\t\t\tthis.config.htmlCode.containerStart +\r\n\t\t\t\tthis.config.htmlCode.noChangeStart +\r\n\t\t\t\tthis.htmlEscape( this.config.msg['wiked-diff-empty'] ) +\r\n\t\t\t\tthis.config.htmlCode.noChangeEnd +\r\n\t\t\t\tthis.config.htmlCode.containerEnd;\r\n\t\t\treturn this.html;\r\n\t\t}\r\n\r\n\t\t// Trap trivial changes: old text deleted\r\n\t\tif (\r\n\t\t\tthis.oldText.text === '' || (\r\n\t\t\t\tthis.oldText.text === '\\n' &&\r\n\t\t\t\t( this.newText.text.charAt( this.newText.text.length - 1 ) === '\\n' )\r\n\t\t\t)\r\n\t\t) {\r\n\t\t\tthis.html =\r\n\t\t\t\tthis.config.htmlCode.containerStart +\r\n\t\t\t\tthis.config.htmlCode.fragmentStart +\r\n\t\t\t\tthis.config.htmlCode.insertStart +\r\n\t\t\t\tthis.htmlEscape( this.newText.text ) +\r\n\t\t\t\tthis.config.htmlCode.insertEnd +\r\n\t\t\t\tthis.config.htmlCode.fragmentEnd +\r\n\t\t\t\tthis.config.htmlCode.containerEnd;\r\n\t\t\treturn this.html;\r\n\t\t}\r\n\r\n\t\t// Trap trivial changes: new text deleted\r\n\t\tif (\r\n\t\t\tthis.newText.text === '' || (\r\n\t\t\t\tthis.newText.text === '\\n' &&\r\n\t\t\t\t( this.oldText.text.charAt( this.oldText.text.length - 1 ) === '\\n' )\r\n\t\t\t)\r\n\t\t) {\r\n\t\t\tthis.html =\r\n\t\t\t\tthis.config.htmlCode.containerStart +\r\n\t\t\t\tthis.config.htmlCode.fragmentStart +\r\n\t\t\t\tthis.config.htmlCode.deleteStart +\r\n\t\t\t\tthis.htmlEscape( this.oldText.text ) +\r\n\t\t\t\tthis.config.htmlCode.deleteEnd +\r\n\t\t\t\tthis.config.htmlCode.fragmentEnd +\r\n\t\t\t\tthis.config.htmlCode.containerEnd;\r\n\t\t\treturn this.html;\r\n\t\t}\r\n\r\n\t\t// Split new and old text into paragraps\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.time( 'paragraph split' );\r\n\t\t}\r\n\t\tthis.newText.splitText( 'paragraph' );\r\n\t\tthis.oldText.splitText( 'paragraph' );\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.timeEnd( 'paragraph split' );\r\n\t\t}\r\n\r\n\t\t// Calculate diff\r\n\t\tthis.calculateDiff( 'line' );\r\n\r\n\t\t// Refine different paragraphs into lines\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.time( 'line split' );\r\n\t\t}\r\n\t\tthis.newText.splitRefine( 'line' );\r\n\t\tthis.oldText.splitRefine( 'line' );\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.timeEnd( 'line split' );\r\n\t\t}\r\n\r\n\t\t// Calculate refined diff\r\n\t\tthis.calculateDiff( 'line' );\r\n\r\n\t\t// Refine different lines into sentences\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.time( 'sentence split' );\r\n\t\t}\r\n\t\tthis.newText.splitRefine( 'sentence' );\r\n\t\tthis.oldText.splitRefine( 'sentence' );\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.timeEnd( 'sentence split' );\r\n\t\t}\r\n\r\n\t\t// Calculate refined diff\r\n\t\tthis.calculateDiff( 'sentence' );\r\n\r\n\t\t// Refine different sentences into chunks\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.time( 'chunk split' );\r\n\t\t}\r\n\t\tthis.newText.splitRefine( 'chunk' );\r\n\t\tthis.oldText.splitRefine( 'chunk' );\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.timeEnd( 'chunk split' );\r\n\t\t}\r\n\r\n\t\t// Calculate refined diff\r\n\t\tthis.calculateDiff( 'chunk' );\r\n\r\n\t\t// Refine different chunks into words\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.time( 'word split' );\r\n\t\t}\r\n\t\tthis.newText.splitRefine( 'word' );\r\n\t\tthis.oldText.splitRefine( 'word' );\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.timeEnd( 'word split' );\r\n\t\t}\r\n\r\n\t\t// Calculate refined diff information with recursion for unresolved gaps\r\n\t\tthis.calculateDiff( 'word', true );\r\n\r\n\t\t// Slide gaps\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.time( 'word slide' );\r\n\t\t}\r\n\t\tthis.slideGaps( this.newText, this.oldText );\r\n\t\tthis.slideGaps( this.oldText, this.newText );\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.timeEnd( 'word slide' );\r\n\t\t}\r\n\r\n\t\t// Split tokens into chars\r\n\t\tif ( this.config.charDiff === true ) {\r\n\r\n\t\t\t// Split tokens into chars in selected unresolved gaps\r\n\t\t\tif ( this.config.timer === true ) {\r\n\t\t\t\tthis.time( 'character split' );\r\n\t\t\t}\r\n\t\t\tthis.splitRefineChars();\r\n\t\t\tif ( this.config.timer === true ) {\r\n\t\t\t\tthis.timeEnd( 'character split' );\r\n\t\t\t}\r\n\r\n\t\t\t// Calculate refined diff information with recursion for unresolved gaps\r\n\t\t\tthis.calculateDiff( 'character', true );\r\n\r\n\t\t\t// Slide gaps\r\n\t\t\tif ( this.config.timer === true ) {\r\n\t\t\t\tthis.time( 'character slide' );\r\n\t\t\t}\r\n\t\t\tthis.slideGaps( this.newText, this.oldText );\r\n\t\t\tthis.slideGaps( this.oldText, this.newText );\r\n\t\t\tif ( this.config.timer === true ) {\r\n\t\t\t\tthis.timeEnd( 'character slide' );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Free memory\r\n\t\tthis.symbols = undefined;\r\n\t\tthis.bordersDown = undefined;\r\n\t\tthis.bordersUp = undefined;\r\n\t\tthis.newText.words = undefined;\r\n\t\tthis.oldText.words = undefined;\r\n\r\n\t\t// Enumerate token lists\r\n\t\tthis.newText.enumerateTokens();\r\n\t\tthis.oldText.enumerateTokens();\r\n\r\n\t\t// Detect moved blocks\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.time( 'blocks' );\r\n\t\t}\r\n\t\tthis.detectBlocks();\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.timeEnd( 'blocks' );\r\n\t\t}\r\n\r\n\t\t// Free memory\r\n\t\tthis.newText.tokens = undefined;\r\n\t\tthis.oldText.tokens = undefined;\r\n\r\n\t\t// Assemble blocks into fragment table\r\n\t\tthis.getDiffFragments();\r\n\r\n\t\t// Free memory\r\n\t\tthis.blocks = undefined;\r\n\t\tthis.groups = undefined;\r\n\t\tthis.sections = undefined;\r\n\r\n\t\t// Stop diff timer\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.timeEnd( 'diff' );\r\n\t\t}\r\n\r\n\t\t// Unit tests\r\n\t\tif ( this.config.unitTesting === true ) {\r\n\r\n\t\t\t// Test diff to test consistency between input and output\r\n\t\t\tif ( this.config.timer === true ) {\r\n\t\t\t\tthis.time( 'unit tests' );\r\n\t\t\t}\r\n\t\t\tthis.unitTests();\r\n\t\t\tif ( this.config.timer === true ) {\r\n\t\t\t\tthis.timeEnd( 'unit tests' );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Clipping\r\n\t\tif ( this.config.fullDiff === false ) {\r\n\r\n\t\t\t// Clipping unchanged sections from unmoved block text\r\n\t\t\tif ( this.config.timer === true ) {\r\n\t\t\t\tthis.time( 'clip' );\r\n\t\t\t}\r\n\t\t\tthis.clipDiffFragments();\r\n\t\t\tif ( this.config.timer === true ) {\r\n\t\t\t\tthis.timeEnd( 'clip' );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Create html formatted diff code from diff fragments\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.time( 'html' );\r\n\t\t}\r\n\t\tthis.getDiffHtml();\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.timeEnd( 'html' );\r\n\t\t}\r\n\r\n\t\t// No change\r\n\t\tif ( this.html === '' ) {\r\n\t\t\tthis.html =\r\n\t\t\t\tthis.config.htmlCode.containerStart +\r\n\t\t\t\tthis.config.htmlCode.noChangeStart +\r\n\t\t\t\tthis.htmlEscape( this.config.msg['wiked-diff-empty'] ) +\r\n\t\t\t\tthis.config.htmlCode.noChangeEnd +\r\n\t\t\t\tthis.config.htmlCode.containerEnd;\r\n\t\t}\r\n\r\n\t\t// Add error indicator\r\n\t\tif ( this.error === true ) {\r\n\t\t\tthis.html = this.config.htmlCode.errorStart + this.html + this.config.htmlCode.errorEnd;\r\n\t\t}\r\n\r\n\t\t// Stop total timer\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.timeEnd( 'total' );\r\n\t\t}\r\n\r\n\t\treturn this.html;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Split tokens into chars in the following unresolved regions (gaps):\r\n\t *   - One token became connected or separated by space or dash (or any token)\r\n\t *   - Same number of tokens in gap and strong similarity of all tokens:\r\n\t *     - Addition or deletion of flanking strings in tokens\r\n\t *     - Addition or deletion of internal string in tokens\r\n\t *     - Same length and at least 50 % identity\r\n\t *     - Same start or end, same text longer than different text\r\n\t * Identical tokens including space separators will be linked,\r\n\t *   resulting in word-wise char-level diffs\r\n\t *\r\n\t * @param[in/out] WikEdDiffText newText, oldText Text object tokens list\r\n\t */\r\n\tthis.splitRefineChars = function () {\r\n\r\n\t\t/** Find corresponding gaps. */\r\n\r\n\t\t// Cycle through new text tokens list\r\n\t\tvar gaps = [];\r\n\t\tvar gap = null;\r\n\t\tvar i = this.newText.first;\r\n\t\tvar j = this.oldText.first;\r\n\t\twhile ( i !== null ) {\r\n\r\n\t\t\t// Get token links\r\n\t\t\tvar newLink = this.newText.tokens[i].link;\r\n\t\t\tvar oldLink = null;\r\n\t\t\tif ( j !== null ) {\r\n\t\t\t\toldLink = this.oldText.tokens[j].link;\r\n\t\t\t}\r\n\r\n\t\t\t// Start of gap in new and old\r\n\t\t\tif ( gap === null && newLink === null && oldLink === null ) {\r\n\t\t\t\tgap = gaps.length;\r\n\t\t\t\tgaps.push( {\r\n\t\t\t\t\tnewFirst:  i,\r\n\t\t\t\t\tnewLast:   i,\r\n\t\t\t\t\tnewTokens: 1,\r\n\t\t\t\t\toldFirst:  j,\r\n\t\t\t\t\toldLast:   j,\r\n\t\t\t\t\toldTokens: null,\r\n\t\t\t\t\tcharSplit: null\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\r\n\t\t\t// Count chars and tokens in gap\r\n\t\t\telse if ( gap !== null && newLink === null ) {\r\n\t\t\t\tgaps[gap].newLast = i;\r\n\t\t\t\tgaps[gap].newTokens ++;\r\n\t\t\t}\r\n\r\n\t\t\t// Gap ended\r\n\t\t\telse if ( gap !== null && newLink !== null ) {\r\n\t\t\t\tgap = null;\r\n\t\t\t}\r\n\r\n\t\t\t// Next list elements\r\n\t\t\tif ( newLink !== null ) {\r\n\t\t\t\tj = this.oldText.tokens[newLink].next;\r\n\t\t\t}\r\n\t\t\ti = this.newText.tokens[i].next;\r\n\t\t}\r\n\r\n\t\t// Cycle through gaps and add old text gap data\r\n\t\tvar gapsLength = gaps.length;\r\n\t\tfor ( var gap = 0; gap < gapsLength; gap ++ ) {\r\n\r\n\t\t\t// Cycle through old text tokens list\r\n\t\t\tvar j = gaps[gap].oldFirst;\r\n\t\t\twhile (\r\n\t\t\t\tj !== null &&\r\n\t\t\t\tthis.oldText.tokens[j] !== null &&\r\n\t\t\t\tthis.oldText.tokens[j].link === null\r\n\t\t\t) {\r\n\r\n\t\t\t\t// Count old chars and tokens in gap\r\n\t\t\t\tgaps[gap].oldLast = j;\r\n\t\t\t\tgaps[gap].oldTokens ++;\r\n\r\n\t\t\t\tj = this.oldText.tokens[j].next;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/** Select gaps of identical token number and strong similarity of all tokens. */\r\n\r\n\t\tvar gapsLength = gaps.length;\r\n\t\tfor ( var gap = 0; gap < gapsLength; gap ++ ) {\r\n\t\t\tvar charSplit = true;\r\n\r\n\t\t\t// Not same gap length\r\n\t\t\tif ( gaps[gap].newTokens !== gaps[gap].oldTokens ) {\r\n\r\n\t\t\t\t// One word became separated by space, dash, or any string\r\n\t\t\t\tif ( gaps[gap].newTokens === 1 && gaps[gap].oldTokens === 3 ) {\r\n\t\t\t\t\tvar token = this.newText.tokens[ gaps[gap].newFirst ].token;\r\n\t\t\t\t\tvar tokenFirst = this.oldText.tokens[ gaps[gap].oldFirst ].token;\r\n\t\t\t\t\tvar tokenLast = this.oldText.tokens[ gaps[gap].oldLast ].token;\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\ttoken.indexOf( tokenFirst ) !== 0 ||\r\n\t\t\t\t\t\ttoken.indexOf( tokenLast ) !== token.length - tokenLast.length\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse if ( gaps[gap].oldTokens === 1 && gaps[gap].newTokens === 3 ) {\r\n\t\t\t\t\tvar token = this.oldText.tokens[ gaps[gap].oldFirst ].token;\r\n\t\t\t\t\tvar tokenFirst = this.newText.tokens[ gaps[gap].newFirst ].token;\r\n\t\t\t\t\tvar tokenLast = this.newText.tokens[ gaps[gap].newLast ].token;\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\ttoken.indexOf( tokenFirst ) !== 0 ||\r\n\t\t\t\t\t\ttoken.indexOf( tokenLast ) !== token.length - tokenLast.length\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t\tgaps[gap].charSplit = true;\r\n\t\t\t}\r\n\r\n\t\t\t// Cycle through new text tokens list and set charSplit\r\n\t\t\telse {\r\n\t\t\t\tvar i = gaps[gap].newFirst;\r\n\t\t\t\tvar j = gaps[gap].oldFirst;\r\n\t\t\t\twhile ( i !== null ) {\r\n\t\t\t\t\tvar newToken = this.newText.tokens[i].token;\r\n\t\t\t\t\tvar oldToken = this.oldText.tokens[j].token;\r\n\r\n\t\t\t\t\t// Get shorter and longer token\r\n\t\t\t\t\tvar shorterToken;\r\n\t\t\t\t\tvar longerToken;\r\n\t\t\t\t\tif ( newToken.length < oldToken.length ) {\r\n\t\t\t\t\t\tshorterToken = newToken;\r\n\t\t\t\t\t\tlongerToken = oldToken;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tshorterToken = oldToken;\r\n\t\t\t\t\t\tlongerToken = newToken;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Not same token length\r\n\t\t\t\t\tif ( newToken.length !== oldToken.length ) {\r\n\r\n\t\t\t\t\t\t// Test for addition or deletion of internal string in tokens\r\n\r\n\t\t\t\t\t\t// Find number of identical chars from left\r\n\t\t\t\t\t\tvar left = 0;\r\n\t\t\t\t\t\twhile ( left < shorterToken.length ) {\r\n\t\t\t\t\t\t\tif ( newToken.charAt( left ) !== oldToken.charAt( left ) ) {\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tleft ++;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// Find number of identical chars from right\r\n\t\t\t\t\t\tvar right = 0;\r\n\t\t\t\t\t\twhile ( right < shorterToken.length ) {\r\n\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\tnewToken.charAt( newToken.length - 1 - right ) !==\r\n\t\t\t\t\t\t\t\toldToken.charAt( oldToken.length - 1 - right )\r\n\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tright ++;\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t// No simple insertion or deletion of internal string\r\n\t\t\t\t\t\tif ( left + right !== shorterToken.length ) {\r\n\r\n\t\t\t\t\t\t\t// Not addition or deletion of flanking strings in tokens\r\n\t\t\t\t\t\t\t// Smaller token not part of larger token\r\n\t\t\t\t\t\t\tif ( longerToken.indexOf( shorterToken ) === -1 ) {\r\n\r\n\t\t\t\t\t\t\t\t// Same text at start or end shorter than different text\r\n\t\t\t\t\t\t\t\tif ( left < shorterToken.length / 2 && (right < shorterToken.length / 2) ) {\r\n\r\n\t\t\t\t\t\t\t\t\t// Do not split into chars in this gap\r\n\t\t\t\t\t\t\t\t\tcharSplit = false;\r\n\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Same token length\r\n\t\t\t\t\telse if ( newToken !== oldToken ) {\r\n\r\n\t\t\t\t\t\t// Tokens less than 50 % identical\r\n\t\t\t\t\t\tvar ident = 0;\r\n\t\t\t\t\t\tvar tokenLength = shorterToken.length;\r\n\t\t\t\t\t\tfor ( var pos = 0; pos < tokenLength; pos ++ ) {\r\n\t\t\t\t\t\t\tif ( shorterToken.charAt( pos ) === longerToken.charAt( pos ) ) {\r\n\t\t\t\t\t\t\t\tident ++;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ( ident / shorterToken.length < 0.49 ) {\r\n\r\n\t\t\t\t\t\t\t// Do not split into chars this gap\r\n\t\t\t\t\t\t\tcharSplit = false;\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Next list elements\r\n\t\t\t\t\tif ( i === gaps[gap].newLast ) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\ti = this.newText.tokens[i].next;\r\n\t\t\t\t\tj = this.oldText.tokens[j].next;\r\n\t\t\t\t}\r\n\t\t\t\tgaps[gap].charSplit = charSplit;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/** Refine words into chars in selected gaps. */\r\n\r\n\t\tvar gapsLength = gaps.length;\r\n\t\tfor ( var gap = 0; gap < gapsLength; gap ++ ) {\r\n\t\t\tif ( gaps[gap].charSplit === true ) {\r\n\r\n\t\t\t\t// Cycle through new text tokens list, link spaces, and split into chars\r\n\t\t\t\tvar i = gaps[gap].newFirst;\r\n\t\t\t\tvar j = gaps[gap].oldFirst;\r\n\t\t\t\tvar newGapLength = i - gaps[gap].newLast;\r\n\t\t\t\tvar oldGapLength = j - gaps[gap].oldLast;\r\n\t\t\t\twhile ( i !== null || j !== null ) {\r\n\r\n\t\t\t\t\t// Link identical tokens (spaces) to keep char refinement to words\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\tnewGapLength === oldGapLength &&\r\n\t\t\t\t\t\tthis.newText.tokens[i].token === this.oldText.tokens[j].token\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tthis.newText.tokens[i].link = j;\r\n\t\t\t\t\t\tthis.oldText.tokens[j].link = i;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Refine words into chars\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tif ( i !== null ) {\r\n\t\t\t\t\t\t\tthis.newText.splitText( 'character', i );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ( j !== null ) {\r\n\t\t\t\t\t\t\tthis.oldText.splitText( 'character', j );\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Next list elements\r\n\t\t\t\t\tif ( i === gaps[gap].newLast ) {\r\n\t\t\t\t\t\ti = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ( j === gaps[gap].oldLast ) {\r\n\t\t\t\t\t\tj = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ( i !== null ) {\r\n\t\t\t\t\t\ti = this.newText.tokens[i].next;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ( j !== null ) {\r\n\t\t\t\t\t\tj = this.oldText.tokens[j].next;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Move gaps with ambiguous identical fronts to last newline border or otherwise last word border.\r\n\t *\r\n\t * @param[in/out] wikEdDiffText text, textLinked These two are newText and oldText\r\n\t */\r\n\tthis.slideGaps = function ( text, textLinked ) {\r\n\r\n\t\tvar regExpSlideBorder = this.config.regExp.slideBorder;\r\n\t\tvar regExpSlideStop = this.config.regExp.slideStop;\r\n\r\n\t\t// Cycle through tokens list\r\n\t\tvar i = text.first;\r\n\t\tvar gapStart = null;\r\n\t\twhile ( i !== null ) {\r\n\r\n\t\t\t// Remember gap start\r\n\t\t\tif ( gapStart === null && text.tokens[i].link === null ) {\r\n\t\t\t\tgapStart = i;\r\n\t\t\t}\r\n\r\n\t\t\t// Find gap end\r\n\t\t\telse if ( gapStart !== null && text.tokens[i].link !== null ) {\r\n\t\t\t\tvar gapFront = gapStart;\r\n\t\t\t\tvar gapBack = text.tokens[i].prev;\r\n\r\n\t\t\t\t// Slide down as deep as possible\r\n\t\t\t\tvar front = gapFront;\r\n\t\t\t\tvar back = text.tokens[gapBack].next;\r\n\t\t\t\tif (\r\n\t\t\t\t\tfront !== null &&\r\n\t\t\t\t\tback !== null &&\r\n\t\t\t\t\ttext.tokens[front].link === null &&\r\n\t\t\t\t\ttext.tokens[back].link !== null &&\r\n\t\t\t\t\ttext.tokens[front].token === text.tokens[back].token\r\n\t\t\t\t) {\r\n\t\t\t\t\ttext.tokens[front].link = text.tokens[back].link;\r\n\t\t\t\t\ttextLinked.tokens[ text.tokens[front].link ].link = front;\r\n\t\t\t\t\ttext.tokens[back].link = null;\r\n\r\n\t\t\t\t\tgapFront = text.tokens[gapFront].next;\r\n\t\t\t\t\tgapBack = text.tokens[gapBack].next;\r\n\r\n\t\t\t\t\tfront = text.tokens[front].next;\r\n\t\t\t\t\tback = text.tokens[back].next;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Test slide up, remember last line break or word border\r\n\t\t\t\tvar front = text.tokens[gapFront].prev;\r\n\t\t\t\tvar back = gapBack;\r\n\t\t\t\tvar gapFrontBlankTest = regExpSlideBorder.test( text.tokens[gapFront].token );\r\n\t\t\t\tvar frontStop = front;\r\n\t\t\t\tif ( text.tokens[back].link === null ) {\r\n\t\t\t\t\twhile (\r\n\t\t\t\t\t\tfront !== null &&\r\n\t\t\t\t\t\tback !== null &&\r\n\t\t\t\t\t\ttext.tokens[front].link !== null &&\r\n\t\t\t\t\t\ttext.tokens[front].token === text.tokens[back].token\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tif ( front !== null ) {\r\n\r\n\t\t\t\t\t\t\t// Stop at line break\r\n\t\t\t\t\t\t\tif ( regExpSlideStop.test( text.tokens[front].token ) === true ) {\r\n\t\t\t\t\t\t\t\tfrontStop = front;\r\n\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Stop at first word border (blank/word or word/blank)\r\n\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\tregExpSlideBorder.test( text.tokens[front].token ) !== gapFrontBlankTest ) {\r\n\t\t\t\t\t\t\t\tfrontStop = front;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tfront = text.tokens[front].prev;\r\n\t\t\t\t\t\tback = text.tokens[back].prev;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Actually slide up to stop\r\n\t\t\t\tvar front = text.tokens[gapFront].prev;\r\n\t\t\t\tvar back = gapBack;\r\n\t\t\t\twhile (\r\n\t\t\t\t\tfront !== null &&\r\n\t\t\t\t\tback !== null &&\r\n\t\t\t\t\tfront !== frontStop &&\r\n\t\t\t\t\ttext.tokens[front].link !== null &&\r\n\t\t\t\t\ttext.tokens[back].link === null &&\r\n\t\t\t\t\ttext.tokens[front].token === text.tokens[back].token\r\n\t\t\t\t) {\r\n\t\t\t\t\ttext.tokens[back].link = text.tokens[front].link;\r\n\t\t\t\t\ttextLinked.tokens[ text.tokens[back].link ].link = back;\r\n\t\t\t\t\ttext.tokens[front].link = null;\r\n\r\n\t\t\t\t\tfront = text.tokens[front].prev;\r\n\t\t\t\t\tback = text.tokens[back].prev;\r\n\t\t\t\t}\r\n\t\t\t\tgapStart = null;\r\n\t\t\t}\r\n\t\t\ti = text.tokens[i].next;\r\n\t\t}\r\n\t\treturn;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Calculate diff information, can be called repeatedly during refining.\r\n\t * Links corresponding tokens from old and new text.\r\n\t * Steps:\r\n\t *   Pass 1: parse new text into symbol table\r\n\t *   Pass 2: parse old text into symbol table\r\n\t *   Pass 3: connect unique matching tokens\r\n\t *   Pass 4: connect adjacent identical tokens downwards\r\n\t *   Pass 5: connect adjacent identical tokens upwards\r\n\t *   Repeat with empty symbol table (against crossed-over gaps)\r\n\t *   Recursively diff still unresolved regions downwards with empty symbol table\r\n\t *   Recursively diff still unresolved regions upwards with empty symbol table\r\n\t *\r\n\t * @param array symbols Symbol table object\r\n\t * @param string level Split level: 'paragraph', 'line', 'sentence', 'chunk', 'word', 'character'\r\n\t *\r\n\t * Optionally for recursive or repeated calls:\r\n\t * @param bool repeating Currently repeating with empty symbol table\r\n\t * @param bool recurse Enable recursion\r\n\t * @param int newStart, newEnd, oldStart, oldEnd Text object tokens indices\r\n\t * @param int recursionLevel Recursion level\r\n\t * @param[in/out] WikEdDiffText newText, oldText Text object, tokens list link property\r\n\t */\r\n\tthis.calculateDiff = function (\r\n\t\tlevel,\r\n\t\trecurse,\r\n\t\trepeating,\r\n\t\tnewStart,\r\n\t\toldStart,\r\n\t\tup,\r\n\t\trecursionLevel\r\n\t) {\r\n\r\n\t\t// Set defaults\r\n\t\tif ( repeating === undefined ) { repeating = false; }\r\n\t\tif ( recurse === undefined ) { recurse = false; }\r\n\t\tif ( newStart === undefined ) { newStart = this.newText.first; }\r\n\t\tif ( oldStart === undefined ) { oldStart = this.oldText.first; }\r\n\t\tif ( up === undefined ) { up = false; }\r\n\t\tif ( recursionLevel === undefined ) { recursionLevel = 0; }\r\n\r\n\t\t// Start timers\r\n\t\tif ( this.config.timer === true && repeating === false && recursionLevel === 0 ) {\r\n\t\t\tthis.time( level );\r\n\t\t}\r\n\t\tif ( this.config.timer === true && repeating === false ) {\r\n\t\t\tthis.time( level + recursionLevel );\r\n\t\t}\r\n\r\n\t\t// Get object symbols table and linked region borders\r\n\t\tvar symbols;\r\n\t\tvar bordersDown;\r\n\t\tvar bordersUp;\r\n\t\tif ( recursionLevel === 0 && repeating === false ) {\r\n\t\t\tsymbols = this.symbols;\r\n\t\t\tbordersDown = this.bordersDown;\r\n\t\t\tbordersUp = this.bordersUp;\r\n\t\t}\r\n\r\n\t\t// Create empty local symbols table and linked region borders arrays\r\n\t\telse {\r\n\t\t\tsymbols = {\r\n\t\t\t\ttoken: [],\r\n\t\t\t\thashTable: {},\r\n\t\t\t\tlinked: false\r\n\t\t\t};\r\n\t\t\tbordersDown = [];\r\n\t\t\tbordersUp = [];\r\n\t\t}\r\n\r\n\r\n\t\t// Updated versions of linked region borders\r\n\t\tvar bordersUpNext = [];\r\n\t\tvar bordersDownNext = [];\r\n\r\n\t\t/**\r\n\t\t * Pass 1: parse new text into symbol table.\r\n\t\t */\r\n\r\n\t\t// Cycle through new text tokens list\r\n\t\tvar i = newStart;\r\n\t\twhile ( i !== null ) {\r\n\t\t\tif ( this.newText.tokens[i].link === null ) {\r\n\r\n\t\t\t\t// Add new entry to symbol table\r\n\t\t\t\tvar token = this.newText.tokens[i].token;\r\n\t\t\t\tif ( Object.prototype.hasOwnProperty.call( symbols.hashTable, token ) === false ) {\r\n\t\t\t\t\tsymbols.hashTable[token] = symbols.token.length;\r\n\t\t\t\t\tsymbols.token.push( {\r\n\t\t\t\t\t\tnewCount: 1,\r\n\t\t\t\t\t\toldCount: 0,\r\n\t\t\t\t\t\tnewToken: i,\r\n\t\t\t\t\t\toldToken: null\r\n\t\t\t\t\t} );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Or update existing entry\r\n\t\t\t\telse {\r\n\r\n\t\t\t\t\t// Increment token counter for new text\r\n\t\t\t\t\tvar hashToArray = symbols.hashTable[token];\r\n\t\t\t\t\tsymbols.token[hashToArray].newCount ++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Stop after gap if recursing\r\n\t\t\telse if ( recursionLevel > 0 ) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\t// Get next token\r\n\t\t\tif ( up === false ) {\r\n\t\t\t\ti = this.newText.tokens[i].next;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\ti = this.newText.tokens[i].prev;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Pass 2: parse old text into symbol table.\r\n\t\t */\r\n\r\n\t\t// Cycle through old text tokens list\r\n\t\tvar j = oldStart;\r\n\t\twhile ( j !== null ) {\r\n\t\t\tif ( this.oldText.tokens[j].link === null ) {\r\n\r\n\t\t\t\t// Add new entry to symbol table\r\n\t\t\t\tvar token = this.oldText.tokens[j].token;\r\n\t\t\t\tif ( Object.prototype.hasOwnProperty.call( symbols.hashTable, token ) === false ) {\r\n\t\t\t\t\tsymbols.hashTable[token] = symbols.token.length;\r\n\t\t\t\t\tsymbols.token.push( {\r\n\t\t\t\t\t\tnewCount: 0,\r\n\t\t\t\t\t\toldCount: 1,\r\n\t\t\t\t\t\tnewToken: null,\r\n\t\t\t\t\t\toldToken: j\r\n\t\t\t\t\t} );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Or update existing entry\r\n\t\t\t\telse {\r\n\r\n\t\t\t\t\t// Increment token counter for old text\r\n\t\t\t\t\tvar hashToArray = symbols.hashTable[token];\r\n\t\t\t\t\tsymbols.token[hashToArray].oldCount ++;\r\n\r\n\t\t\t\t\t// Add token number for old text\r\n\t\t\t\t\tsymbols.token[hashToArray].oldToken = j;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Stop after gap if recursing\r\n\t\t\telse if ( recursionLevel > 0 ) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\t// Get next token\r\n\t\t\tif ( up === false ) {\r\n\t\t\t\tj = this.oldText.tokens[j].next;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tj = this.oldText.tokens[j].prev;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t/**\r\n\t\t * Pass 3: connect unique tokens.\r\n\t\t */\r\n\r\n\t\t// Cycle through symbol array\r\n\t\tvar symbolsLength = symbols.token.length;\r\n\t\tfor ( var i = 0; i < symbolsLength; i ++ ) {\r\n\r\n\t\t\t// Find tokens in the symbol table that occur only once in both versions\r\n\t\t\tif ( symbols.token[i].newCount === 1 && symbols.token[i].oldCount === 1 ) {\r\n\t\t\t\tvar newToken = symbols.token[i].newToken;\r\n\t\t\t\tvar oldToken = symbols.token[i].oldToken;\r\n\t\t\t\tvar newTokenObj = this.newText.tokens[newToken];\r\n\t\t\t\tvar oldTokenObj = this.oldText.tokens[oldToken];\r\n\r\n\t\t\t\t// Connect from new to old and from old to new\r\n\t\t\t\tif ( newTokenObj.link === null ) {\r\n\r\n\t\t\t\t\t// Do not use spaces as unique markers\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\tthis.config.regExp.blankOnlyToken.test( newTokenObj.token ) === true\r\n\t\t\t\t\t) {\r\n\r\n\t\t\t\t\t\t// Link new and old tokens\r\n\t\t\t\t\t\tnewTokenObj.link = oldToken;\r\n\t\t\t\t\t\toldTokenObj.link = newToken;\r\n\t\t\t\t\t\tsymbols.linked = true;\r\n\r\n\t\t\t\t\t\t// Save linked region borders\r\n\t\t\t\t\t\tbordersDown.push( [newToken, oldToken] );\r\n\t\t\t\t\t\tbordersUp.push( [newToken, oldToken] );\r\n\r\n\t\t\t\t\t\t// Check if token contains unique word\r\n\t\t\t\t\t\tif ( recursionLevel === 0 ) {\r\n\t\t\t\t\t\t\tvar unique = false;\r\n\t\t\t\t\t\t\tif ( level === 'character' ) {\r\n\t\t\t\t\t\t\t\tunique = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tvar token = newTokenObj.token;\r\n\t\t\t\t\t\t\t\tvar words =\r\n\t\t\t\t\t\t\t\t\t( token.match( this.config.regExp.countWords ) || [] ).concat(\r\n\t\t\t\t\t\t\t\t\t\t( token.match( this.config.regExp.countChunks ) || [] )\r\n\t\t\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t\t\t// Unique if longer than min block length\r\n\t\t\t\t\t\t\t\tvar wordsLength = words.length;\r\n\t\t\t\t\t\t\t\tif ( wordsLength >= this.config.blockMinLength ) {\r\n\t\t\t\t\t\t\t\t\tunique = true;\r\n\t\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t\t// Unique if it contains at least one unique word\r\n\t\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\t\tfor ( var i = 0;i < wordsLength; i ++ ) {\r\n\t\t\t\t\t\t\t\t\t\tvar word = words[i];\r\n\t\t\t\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\t\t\t\tthis.oldText.words[word] === 1 &&\r\n\t\t\t\t\t\t\t\t\t\t\tthis.newText.words[word] === 1 &&\r\n\t\t\t\t\t\t\t\t\t\t\tObject.prototype.hasOwnProperty.call( this.oldText.words, word ) === true &&\r\n\t\t\t\t\t\t\t\t\t\t\tObject.prototype.hasOwnProperty.call( this.newText.words, word ) === true\r\n\t\t\t\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\t\t\t\tunique = true;\r\n\t\t\t\t\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\t// Set unique\r\n\t\t\t\t\t\t\tif ( unique === true ) {\r\n\t\t\t\t\t\t\t\tnewTokenObj.unique = true;\r\n\t\t\t\t\t\t\t\toldTokenObj.unique = true;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Continue passes only if unique tokens have been linked previously\r\n\t\tif ( symbols.linked === true ) {\r\n\r\n\t\t\t/**\r\n\t\t\t * Pass 4: connect adjacent identical tokens downwards.\r\n\t\t\t */\r\n\r\n\t\t\t// Cycle through list of linked new text tokens\r\n\t\t\tvar bordersLength = bordersDown.length;\r\n\t\t\tfor ( var match = 0; match < bordersLength; match ++ ) {\r\n\t\t\t\tvar i = bordersDown[match][0];\r\n\t\t\t\tvar j = bordersDown[match][1];\r\n\r\n\t\t\t\t// Next down\r\n\t\t\t\tvar iMatch = i;\r\n\t\t\t\tvar jMatch = j;\r\n\t\t\t\ti = this.newText.tokens[i].next;\r\n\t\t\t\tj = this.oldText.tokens[j].next;\r\n\r\n\t\t\t\t// Cycle through new text list gap region downwards\r\n\t\t\t\twhile (\r\n\t\t\t\t\ti !== null &&\r\n\t\t\t\t\tj !== null &&\r\n\t\t\t\t\tthis.newText.tokens[i].link === null &&\r\n\t\t\t\t\tthis.oldText.tokens[j].link === null\r\n\t\t\t\t) {\r\n\r\n\t\t\t\t\t// Connect if same token\r\n\t\t\t\t\tif ( this.newText.tokens[i].token === this.oldText.tokens[j].token ) {\r\n\t\t\t\t\t\tthis.newText.tokens[i].link = j;\r\n\t\t\t\t\t\tthis.oldText.tokens[j].link = i;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Not a match yet, maybe in next refinement level\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tbordersDownNext.push( [iMatch, jMatch] );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Next token down\r\n\t\t\t\t\tiMatch = i;\r\n\t\t\t\t\tjMatch = j;\r\n\t\t\t\t\ti = this.newText.tokens[i].next;\r\n\t\t\t\t\tj = this.oldText.tokens[j].next;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t/**\r\n\t\t\t * Pass 5: connect adjacent identical tokens upwards.\r\n\t\t\t */\r\n\r\n\t\t\t// Cycle through list of connected new text tokens\r\n\t\t\tvar bordersLength = bordersUp.length;\r\n\t\t\tfor ( var match = 0; match < bordersLength; match ++ ) {\r\n\t\t\t\tvar i = bordersUp[match][0];\r\n\t\t\t\tvar j = bordersUp[match][1];\r\n\r\n\t\t\t\t// Next up\r\n\t\t\t\tvar iMatch = i;\r\n\t\t\t\tvar jMatch = j;\r\n\t\t\t\ti = this.newText.tokens[i].prev;\r\n\t\t\t\tj = this.oldText.tokens[j].prev;\r\n\r\n\t\t\t\t// Cycle through new text gap region upwards\r\n\t\t\t\twhile (\r\n\t\t\t\t\ti !== null &&\r\n\t\t\t\t\tj !== null &&\r\n\t\t\t\t\tthis.newText.tokens[i].link === null &&\r\n\t\t\t\t\tthis.oldText.tokens[j].link === null\r\n\t\t\t\t) {\r\n\r\n\t\t\t\t\t// Connect if same token\r\n\t\t\t\t\tif ( this.newText.tokens[i].token === this.oldText.tokens[j].token ) {\r\n\t\t\t\t\t\tthis.newText.tokens[i].link = j;\r\n\t\t\t\t\t\tthis.oldText.tokens[j].link = i;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Not a match yet, maybe in next refinement level\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tbordersUpNext.push( [iMatch, jMatch] );\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Next token up\r\n\t\t\t\t\tiMatch = i;\r\n\t\t\t\t\tjMatch = j;\r\n\t\t\t\t\ti = this.newText.tokens[i].prev;\r\n\t\t\t\t\tj = this.oldText.tokens[j].prev;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t/**\r\n\t\t\t * Connect adjacent identical tokens downwards from text start.\r\n\t\t\t * Treat boundary as connected, stop after first connected token.\r\n\t\t\t */\r\n\r\n\t\t\t// Only for full text diff\r\n\t\t\tif ( recursionLevel === 0 && repeating === false ) {\r\n\r\n\t\t\t\t// From start\r\n\t\t\t\tvar i = this.newText.first;\r\n\t\t\t\tvar j = this.oldText.first;\r\n\t\t\t\tvar iMatch = null;\r\n\t\t\t\tvar jMatch = null;\r\n\r\n\t\t\t\t// Cycle through old text tokens down\r\n\t\t\t\t// Connect identical tokens, stop after first connected token\r\n\t\t\t\twhile (\r\n\t\t\t\t\ti !== null &&\r\n\t\t\t\t\tj !== null &&\r\n\t\t\t\t\tthis.newText.tokens[i].link === null &&\r\n\t\t\t\t\tthis.oldText.tokens[j].link === null &&\r\n\t\t\t\t\tthis.newText.tokens[i].token === this.oldText.tokens[j].token\r\n\t\t\t\t) {\r\n\t\t\t\t\tthis.newText.tokens[i].link = j;\r\n\t\t\t\t\tthis.oldText.tokens[j].link = i;\r\n\t\t\t\t\tiMatch = i;\r\n\t\t\t\t\tjMatch = j;\r\n\t\t\t\t\ti = this.newText.tokens[i].next;\r\n\t\t\t\t\tj = this.oldText.tokens[j].next;\r\n\t\t\t\t}\r\n\t\t\t\tif ( iMatch !== null ) {\r\n\t\t\t\t\tbordersDownNext.push( [iMatch, jMatch] );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// From end\r\n\t\t\t\ti = this.newText.last;\r\n\t\t\t\tj = this.oldText.last;\r\n\t\t\t\tiMatch = null;\r\n\t\t\t\tjMatch = null;\r\n\r\n\t\t\t\t// Cycle through old text tokens up\r\n\t\t\t\t// Connect identical tokens, stop after first connected token\r\n\t\t\t\twhile (\r\n\t\t\t\t\ti !== null &&\r\n\t\t\t\t\tj !== null &&\r\n\t\t\t\t\tthis.newText.tokens[i].link === null &&\r\n\t\t\t\t\tthis.oldText.tokens[j].link === null &&\r\n\t\t\t\t\tthis.newText.tokens[i].token === this.oldText.tokens[j].token\r\n\t\t\t\t) {\r\n\t\t\t\t\tthis.newText.tokens[i].link = j;\r\n\t\t\t\t\tthis.oldText.tokens[j].link = i;\r\n\t\t\t\t\tiMatch = i;\r\n\t\t\t\t\tjMatch = j;\r\n\t\t\t\t\ti = this.newText.tokens[i].prev;\r\n\t\t\t\t\tj = this.oldText.tokens[j].prev;\r\n\t\t\t\t}\r\n\t\t\t\tif ( iMatch !== null ) {\r\n\t\t\t\t\tbordersUpNext.push( [iMatch, jMatch] );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Save updated linked region borders to object\r\n\t\t\tif ( recursionLevel === 0 && repeating === false ) {\r\n\t\t\t\tthis.bordersDown = bordersDownNext;\r\n\t\t\t\tthis.bordersUp = bordersUpNext;\r\n\t\t\t}\r\n\r\n\t\t\t// Merge local updated linked region borders into object\r\n\t\t\telse {\r\n\t\t\t\tthis.bordersDown = this.bordersDown.concat( bordersDownNext );\r\n\t\t\t\tthis.bordersUp = this.bordersUp.concat( bordersUpNext );\r\n\t\t\t}\r\n\r\n\r\n\t\t\t/**\r\n\t\t\t * Repeat once with empty symbol table to link hidden unresolved common tokens in cross-overs.\r\n\t\t\t * (\"and\" in \"and this a and b that\" -> \"and this a and b that\")\r\n\t\t\t */\r\n\r\n\t\t\tif ( repeating === false && this.config.repeatedDiff === true ) {\r\n\t\t\t\tvar repeat = true;\r\n\t\t\t\tthis.calculateDiff( level, recurse, repeat, newStart, oldStart, up, recursionLevel );\r\n\t\t\t}\r\n\r\n\t\t\t/**\r\n\t\t\t * Refine by recursively diffing not linked regions with new symbol table.\r\n\t\t\t * At word and character level only.\r\n\t\t\t * Helps against gaps caused by addition of common tokens around sequences of common tokens.\r\n\t\t\t */\r\n\r\n\t\t\tif (\r\n\t\t\t\trecurse === true &&\r\n\t\t\t\tthis.config['recursiveDiff'] === true &&\r\n\t\t\t\trecursionLevel < this.config.recursionMax\r\n\t\t\t) {\r\n\r\n\t\t\t\t/**\r\n\t\t\t\t * Recursively diff gap downwards.\r\n\t\t\t\t */\r\n\r\n\t\t\t\t// Cycle through list of linked region borders\r\n\t\t\t\tvar bordersLength = bordersDownNext.length;\r\n\t\t\t\tfor ( match = 0; match < bordersLength; match ++ ) {\r\n\t\t\t\t\tvar i = bordersDownNext[match][0];\r\n\t\t\t\t\tvar j = bordersDownNext[match][1];\r\n\r\n\t\t\t\t\t// Next token down\r\n\t\t\t\t\ti = this.newText.tokens[i].next;\r\n\t\t\t\t\tj = this.oldText.tokens[j].next;\r\n\r\n\t\t\t\t\t// Start recursion at first gap token pair\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\ti !== null &&\r\n\t\t\t\t\t\tj !== null &&\r\n\t\t\t\t\t\tthis.newText.tokens[i].link === null &&\r\n\t\t\t\t\t\tthis.oldText.tokens[j].link === null\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tvar repeat = false;\r\n\t\t\t\t\t\tvar dirUp = false;\r\n\t\t\t\t\t\tthis.calculateDiff( level, recurse, repeat, i, j, dirUp, recursionLevel + 1 );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t/**\r\n\t\t\t\t * Recursively diff gap upwards.\r\n\t\t\t\t */\r\n\r\n\t\t\t\t// Cycle through list of linked region borders\r\n\t\t\t\tvar bordersLength = bordersUpNext.length;\r\n\t\t\t\tfor ( match = 0; match < bordersLength; match ++ ) {\r\n\t\t\t\t\tvar i = bordersUpNext[match][0];\r\n\t\t\t\t\tvar j = bordersUpNext[match][1];\r\n\r\n\t\t\t\t\t// Next token up\r\n\t\t\t\t\ti = this.newText.tokens[i].prev;\r\n\t\t\t\t\tj = this.oldText.tokens[j].prev;\r\n\r\n\t\t\t\t\t// Start recursion at first gap token pair\r\n\t\t\t\t\tif (\r\n\t\t\t\t\t\ti !== null &&\r\n\t\t\t\t\t\tj !== null &&\r\n\t\t\t\t\t\tthis.newText.tokens[i].link === null &&\r\n\t\t\t\t\t\tthis.oldText.tokens[j].link === null\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tvar repeat = false;\r\n\t\t\t\t\t\tvar dirUp = true;\r\n\t\t\t\t\t\tthis.calculateDiff( level, recurse, repeat, i, j, dirUp, recursionLevel + 1 );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Stop timers\r\n\t\tif ( this.config.timer === true && repeating === false ) {\r\n\t\t\tif ( this.recursionTimer[recursionLevel] === undefined ) {\r\n\t\t\t\tthis.recursionTimer[recursionLevel] = 0;\r\n\t\t\t}\r\n\t\t\tthis.recursionTimer[recursionLevel] += this.timeEnd( level + recursionLevel, true );\r\n\t\t}\r\n\t\tif ( this.config.timer === true && repeating === false && recursionLevel === 0 ) {\r\n\t\t\tthis.timeRecursionEnd( level );\r\n\t\t\tthis.timeEnd( level );\r\n\t\t}\r\n\r\n\t\treturn;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Main method for processing raw diff data, extracting deleted, inserted, and moved blocks.\r\n\t *\r\n\t * Scheme of blocks, sections, and groups (old block numbers):\r\n\t *   Old:      1    2 3D4   5E6    7   8 9 10  11\r\n\t *             |    ‾/-/_    X     |    >|<     |\r\n\t *   New:      1  I 3D4 2  E6 5  N 7  10 9  8  11\r\n\t *   Section:       0 0 0   1 1       2 2  2\r\n\t *   Group:    0 10 111 2  33 4 11 5   6 7  8   9\r\n\t *   Fixed:    .    +++ -  ++ -    .   . -  -   +\r\n\t *   Type:     =  . =-= =  -= =  . =   = =  =   =\r\n\t *\r\n\t * @param[out] array groups Groups table object\r\n\t * @param[out] array blocks Blocks table object\r\n\t * @param[in/out] WikEdDiffText newText, oldText Text object tokens list\r\n\t */\r\n\tthis.detectBlocks = function () {\r\n\r\n\t\t// Debug log\r\n\t\tif ( this.config.debug === true ) {\r\n\t\t\tthis.oldText.debugText( 'Old text' );\r\n\t\t\tthis.newText.debugText( 'New text' );\r\n\t\t}\r\n\r\n\t\t// Collect identical corresponding ('=') blocks from old text and sort by new text\r\n\t\tthis.getSameBlocks();\r\n\r\n\t\t// Collect independent block sections with no block move crosses outside a section\r\n\t\tthis.getSections();\r\n\r\n\t\t// Find groups of continuous old text blocks\r\n\t\tthis.getGroups();\r\n\r\n\t\t// Set longest sequence of increasing groups in sections as fixed (not moved)\r\n\t\tthis.setFixed();\r\n\r\n\t\t// Convert groups to insertions/deletions if maximum block length is too short\r\n\t\t// Only for more complex texts that actually have blocks of minimum block length\r\n\t\tvar unlinkCount = 0;\r\n\t\tif (\r\n\t\t\tthis.config.unlinkBlocks === true &&\r\n\t\t\tthis.config.blockMinLength > 0 &&\r\n\t\t\tthis.maxWords >= this.config.blockMinLength\r\n\t\t) {\r\n\t\t\tif ( this.config.timer === true ) {\r\n\t\t\t\tthis.time( 'total unlinking' );\r\n\t\t\t}\r\n\r\n\t\t\t// Repeat as long as unlinking is possible\r\n\t\t\tvar unlinked = true;\r\n\t\t\twhile ( unlinked === true && unlinkCount < this.config.unlinkMax ) {\r\n\r\n\t\t\t\t// Convert '=' to '+'/'-' pairs\r\n\t\t\t\tunlinked = this.unlinkBlocks();\r\n\r\n\t\t\t\t// Start over after conversion\r\n\t\t\t\tif ( unlinked === true ) {\r\n\t\t\t\t\tunlinkCount ++;\r\n\t\t\t\t\tthis.slideGaps( this.newText, this.oldText );\r\n\t\t\t\t\tthis.slideGaps( this.oldText, this.newText );\r\n\r\n\t\t\t\t\t// Repeat block detection from start\r\n\t\t\t\t\tthis.maxWords = 0;\r\n\t\t\t\t\tthis.getSameBlocks();\r\n\t\t\t\t\tthis.getSections();\r\n\t\t\t\t\tthis.getGroups();\r\n\t\t\t\t\tthis.setFixed();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif ( this.config.timer === true ) {\r\n\t\t\t\tthis.timeEnd( 'total unlinking' );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Collect deletion ('-') blocks from old text\r\n\t\tthis.getDelBlocks();\r\n\r\n\t\t// Position '-' blocks into new text order\r\n\t\tthis.positionDelBlocks();\r\n\r\n\t\t// Collect insertion ('+') blocks from new text\r\n\t\tthis.getInsBlocks();\r\n\r\n\t\t// Set group numbers of '+' blocks\r\n\t\tthis.setInsGroups();\r\n\r\n\t\t// Mark original positions of moved groups\r\n\t\tthis.insertMarks();\r\n\r\n\t\t// Debug log\r\n\t\tif ( this.config.timer === true || this.config.debug === true ) {\r\n\t\t\tconsole.log( 'Unlink count: ', unlinkCount );\r\n\t\t}\r\n\t\tif ( this.config.debug === true ) {\r\n\t\t\tthis.debugGroups( 'Groups' );\r\n\t\t\tthis.debugBlocks( 'Blocks' );\r\n\t\t}\r\n\t\treturn;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Collect identical corresponding matching ('=') blocks from old text and sort by new text.\r\n\t *\r\n\t * @param[in] WikEdDiffText newText, oldText Text objects\r\n\t * @param[in/out] array blocks Blocks table object\r\n\t */\r\n\tthis.getSameBlocks = function () {\r\n\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.time( 'getSameBlocks' );\r\n\t\t}\r\n\r\n\t\tvar blocks = this.blocks;\r\n\r\n\t\t// Clear blocks array\r\n\t\tblocks.splice( 0 );\r\n\r\n\t\t// Cycle through old text to find connected (linked, matched) blocks\r\n\t\tvar j = this.oldText.first;\r\n\t\tvar i = null;\r\n\t\twhile ( j !== null ) {\r\n\r\n\t\t\t// Skip '-' blocks\r\n\t\t\twhile ( j !== null && this.oldText.tokens[j].link === null ) {\r\n\t\t\t\tj = this.oldText.tokens[j].next;\r\n\t\t\t}\r\n\r\n\t\t\t// Get '=' block\r\n\t\t\tif ( j !== null ) {\r\n\t\t\t\ti = this.oldText.tokens[j].link;\r\n\t\t\t\tvar iStart = i;\r\n\t\t\t\tvar jStart = j;\r\n\r\n\t\t\t\t// Detect matching blocks ('=')\r\n\t\t\t\tvar count = 0;\r\n\t\t\t\tvar unique = false;\r\n\t\t\t\tvar text = '';\r\n\t\t\t\twhile ( i !== null && j !== null && this.oldText.tokens[j].link === i ) {\r\n\t\t\t\t\ttext += this.oldText.tokens[j].token;\r\n\t\t\t\t\tcount ++;\r\n\t\t\t\t\tif ( this.newText.tokens[i].unique === true ) {\r\n\t\t\t\t\t\tunique = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t\ti = this.newText.tokens[i].next;\r\n\t\t\t\t\tj = this.oldText.tokens[j].next;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Save old text '=' block\r\n\t\t\t\tblocks.push( {\r\n\t\t\t\t\toldBlock:  blocks.length,\r\n\t\t\t\t\tnewBlock:  null,\r\n\t\t\t\t\toldNumber: this.oldText.tokens[jStart].number,\r\n\t\t\t\t\tnewNumber: this.newText.tokens[iStart].number,\r\n\t\t\t\t\toldStart:  jStart,\r\n\t\t\t\t\tcount:     count,\r\n\t\t\t\t\tunique:    unique,\r\n\t\t\t\t\twords:     this.wordCount( text ),\r\n\t\t\t\t\tchars:     text.length,\r\n\t\t\t\t\ttype:      '=',\r\n\t\t\t\t\tsection:   null,\r\n\t\t\t\t\tgroup:     null,\r\n\t\t\t\t\tfixed:     null,\r\n\t\t\t\t\tmoved:     null,\r\n\t\t\t\t\ttext:      text\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Sort blocks by new text token number\r\n\t\tblocks.sort( function( a, b ) {\r\n\t\t\treturn a.newNumber - b.newNumber;\r\n\t\t} );\r\n\r\n\t\t// Number blocks in new text order\r\n\t\tvar blocksLength = blocks.length;\r\n\t\tfor ( var block = 0; block < blocksLength; block ++ ) {\r\n\t\t\tblocks[block].newBlock = block;\r\n\t\t}\r\n\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.timeEnd( 'getSameBlocks' );\r\n\t\t}\r\n\t\treturn;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Collect independent block sections with no block move crosses\r\n\t * outside a section for per-section determination of non-moving fixed groups.\r\n\t *\r\n\t * @param[out] array sections Sections table object\r\n\t * @param[in/out] array blocks Blocks table object, section property\r\n\t */\r\n\tthis.getSections = function () {\r\n\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.time( 'getSections' );\r\n\t\t}\r\n\r\n\t\tvar blocks = this.blocks;\r\n\t\tvar sections = this.sections;\r\n\r\n\t\t// Clear sections array\r\n\t\tsections.splice( 0 );\r\n\r\n\t\t// Cycle through blocks\r\n\t\tvar blocksLength = blocks.length;\r\n\t\tfor ( var block = 0; block < blocksLength; block ++ ) {\r\n\r\n\t\t\tvar sectionStart = block;\r\n\t\t\tvar sectionEnd = block;\r\n\r\n\t\t\tvar oldMax = blocks[sectionStart].oldNumber;\r\n\t\t\tvar sectionOldMax = oldMax;\r\n\r\n\t\t\t// Check right\r\n\t\t\tfor ( var j = sectionStart + 1; j < blocksLength; j ++ ) {\r\n\r\n\t\t\t\t// Check for crossing over to the left\r\n\t\t\t\tif ( blocks[j].oldNumber > oldMax ) {\r\n\t\t\t\t\toldMax = blocks[j].oldNumber;\r\n\t\t\t\t}\r\n\t\t\t\telse if ( blocks[j].oldNumber < sectionOldMax ) {\r\n\t\t\t\t\tsectionEnd = j;\r\n\t\t\t\t\tsectionOldMax = oldMax;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Save crossing sections\r\n\t\t\tif ( sectionEnd > sectionStart ) {\r\n\r\n\t\t\t\t// Save section to block\r\n\t\t\t\tfor ( var i = sectionStart; i <= sectionEnd; i ++ ) {\r\n\t\t\t\t\tblocks[i].section = sections.length;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Save section\r\n\t\t\t\tsections.push( {\r\n\t\t\t\t\tblockStart:  sectionStart,\r\n\t\t\t\t\tblockEnd:    sectionEnd\r\n\t\t\t\t} );\r\n\t\t\t\tblock = sectionEnd;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.timeEnd( 'getSections' );\r\n\t\t}\r\n\t\treturn;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Find groups of continuous old text blocks.\r\n\t *\r\n\t * @param[out] array groups Groups table object\r\n\t * @param[in/out] array blocks Blocks table object, group property\r\n\t */\r\n\tthis.getGroups = function () {\r\n\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.time( 'getGroups' );\r\n\t\t}\r\n\r\n\t\tvar blocks = this.blocks;\r\n\t\tvar groups = this.groups;\r\n\r\n\t\t// Clear groups array\r\n\t\tgroups.splice( 0 );\r\n\r\n\t\t// Cycle through blocks\r\n\t\tvar blocksLength = blocks.length;\r\n\t\tfor ( var block = 0; block < blocksLength; block ++ ) {\r\n\t\t\tvar groupStart = block;\r\n\t\t\tvar groupEnd = block;\r\n\t\t\tvar oldBlock = blocks[groupStart].oldBlock;\r\n\r\n\t\t\t// Get word and char count of block\r\n\t\t\tvar words = this.wordCount( blocks[block].text );\r\n\t\t\tvar maxWords = words;\r\n\t\t\tvar unique = blocks[block].unique;\r\n\t\t\tvar chars = blocks[block].chars;\r\n\r\n\t\t\t// Check right\r\n\t\t\tfor ( var i = groupEnd + 1; i < blocksLength; i ++ ) {\r\n\r\n\t\t\t\t// Check for crossing over to the left\r\n\t\t\t\tif ( blocks[i].oldBlock !== oldBlock + 1 ) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\toldBlock = blocks[i].oldBlock;\r\n\r\n\t\t\t\t// Get word and char count of block\r\n\t\t\t\tif ( blocks[i].words > maxWords ) {\r\n\t\t\t\t\tmaxWords = blocks[i].words;\r\n\t\t\t\t}\r\n\t\t\t\tif ( blocks[i].unique === true ) {\r\n\t\t\t\t\tunique = true;\r\n\t\t\t\t}\r\n\t\t\t\twords += blocks[i].words;\r\n\t\t\t\tchars += blocks[i].chars;\r\n\t\t\t\tgroupEnd = i;\r\n\t\t\t}\r\n\r\n\t\t\t// Save crossing group\r\n\t\t\tif ( groupEnd >= groupStart ) {\r\n\r\n\t\t\t\t// Set groups outside sections as fixed\r\n\t\t\t\tvar fixed = false;\r\n\t\t\t\tif ( blocks[groupStart].section === null ) {\r\n\t\t\t\t\tfixed = true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Save group to block\r\n\t\t\t\tfor ( var i = groupStart; i <= groupEnd; i ++ ) {\r\n\t\t\t\t\tblocks[i].group = groups.length;\r\n\t\t\t\t\tblocks[i].fixed = fixed;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Save group\r\n\t\t\t\tgroups.push( {\r\n\t\t\t\t\toldNumber:  blocks[groupStart].oldNumber,\r\n\t\t\t\t\tblockStart: groupStart,\r\n\t\t\t\t\tblockEnd:   groupEnd,\r\n\t\t\t\t\tunique:     unique,\r\n\t\t\t\t\tmaxWords:   maxWords,\r\n\t\t\t\t\twords:      words,\r\n\t\t\t\t\tchars:      chars,\r\n\t\t\t\t\tfixed:      fixed,\r\n\t\t\t\t\tmovedFrom:  null,\r\n\t\t\t\t\tcolor:      null\r\n\t\t\t\t} );\r\n\t\t\t\tblock = groupEnd;\r\n\r\n\t\t\t\t// Set global word count of longest linked block\r\n\t\t\t\tif ( maxWords > this.maxWords ) {\r\n\t\t\t\t\tthis.maxWords = maxWords;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.timeEnd( 'getGroups' );\r\n\t\t}\r\n\t\treturn;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Set longest sequence of increasing groups in sections as fixed (not moved).\r\n\t *\r\n\t * @param[in] array sections Sections table object\r\n\t * @param[in/out] array groups Groups table object, fixed property\r\n\t * @param[in/out] array blocks Blocks table object, fixed property\r\n\t */\r\n\tthis.setFixed = function () {\r\n\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.time( 'setFixed' );\r\n\t\t}\r\n\r\n\t\tvar blocks = this.blocks;\r\n\t\tvar groups = this.groups;\r\n\t\tvar sections = this.sections;\r\n\r\n\t\t// Cycle through sections\r\n\t\tvar sectionsLength = sections.length;\r\n\t\tfor ( var section = 0; section < sectionsLength; section ++ ) {\r\n\t\t\tvar blockStart = sections[section].blockStart;\r\n\t\t\tvar blockEnd = sections[section].blockEnd;\r\n\r\n\t\t\tvar groupStart = blocks[blockStart].group;\r\n\t\t\tvar groupEnd = blocks[blockEnd].group;\r\n\r\n\t\t\t// Recusively find path of groups in increasing old group order with longest char length\r\n\t\t\tvar cache = [];\r\n\t\t\tvar maxChars = 0;\r\n\t\t\tvar maxPath = null;\r\n\r\n\t\t\t// Start at each group of section\r\n\t\t\tfor ( var i = groupStart; i <= groupEnd; i ++ ) {\r\n\t\t\t\tvar pathObj = this.findMaxPath( i, groupEnd, cache );\r\n\t\t\t\tif ( pathObj.chars > maxChars ) {\r\n\t\t\t\t\tmaxPath = pathObj.path;\r\n\t\t\t\t\tmaxChars = pathObj.chars;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Mark fixed groups\r\n\t\t\tvar maxPathLength = maxPath.length;\r\n\t\t\tfor ( var i = 0; i < maxPathLength; i ++ ) {\r\n\t\t\t\tvar group = maxPath[i];\r\n\t\t\t\tgroups[group].fixed = true;\r\n\r\n\t\t\t\t// Mark fixed blocks\r\n\t\t\t\tfor ( var block = groups[group].blockStart; block <= groups[group].blockEnd; block ++ ) {\r\n\t\t\t\t\tblocks[block].fixed = true;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.timeEnd( 'setFixed' );\r\n\t\t}\r\n\t\treturn;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Recusively find path of groups in increasing old group order with longest char length.\r\n\t *\r\n\t * @param int start Path start group\r\n\t * @param int groupEnd Path last group\r\n\t * @param array cache Cache object, contains returnObj for start\r\n\t * @return array returnObj Contains path and char length\r\n\t */\r\n\tthis.findMaxPath = function ( start, groupEnd, cache ) {\r\n\r\n\t\tvar groups = this.groups;\r\n\r\n\t\t// Find longest sub-path\r\n\t\tvar maxChars = 0;\r\n\t\tvar oldNumber = groups[start].oldNumber;\r\n\t\tvar returnObj = { path: [], chars: 0};\r\n\t\tfor ( var i = start + 1; i <= groupEnd; i ++ ) {\r\n\r\n\t\t\t// Only in increasing old group order\r\n\t\t\tif ( groups[i].oldNumber < oldNumber ) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\t// Get longest sub-path from cache (deep copy)\r\n\t\t\tvar pathObj;\r\n\t\t\tif ( cache[i] !== undefined ) {\r\n\t\t\t\tpathObj = { path: cache[i].path.slice(), chars: cache[i].chars };\r\n\t\t\t}\r\n\r\n\t\t\t// Get longest sub-path by recursion\r\n\t\t\telse {\r\n\t\t\t\tpathObj = this.findMaxPath( i, groupEnd, cache );\r\n\t\t\t}\r\n\r\n\t\t\t// Select longest sub-path\r\n\t\t\tif ( pathObj.chars > maxChars ) {\r\n\t\t\t\tmaxChars = pathObj.chars;\r\n\t\t\t\treturnObj = pathObj;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Add current start to path\r\n\t\treturnObj.path.unshift( start );\r\n\t\treturnObj.chars += groups[start].chars;\r\n\r\n\t\t// Save path to cache (deep copy)\r\n\t\tif ( cache[start] === undefined ) {\r\n\t\t\tcache[start] = { path: returnObj.path.slice(), chars: returnObj.chars };\r\n\t\t}\r\n\r\n\t\treturn returnObj;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Convert matching '=' blocks in groups into insertion/deletion ('+'/'-') pairs\r\n\t * if too short and too common.\r\n\t * Prevents fragmentated diffs for very different versions.\r\n\t *\r\n\t * @param[in] array blocks Blocks table object\r\n\t * @param[in/out] WikEdDiffText newText, oldText Text object, linked property\r\n\t * @param[in/out] array groups Groups table object\r\n\t * @return bool True if text tokens were unlinked\r\n\t */\r\n\tthis.unlinkBlocks = function () {\r\n\r\n\t\tvar blocks = this.blocks;\r\n\t\tvar groups = this.groups;\r\n\r\n\t\t// Cycle through groups\r\n\t\tvar unlinked = false;\r\n\t\tvar groupsLength = groups.length;\r\n\t\tfor ( var group = 0; group < groupsLength; group ++ ) {\r\n\t\t\tvar blockStart = groups[group].blockStart;\r\n\t\t\tvar blockEnd = groups[group].blockEnd;\r\n\r\n\t\t\t// Unlink whole group if no block is at least blockMinLength words long and unique\r\n\t\t\tif ( groups[group].maxWords < this.config.blockMinLength && groups[group].unique === false ) {\r\n\t\t\t\tfor ( var block = blockStart; block <= blockEnd; block ++ ) {\r\n\t\t\t\t\tif ( blocks[block].type === '=' ) {\r\n\t\t\t\t\t\tthis.unlinkSingleBlock( blocks[block] );\r\n\t\t\t\t\t\tunlinked = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Otherwise unlink block flanks\r\n\t\t\telse {\r\n\r\n\t\t\t\t// Unlink blocks from start\r\n\t\t\t\tfor ( var block = blockStart; block <= blockEnd; block ++ ) {\r\n\t\t\t\t\tif ( blocks[block].type === '=' ) {\r\n\r\n\t\t\t\t\t\t// Stop unlinking if more than one word or a unique word\r\n\t\t\t\t\t\tif ( blocks[block].words > 1 || blocks[block].unique === true ) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.unlinkSingleBlock( blocks[block] );\r\n\t\t\t\t\t\tunlinked = true;\r\n\t\t\t\t\t\tblockStart = block;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Unlink blocks from end\r\n\t\t\t\tfor ( var block = blockEnd; block > blockStart; block -- ) {\r\n\t\t\t\t\tif ( blocks[block].type === '=' ) {\r\n\r\n\t\t\t\t\t\t// Stop unlinking if more than one word or a unique word\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\tblocks[block].words > 1 ||\r\n\t\t\t\t\t\t\t( blocks[block].words === 1 && blocks[block].unique === true )\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.unlinkSingleBlock( blocks[block] );\r\n\t\t\t\t\t\tunlinked = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn unlinked;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Unlink text tokens of single block, convert them into into insertion/deletion ('+'/'-') pairs.\r\n\t *\r\n\t * @param[in] array blocks Blocks table object\r\n\t * @param[out] WikEdDiffText newText, oldText Text objects, link property\r\n\t */\r\n\tthis.unlinkSingleBlock = function ( block ) {\r\n\r\n\t\t// Cycle through old text\r\n\t\tvar j = block.oldStart;\r\n\t\tfor ( var count = 0; count < block.count; count ++ ) {\r\n\r\n\t\t\t// Unlink tokens\r\n\t\t\tthis.newText.tokens[ this.oldText.tokens[j].link ].link = null;\r\n\t\t\tthis.oldText.tokens[j].link = null;\r\n\t\t\tj = this.oldText.tokens[j].next;\r\n\t\t}\r\n\t\treturn;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Collect deletion ('-') blocks from old text.\r\n\t *\r\n\t * @param[in] WikEdDiffText oldText Old Text object\r\n\t * @param[out] array blocks Blocks table object\r\n\t */\r\n\tthis.getDelBlocks = function () {\r\n\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.time( 'getDelBlocks' );\r\n\t\t}\r\n\r\n\t\tvar blocks = this.blocks;\r\n\r\n\t\t// Cycle through old text to find connected (linked, matched) blocks\r\n\t\tvar j = this.oldText.first;\r\n\t\tvar i = null;\r\n\t\twhile ( j !== null ) {\r\n\r\n\t\t\t// Collect '-' blocks\r\n\t\t\tvar oldStart = j;\r\n\t\t\tvar count = 0;\r\n\t\t\tvar text = '';\r\n\t\t\twhile ( j !== null && this.oldText.tokens[j].link === null ) {\r\n\t\t\t\tcount ++;\r\n\t\t\t\ttext += this.oldText.tokens[j].token;\r\n\t\t\t\tj = this.oldText.tokens[j].next;\r\n\t\t\t}\r\n\r\n\t\t\t// Save old text '-' block\r\n\t\t\tif ( count !== 0 ) {\r\n\t\t\t\tblocks.push( {\r\n\t\t\t\t\toldBlock:  null,\r\n\t\t\t\t\tnewBlock:  null,\r\n\t\t\t\t\toldNumber: this.oldText.tokens[oldStart].number,\r\n\t\t\t\t\tnewNumber: null,\r\n\t\t\t\t\toldStart:  oldStart,\r\n\t\t\t\t\tcount:     count,\r\n\t\t\t\t\tunique:    false,\r\n\t\t\t\t\twords:     null,\r\n\t\t\t\t\tchars:     text.length,\r\n\t\t\t\t\ttype:      '-',\r\n\t\t\t\t\tsection:   null,\r\n\t\t\t\t\tgroup:     null,\r\n\t\t\t\t\tfixed:     null,\r\n\t\t\t\t\tmoved:     null,\r\n\t\t\t\t\ttext:      text\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\r\n\t\t\t// Skip '=' blocks\r\n\t\t\tif ( j !== null ) {\r\n\t\t\t\ti = this.oldText.tokens[j].link;\r\n\t\t\t\twhile ( i !== null && j !== null && this.oldText.tokens[j].link === i ) {\r\n\t\t\t\t\ti = this.newText.tokens[i].next;\r\n\t\t\t\t\tj = this.oldText.tokens[j].next;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.timeEnd( 'getDelBlocks' );\r\n\t\t}\r\n\t\treturn;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Position deletion '-' blocks into new text order.\r\n\t * Deletion blocks move with fixed reference:\r\n\t *   Old:          1 D 2      1 D 2\r\n\t *                /     \\    /   \\ \\\r\n\t *   New:        1 D     2  1     D 2\r\n\t *   Fixed:      *                  *\r\n\t *   newNumber:  1 1              2 2\r\n\t *\r\n\t * Marks '|' and deletions '-' get newNumber of reference block\r\n\t * and are sorted around it by old text number.\r\n\t *\r\n\t * @param[in/out] array blocks Blocks table, newNumber, section, group, and fixed properties\r\n\t *\r\n\t */\r\n\tthis.positionDelBlocks = function () {\r\n\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.time( 'positionDelBlocks' );\r\n\t\t}\r\n\r\n\t\tvar blocks = this.blocks;\r\n\t\tvar groups = this.groups;\r\n\r\n\t\t// Sort shallow copy of blocks by oldNumber\r\n\t\tvar blocksOld = blocks.slice();\r\n\t\tblocksOld.sort( function( a, b ) {\r\n\t\t\treturn a.oldNumber - b.oldNumber;\r\n\t\t} );\r\n\r\n\t\t// Cycle through blocks in old text order\r\n\t\tvar blocksOldLength = blocksOld.length;\r\n\t\tfor ( var block = 0; block < blocksOldLength; block ++ ) {\r\n\t\t\tvar delBlock = blocksOld[block];\r\n\r\n\t\t\t// '-' block only\r\n\t\t\tif ( delBlock.type !== '-' ) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\t// Find fixed '=' reference block from original block position to position '-' block\r\n\t\t\t// Similar to position marks '|' code\r\n\r\n\t\t\t// Get old text prev block\r\n\t\t\tvar prevBlockNumber = null;\r\n\t\t\tvar prevBlock = null;\r\n\t\t\tif ( block > 0 ) {\r\n\t\t\t\tprevBlockNumber = blocksOld[block - 1].newBlock;\r\n\t\t\t\tprevBlock = blocks[prevBlockNumber];\r\n\t\t\t}\r\n\r\n\t\t\t// Get old text next block\r\n\t\t\tvar nextBlockNumber = null;\r\n\t\t\tvar nextBlock = null;\r\n\t\t\tif ( block < blocksOld.length - 1 ) {\r\n\t\t\t\tnextBlockNumber = blocksOld[block + 1].newBlock;\r\n\t\t\t\tnextBlock = blocks[nextBlockNumber];\r\n\t\t\t}\r\n\r\n\t\t\t// Move after prev block if fixed\r\n\t\t\tvar refBlock = null;\r\n\t\t\tif ( prevBlock !== null && prevBlock.type === '=' && prevBlock.fixed === true ) {\r\n\t\t\t\trefBlock = prevBlock;\r\n\t\t\t}\r\n\r\n\t\t\t// Move before next block if fixed\r\n\t\t\telse if ( nextBlock !== null && nextBlock.type === '=' && nextBlock.fixed === true ) {\r\n\t\t\t\trefBlock = nextBlock;\r\n\t\t\t}\r\n\r\n\t\t\t// Move after prev block if not start of group\r\n\t\t\telse if (\r\n\t\t\t\tprevBlock !== null &&\r\n\t\t\t\tprevBlock.type === '=' &&\r\n\t\t\t\tprevBlockNumber !== groups[ prevBlock.group ].blockEnd\r\n\t\t\t) {\r\n\t\t\t\trefBlock = prevBlock;\r\n\t\t\t}\r\n\r\n\t\t\t// Move before next block if not start of group\r\n\t\t\telse if (\r\n\t\t\t\tnextBlock !== null &&\r\n\t\t\t\tnextBlock.type === '=' &&\r\n\t\t\t\tnextBlockNumber !== groups[ nextBlock.group ].blockStart\r\n\t\t\t) {\r\n\t\t\t\trefBlock = nextBlock;\r\n\t\t\t}\r\n\r\n\t\t\t// Move after closest previous fixed block\r\n\t\t\telse {\r\n\t\t\t\tfor ( var fixed = block; fixed >= 0; fixed -- ) {\r\n\t\t\t\t\tif ( blocksOld[fixed].type === '=' && blocksOld[fixed].fixed === true ) {\r\n\t\t\t\t\t\trefBlock = blocksOld[fixed];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Move before first block\r\n\t\t\tif ( refBlock === null ) {\r\n\t\t\t\tdelBlock.newNumber =  -1;\r\n\t\t\t}\r\n\r\n\t\t\t// Update '-' block data\r\n\t\t\telse {\r\n\t\t\t\tdelBlock.newNumber = refBlock.newNumber;\r\n\t\t\t\tdelBlock.section = refBlock.section;\r\n\t\t\t\tdelBlock.group = refBlock.group;\r\n\t\t\t\tdelBlock.fixed = refBlock.fixed;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Sort '-' blocks in and update groups\r\n\t\tthis.sortBlocks();\r\n\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.timeEnd( 'positionDelBlocks' );\r\n\t\t}\r\n\t\treturn;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Collect insertion ('+') blocks from new text.\r\n\t *\r\n\t * @param[in] WikEdDiffText newText New Text object\r\n\t * @param[out] array blocks Blocks table object\r\n\t */\r\n\tthis.getInsBlocks = function () {\r\n\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.time( 'getInsBlocks' );\r\n\t\t}\r\n\r\n\t\tvar blocks = this.blocks;\r\n\r\n\t\t// Cycle through new text to find insertion blocks\r\n\t\tvar i = this.newText.first;\r\n\t\twhile ( i !== null ) {\r\n\r\n\t\t\t// Jump over linked (matched) block\r\n\t\t\twhile ( i !== null && this.newText.tokens[i].link !== null ) {\r\n\t\t\t\ti = this.newText.tokens[i].next;\r\n\t\t\t}\r\n\r\n\t\t\t// Detect insertion blocks ('+')\r\n\t\t\tif ( i !== null ) {\r\n\t\t\t\tvar iStart = i;\r\n\t\t\t\tvar count = 0;\r\n\t\t\t\tvar text = '';\r\n\t\t\t\tvar pushBlock = (block) => {\r\n\t\t\t\t\tvar blockInfo = Object.assign({\r\n\t\t\t\t\t\toldBlock:  null,\r\n\t\t\t\t\t\tnewBlock:  null,\r\n\t\t\t\t\t\toldNumber: null,\r\n\t\t\t\t\t\tnewNumber: this.newText.tokens[iStart].number,\r\n\t\t\t\t\t\toldStart:  null,\r\n\t\t\t\t\t\tcount:     0,\r\n\t\t\t\t\t\tunique:    false,\r\n\t\t\t\t\t\twords:     null,\r\n\t\t\t\t\t\tchars:     0,\r\n\t\t\t\t\t\ttype:      '+',\r\n\t\t\t\t\t\tsection:   null,\r\n\t\t\t\t\t\tgroup:     null,\r\n\t\t\t\t\t\tfixed:     null,\r\n\t\t\t\t\t\tmoved:     null,\r\n\t\t\t\t\t\ttext:      ''\r\n\t\t\t\t\t}, block);\r\n\t\t\t\t\tblocks.push(blockInfo);\r\n\t\t\t\t};\r\n\t\t\t\twhile ( i !== null && this.newText.tokens[i].link === null ) {\r\n\t\t\t\t\ttext += this.newText.tokens[i].token;\r\n\t\t\t\t\ti = this.newText.tokens[i].next;\r\n\r\n\t\t\t\t\tvar match = this.config.regExp.refillChange.exec(text);\r\n\t\t\t\t\tif ( match ) {\r\n\t\t\t\t\t\tif ( match.index !== 0 ) {\r\n\t\t\t\t\t\t\tvar start = text.substring(0, match.index);\r\n\t\t\t\t\t\t\tpushBlock({\r\n\t\t\t\t\t\t\t\tcount: ++count,\r\n\t\t\t\t\t\t\t\tchars: start.length,\r\n\t\t\t\t\t\t\t\ttext: start,\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvar mid = text.substring(match.index, match.index + match[0].length);\r\n\t\t\t\t\t\tpushBlock({\r\n\t\t\t\t\t\t\tcount: ++count,\r\n\t\t\t\t\t\t\tchars: mid.length,\r\n\t\t\t\t\t\t\ttext: mid,\r\n\t\t\t\t\t\t\ttype: 'r',\r\n\t\t\t\t\t\t\tmarkerType: match[1],\r\n\t\t\t\t\t\t\tid: match[2],\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tif ( match.index + match[0].length < text.length ) {\r\n\t\t\t\t\t\t\tvar end = text.substring(match.index, match[0].length);\r\n\t\t\t\t\t\t\tpushBlock({\r\n\t\t\t\t\t\t\t\tcount: ++count,\r\n\t\t\t\t\t\t\t\tchars: end.length,\r\n\t\t\t\t\t\t\t\ttext: end,\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\ttext = '';\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tpushBlock({\r\n\t\t\t\t\tcount: ++count,\r\n\t\t\t\t\tchars: text.length,\r\n\t\t\t\t\ttext: text,\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Sort '+' blocks in and update groups\r\n\t\tthis.sortBlocks();\r\n\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.timeEnd( 'getInsBlocks' );\r\n\t\t}\r\n\t\treturn;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Sort blocks by new text token number and update groups.\r\n\t *\r\n\t * @param[in/out] array groups Groups table object\r\n\t * @param[in/out] array blocks Blocks table object\r\n\t */\r\n\tthis.sortBlocks = function () {\r\n\r\n\t\tvar blocks = this.blocks;\r\n\t\tvar groups = this.groups;\r\n\r\n\t\t// Sort by newNumber, then by old number\r\n\t\tblocks.sort( function( a, b ) {\r\n\t\t\tvar comp = a.newNumber - b.newNumber;\r\n\t\t\tif ( comp === 0 ) {\r\n\t\t\t\tcomp = a.oldNumber - b.oldNumber;\r\n\t\t\t}\r\n\t\t\treturn comp;\r\n\t\t} );\r\n\r\n\t\t// Cycle through blocks and update groups with new block numbers\r\n\t\tvar group = null;\r\n\t\tvar blocksLength = blocks.length;\r\n\t\tfor ( var block = 0; block < blocksLength; block ++ ) {\r\n\t\t\tvar blockGroup = blocks[block].group;\r\n\t\t\tif ( blockGroup !== null ) {\r\n\t\t\t\tif ( blockGroup !== group ) {\r\n\t\t\t\t\tgroup = blocks[block].group;\r\n\t\t\t\t\tgroups[group].blockStart = block;\r\n\t\t\t\t\tgroups[group].oldNumber = blocks[block].oldNumber;\r\n\t\t\t\t}\r\n\t\t\t\tgroups[blockGroup].blockEnd = block;\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Set group numbers of insertion '+' blocks.\r\n\t *\r\n\t * @param[in/out] array groups Groups table object\r\n\t * @param[in/out] array blocks Blocks table object, fixed and group properties\r\n\t */\r\n\tthis.setInsGroups = function () {\r\n\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.time( 'setInsGroups' );\r\n\t\t}\r\n\r\n\t\tvar blocks = this.blocks;\r\n\t\tvar groups = this.groups;\r\n\r\n\t\t// Set group numbers of '+' blocks inside existing groups\r\n\t\tvar groupsLength = groups.length;\r\n\t\tfor ( var group = 0; group < groupsLength; group ++ ) {\r\n\t\t\tvar fixed = groups[group].fixed;\r\n\t\t\tfor ( var block = groups[group].blockStart; block <= groups[group].blockEnd; block ++ ) {\r\n\t\t\t\tif ( blocks[block].group === null ) {\r\n\t\t\t\t\tblocks[block].group = group;\r\n\t\t\t\t\tblocks[block].fixed = fixed;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Add remaining '+' blocks to new groups\r\n\r\n\t\t// Cycle through blocks\r\n\t\tvar blocksLength = blocks.length;\r\n\t\tfor ( var block = 0; block < blocksLength; block ++ ) {\r\n\r\n\t\t\t// Skip existing groups\r\n\t\t\tif ( blocks[block].group === null ) {\r\n\t\t\t\tblocks[block].group = groups.length;\r\n\r\n\t\t\t\t// Save new single-block group\r\n\t\t\t\tgroups.push( {\r\n\t\t\t\t\toldNumber:  blocks[block].oldNumber,\r\n\t\t\t\t\tblockStart: block,\r\n\t\t\t\t\tblockEnd:   block,\r\n\t\t\t\t\tunique:     blocks[block].unique,\r\n\t\t\t\t\tmaxWords:   blocks[block].words,\r\n\t\t\t\t\twords:      blocks[block].words,\r\n\t\t\t\t\tchars:      blocks[block].chars,\r\n\t\t\t\t\tfixed:      blocks[block].fixed,\r\n\t\t\t\t\tmovedFrom:  null,\r\n\t\t\t\t\tcolor:      null\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t}\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.timeEnd( 'setInsGroups' );\r\n\t\t}\r\n\t\treturn;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Mark original positions of moved groups.\r\n\t * Scheme: moved block marks at original positions relative to fixed groups:\r\n\t *   Groups:    3       7\r\n\t *           1 <|       |     (no next smaller fixed)\r\n\t *           5  |<      |\r\n\t *              |>  5   |\r\n\t *              |   5  <|\r\n\t *              |      >|   5\r\n\t *              |       |>  9 (no next larger fixed)\r\n\t *   Fixed:     *       *\r\n\t *\r\n\t * Mark direction: groups.movedGroup.blockStart < groups.group.blockStart\r\n\t * Group side:     groups.movedGroup.oldNumber < groups.group.oldNumber\r\n\t *\r\n\t * Marks '|' and deletions '-' get newNumber of reference block\r\n\t * and are sorted around it by old text number.\r\n\t *\r\n\t * @param[in/out] array groups Groups table object, movedFrom property\r\n\t * @param[in/out] array blocks Blocks table object\r\n\t */\r\n\tthis.insertMarks = function () {\r\n\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.time( 'insertMarks' );\r\n\t\t}\r\n\r\n\t\tvar blocks = this.blocks;\r\n\t\tvar groups = this.groups;\r\n\t\tvar moved = [];\r\n\t\tvar color = 1;\r\n\r\n\t\t// Make shallow copy of blocks\r\n\t\tvar blocksOld = blocks.slice();\r\n\r\n\t\t// Enumerate copy\r\n\t\tvar blocksOldLength = blocksOld.length;\r\n\t\tfor ( var i = 0; i < blocksOldLength; i ++ ) {\r\n\t\t\tblocksOld[i].number = i;\r\n\t\t}\r\n\r\n\t\t// Sort copy by oldNumber\r\n\t\tblocksOld.sort( function( a, b ) {\r\n\t\t\tvar comp = a.oldNumber - b.oldNumber;\r\n\t\t\tif ( comp === 0 ) {\r\n\t\t\t\tcomp = a.newNumber - b.newNumber;\r\n\t\t\t}\r\n\t\t\treturn comp;\r\n\t\t} );\r\n\r\n\t\t// Create lookup table: original to sorted\r\n\t\tvar lookupSorted = [];\r\n\t\tfor ( var i = 0; i < blocksOldLength; i ++ ) {\r\n\t\t\tlookupSorted[ blocksOld[i].number ] = i;\r\n\t\t}\r\n\r\n\t\t// Cycle through groups (moved group)\r\n\t\tvar groupsLength = groups.length;\r\n\t\tfor ( var moved = 0; moved < groupsLength; moved ++ ) {\r\n\t\t\tvar movedGroup = groups[moved];\r\n\t\t\tif ( movedGroup.fixed !== false ) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\tvar movedOldNumber = movedGroup.oldNumber;\r\n\r\n\t\t\t// Find fixed '=' reference block from original block position to position '|' block\r\n\t\t\t// Similar to position deletions '-' code\r\n\r\n\t\t\t// Get old text prev block\r\n\t\t\tvar prevBlock = null;\r\n\t\t\tvar block = lookupSorted[ movedGroup.blockStart ];\r\n\t\t\tif ( block > 0 ) {\r\n\t\t\t\tprevBlock = blocksOld[block - 1];\r\n\t\t\t}\r\n\r\n\t\t\t// Get old text next block\r\n\t\t\tvar nextBlock = null;\r\n\t\t\tvar block = lookupSorted[ movedGroup.blockEnd ];\r\n\t\t\tif ( block < blocksOld.length - 1 ) {\r\n\t\t\t\tnextBlock = blocksOld[block + 1];\r\n\t\t\t}\r\n\r\n\t\t\t// Move after prev block if fixed\r\n\t\t\tvar refBlock = null;\r\n\t\t\tif ( prevBlock !== null && prevBlock.type === '=' && prevBlock.fixed === true ) {\r\n\t\t\t\trefBlock = prevBlock;\r\n\t\t\t}\r\n\r\n\t\t\t// Move before next block if fixed\r\n\t\t\telse if ( nextBlock !== null && nextBlock.type === '=' && nextBlock.fixed === true ) {\r\n\t\t\t\trefBlock = nextBlock;\r\n\t\t\t}\r\n\r\n\t\t\t// Find closest fixed block to the left\r\n\t\t\telse {\r\n\t\t\t\tfor ( var fixed = lookupSorted[ movedGroup.blockStart ] - 1; fixed >= 0; fixed -- ) {\r\n\t\t\t\t\tif ( blocksOld[fixed].type === '=' && blocksOld[fixed].fixed === true ) {\r\n\t\t\t\t\t\trefBlock = blocksOld[fixed];\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Get position of new mark block\r\n\t\t\tvar newNumber;\r\n\t\t\tvar markGroup;\r\n\r\n\t\t\t// No smaller fixed block, moved right from before first block\r\n\t\t\tif ( refBlock === null ) {\r\n\t\t\t\tnewNumber = -1;\r\n\t\t\t\tmarkGroup = groups.length;\r\n\r\n\t\t\t\t// Save new single-mark-block group\r\n\t\t\t\tgroups.push( {\r\n\t\t\t\t\toldNumber:  0,\r\n\t\t\t\t\tblockStart: blocks.length,\r\n\t\t\t\t\tblockEnd:   blocks.length,\r\n\t\t\t\t\tunique:     false,\r\n\t\t\t\t\tmaxWords:   null,\r\n\t\t\t\t\twords:      null,\r\n\t\t\t\t\tchars:      0,\r\n\t\t\t\t\tfixed:      null,\r\n\t\t\t\t\tmovedFrom:  null,\r\n\t\t\t\t\tcolor:      null\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tnewNumber = refBlock.newNumber;\r\n\t\t\t\tmarkGroup = refBlock.group;\r\n\t\t\t}\r\n\r\n\t\t\t// Insert '|' block\r\n\t\t\tblocks.push( {\r\n\t\t\t\toldBlock:  null,\r\n\t\t\t\tnewBlock:  null,\r\n\t\t\t\toldNumber: movedOldNumber,\r\n\t\t\t\tnewNumber: newNumber,\r\n\t\t\t\toldStart:  null,\r\n\t\t\t\tcount:     null,\r\n\t\t\t\tunique:    null,\r\n\t\t\t\twords:     null,\r\n\t\t\t\tchars:     0,\r\n\t\t\t\ttype:      '|',\r\n\t\t\t\tsection:   null,\r\n\t\t\t\tgroup:     markGroup,\r\n\t\t\t\tfixed:     true,\r\n\t\t\t\tmoved:     moved,\r\n\t\t\t\ttext:      ''\r\n\t\t\t} );\r\n\r\n\t\t\t// Set group color\r\n\t\t\tmovedGroup.color = color;\r\n\t\t\tmovedGroup.movedFrom = markGroup;\r\n\t\t\tcolor ++;\r\n\t\t}\r\n\r\n\t\t// Sort '|' blocks in and update groups\r\n\t\tthis.sortBlocks();\r\n\r\n\t\tif ( this.config.timer === true ) {\r\n\t\t\tthis.timeEnd( 'insertMarks' );\r\n\t\t}\r\n\t\treturn;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Collect diff fragment list for markup, create abstraction layer for customized diffs.\r\n\t * Adds the following fagment types:\r\n\t *   '=', '-', '+'   same, deletion, insertion\r\n\t *   '<', '>'        mark left, mark right\r\n\t *   '(<', '(>', ')' block start and end\r\n\t *   '[', ']'        fragment start and end\r\n\t *   '{', '}'        container start and end\r\n\t *\r\n\t * @param[in] array groups Groups table object\r\n\t * @param[in] array blocks Blocks table object\r\n\t * @param[out] array fragments Fragments array, abstraction layer for diff code\r\n\t */\r\n\tthis.getDiffFragments = function () {\r\n\r\n\t\tvar blocks = this.blocks;\r\n\t\tvar groups = this.groups;\r\n\t\tvar fragments = this.fragments;\r\n\r\n\t\t// Make shallow copy of groups and sort by blockStart\r\n\t\tvar groupsSort = groups.slice();\r\n\t\tgroupsSort.sort( function( a, b ) {\r\n\t\t\treturn a.blockStart - b.blockStart;\r\n\t\t} );\r\n\r\n\t\t// Cycle through groups\r\n\t\tvar groupsSortLength = groupsSort.length;\r\n\t\tfor ( var group = 0; group < groupsSortLength; group ++ ) {\r\n\t\t\tvar blockStart = groupsSort[group].blockStart;\r\n\t\t\tvar blockEnd = groupsSort[group].blockEnd;\r\n\r\n\t\t\t// Add moved block start\r\n\t\t\tvar color = groupsSort[group].color;\r\n\t\t\tif ( color !== null ) {\r\n\t\t\t\tvar type;\r\n\t\t\t\tif ( groupsSort[group].movedFrom < blocks[ blockStart ].group ) {\r\n\t\t\t\t\ttype = '(<';\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\ttype = '(>';\r\n\t\t\t\t}\r\n\t\t\t\tfragments.push( {\r\n\t\t\t\t\ttext:  '',\r\n\t\t\t\t\ttype:  type,\r\n\t\t\t\t\tcolor: color\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\r\n\t\t\t// Cycle through blocks\r\n\t\t\tfor ( var block = blockStart; block <= blockEnd; block ++ ) {\r\n\t\t\t\tvar type = blocks[block].type;\r\n\r\n\t\t\t\t// Add '=' unchanged text and moved block\r\n\t\t\t\tif ( type === '=' || type === '-' || type === '+' ) {\r\n\t\t\t\t\tfragments.push( {\r\n\t\t\t\t\t\ttext:  blocks[block].text,\r\n\t\t\t\t\t\ttype:  type,\r\n\t\t\t\t\t\tcolor: color\r\n\t\t\t\t\t} );\r\n\t\t\t\t}\r\n\t\t\t\tif ( type === 'r' ) {\r\n\t\t\t\t\tfragments.push( {\r\n\t\t\t\t\t\ttext:  blocks[block].text,\r\n\t\t\t\t\t\ttype:  type,\r\n\t\t\t\t\t\tcolor: blocks[block].id,\r\n\t\t\t\t\t\tmarkerType: blocks[block].markerType,\r\n\t\t\t\t\t} );\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Add '<' and '>' marks\r\n\t\t\t\telse if ( type === '|' ) {\r\n\t\t\t\t\tvar movedGroup = groups[ blocks[block].moved ];\r\n\r\n\t\t\t\t\t// Get mark text\r\n\t\t\t\t\tvar markText = '';\r\n\t\t\t\t\tfor (\r\n\t\t\t\t\t\tvar movedBlock = movedGroup.blockStart;\r\n\t\t\t\t\t\tmovedBlock <= movedGroup.blockEnd;\r\n\t\t\t\t\t\tmovedBlock ++\r\n\t\t\t\t\t) {\r\n\t\t\t\t\t\tif ( blocks[movedBlock].type === '=' || blocks[movedBlock].type === '-' ) {\r\n\t\t\t\t\t\t\tmarkText += blocks[movedBlock].text;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Get mark direction\r\n\t\t\t\t\tvar markType;\r\n\t\t\t\t\tif ( movedGroup.blockStart < blockStart ) {\r\n\t\t\t\t\t\tmarkType = '<';\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tmarkType = '>';\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Add mark\r\n\t\t\t\t\tfragments.push( {\r\n\t\t\t\t\t\ttext:  markText,\r\n\t\t\t\t\t\ttype:  markType,\r\n\t\t\t\t\t\tcolor: movedGroup.color\r\n\t\t\t\t\t} );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Add moved block end\r\n\t\t\tif ( color !== null ) {\r\n\t\t\t\tfragments.push( {\r\n\t\t\t\t\ttext:  '',\r\n\t\t\t\t\ttype:  ' )',\r\n\t\t\t\t\tcolor: color\r\n\t\t\t\t} );\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Cycle through fragments, join consecutive fragments of same type (i.e. '-' blocks)\r\n\t\tvar fragmentsLength = fragments.length;\r\n\t\tfor ( var fragment = 1; fragment < fragmentsLength; fragment ++ ) {\r\n\r\n\t\t\t// Check if joinable\r\n\t\t\tif (\r\n\t\t\t\tfragments[fragment] &&\r\n\t\t\t\tfragments[fragment].type !== 'r' &&\r\n\t\t\t\tfragments[fragment].type === fragments[fragment - 1].type &&\r\n\t\t\t\tfragments[fragment].color === fragments[fragment - 1].color &&\r\n\t\t\t\tfragments[fragment].text !== '' && fragments[fragment - 1].text !== ''\r\n\t\t\t) {\r\n\r\n\t\t\t\t// Join and splice\r\n\t\t\t\tfragments[fragment - 1].text += fragments[fragment].text;\r\n\t\t\t\tfragments.splice( fragment, 1 );\r\n\t\t\t\tfragment --;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Enclose in containers\r\n\t\tfragments.unshift( { text: '', type: '{', color: null }, { text: '', type: '[', color: null } );\r\n\t\tfragments.push(    { text: '', type: ']', color: null }, { text: '', type: '}', color: null } );\r\n\r\n\t\treturn;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Clip unchanged sections from unmoved block text.\r\n\t * Adds the following fagment types:\r\n\t *   '~', ' ~', '~ ' omission indicators\r\n\t *   '[', ']', ','   fragment start and end, fragment separator\r\n\t *\r\n\t * @param[in/out] array fragments Fragments array, abstraction layer for diff code\r\n\t */\r\n\tthis.clipDiffFragments = function () {\r\n\r\n\t\tvar fragments = this.fragments;\r\n\r\n\t\t// Skip if only one fragment in containers, no change\r\n\t\tif ( fragments.length === 5 ) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Min length for clipping right\r\n\t\tvar minRight = this.config.clipHeadingRight;\r\n\t\tif ( this.config.clipParagraphRightMin < minRight ) {\r\n\t\t\tminRight = this.config.clipParagraphRightMin;\r\n\t\t}\r\n\t\tif ( this.config.clipLineRightMin < minRight ) {\r\n\t\t\tminRight = this.config.clipLineRightMin;\r\n\t\t}\r\n\t\tif ( this.config.clipBlankRightMin < minRight ) {\r\n\t\t\tminRight = this.config.clipBlankRightMin;\r\n\t\t}\r\n\t\tif ( this.config.clipCharsRight < minRight ) {\r\n\t\t\tminRight = this.config.clipCharsRight;\r\n\t\t}\r\n\r\n\t\t// Min length for clipping left\r\n\t\tvar minLeft = this.config.clipHeadingLeft;\r\n\t\tif ( this.config.clipParagraphLeftMin < minLeft ) {\r\n\t\t\tminLeft = this.config.clipParagraphLeftMin;\r\n\t\t}\r\n\t\tif ( this.config.clipLineLeftMin < minLeft ) {\r\n\t\t\tminLeft = this.config.clipLineLeftMin;\r\n\t\t}\r\n\t\tif ( this.config.clipBlankLeftMin < minLeft ) {\r\n\t\t\tminLeft = this.config.clipBlankLeftMin;\r\n\t\t}\r\n\t\tif ( this.config.clipCharsLeft < minLeft ) {\r\n\t\t\tminLeft = this.config.clipCharsLeft;\r\n\t\t}\r\n\r\n\t\t// Cycle through fragments\r\n\t\tvar fragmentsLength = fragments.length;\r\n\t\tfor ( var fragment = 0; fragment < fragmentsLength; fragment ++ ) {\r\n\r\n\t\t\t// Skip if not an unmoved and unchanged block\r\n\t\t\tvar type = fragments[fragment].type;\r\n\t\t\tvar color = fragments[fragment].color;\r\n\t\t\tif ( type !== '=' || color !== null ) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\t// Skip if too short for clipping\r\n\t\t\tvar text = fragments[fragment].text;\r\n\t\t\tvar textLength = text.length;\r\n\t\t\tif ( textLength < minRight && textLength < minLeft ) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\t// Get line positions including start and end\r\n\t\t\tvar lines = [];\r\n\t\t\tvar lastIndex = null;\r\n\t\t\tvar regExpMatch;\r\n\t\t\twhile ( ( regExpMatch = this.config.regExp.clipLine.exec( text ) ) !== null ) {\r\n\t\t\t\tlines.push( regExpMatch.index );\r\n\t\t\t\tlastIndex = this.config.regExp.clipLine.lastIndex;\r\n\t\t\t}\r\n\t\t\tif ( lines[0] !== 0 ) {\r\n\t\t\t\tlines.unshift( 0 );\r\n\t\t\t}\r\n\t\t\tif ( lastIndex !== textLength ) {\r\n\t\t\t\tlines.push( textLength );\r\n\t\t\t}\r\n\r\n\t\t\t// Get heading positions\r\n\t\t\tvar headings = [];\r\n\t\t\tvar headingsEnd = [];\r\n\t\t\twhile ( ( regExpMatch = this.config.regExp.clipHeading.exec( text ) ) !== null ) {\r\n\t\t\t\theadings.push( regExpMatch.index );\r\n\t\t\t\theadingsEnd.push( regExpMatch.index + regExpMatch[0].length );\r\n\t\t\t}\r\n\r\n\t\t\t// Get paragraph positions including start and end\r\n\t\t\tvar paragraphs = [];\r\n\t\t\tvar lastIndex = null;\r\n\t\t\twhile ( ( regExpMatch = this.config.regExp.clipParagraph.exec( text ) ) !== null ) {\r\n\t\t\t\tparagraphs.push( regExpMatch.index );\r\n\t\t\t\tlastIndex = this.config.regExp.clipParagraph.lastIndex;\r\n\t\t\t}\r\n\t\t\tif ( paragraphs[0] !== 0 ) {\r\n\t\t\t\tparagraphs.unshift( 0 );\r\n\t\t\t}\r\n\t\t\tif ( lastIndex !== textLength ) {\r\n\t\t\t\tparagraphs.push( textLength );\r\n\t\t\t}\r\n\r\n\t\t\t// Determine ranges to keep on left and right side\r\n\t\t\tvar rangeRight = null;\r\n\t\t\tvar rangeLeft = null;\r\n\t\t\tvar rangeRightType = '';\r\n\t\t\tvar rangeLeftType = '';\r\n\r\n\t\t\t// Find clip pos from left, skip for first non-container block\r\n\t\t\tif ( fragment !== 2 ) {\r\n\r\n\t\t\t\t// Maximum lines to search from left\r\n\t\t\t\tvar rangeLeftMax = textLength;\r\n\t\t\t\tif ( this.config.clipLinesLeftMax < lines.length ) {\r\n\t\t\t\t\trangeLeftMax = lines[this.config.clipLinesLeftMax];\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Find first heading from left\r\n\t\t\t\tif ( rangeLeft === null ) {\r\n\t\t\t\t\tvar headingsLength = headingsEnd.length;\r\n\t\t\t\t\tfor ( var j = 0; j < headingsLength; j ++ ) {\r\n\t\t\t\t\t\tif ( headingsEnd[j] > this.config.clipHeadingLeft || headingsEnd[j] > rangeLeftMax ) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\trangeLeft = headingsEnd[j];\r\n\t\t\t\t\t\trangeLeftType = 'heading';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Find first paragraph from left\r\n\t\t\t\tif ( rangeLeft === null ) {\r\n\t\t\t\t\tvar paragraphsLength = paragraphs.length;\r\n\t\t\t\t\tfor ( var j = 0; j < paragraphsLength; j ++ ) {\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\tparagraphs[j] > this.config.clipParagraphLeftMax ||\r\n\t\t\t\t\t\t\tparagraphs[j] > rangeLeftMax\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ( paragraphs[j] > this.config.clipParagraphLeftMin ) {\r\n\t\t\t\t\t\t\trangeLeft = paragraphs[j];\r\n\t\t\t\t\t\t\trangeLeftType = 'paragraph';\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Find first line break from left\r\n\t\t\t\tif ( rangeLeft === null ) {\r\n\t\t\t\t\tvar linesLength = lines.length;\r\n\t\t\t\t\tfor ( var j = 0; j < linesLength; j ++ ) {\r\n\t\t\t\t\t\tif ( lines[j] > this.config.clipLineLeftMax || lines[j] > rangeLeftMax ) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ( lines[j] > this.config.clipLineLeftMin ) {\r\n\t\t\t\t\t\t\trangeLeft = lines[j];\r\n\t\t\t\t\t\t\trangeLeftType = 'line';\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Find first blank from left\r\n\t\t\t\tif ( rangeLeft === null ) {\r\n\t\t\t\t\tthis.config.regExp.clipBlank.lastIndex = this.config.clipBlankLeftMin;\r\n\t\t\t\t\tif ( ( regExpMatch = this.config.regExp.clipBlank.exec( text ) ) !== null ) {\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\tregExpMatch.index < this.config.clipBlankLeftMax &&\r\n\t\t\t\t\t\t\tregExpMatch.index < rangeLeftMax\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\trangeLeft = regExpMatch.index;\r\n\t\t\t\t\t\t\trangeLeftType = 'blank';\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Fixed number of chars from left\r\n\t\t\t\tif ( rangeLeft === null ) {\r\n\t\t\t\t\tif ( this.config.clipCharsLeft < rangeLeftMax ) {\r\n\t\t\t\t\t\trangeLeft = this.config.clipCharsLeft;\r\n\t\t\t\t\t\trangeLeftType = 'chars';\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Fixed number of lines from left\r\n\t\t\t\tif ( rangeLeft === null ) {\r\n\t\t\t\t\trangeLeft = rangeLeftMax;\r\n\t\t\t\t\trangeLeftType = 'fixed';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Find clip pos from right, skip for last non-container block\r\n\t\t\tif ( fragment !== fragments.length - 3 ) {\r\n\r\n\t\t\t\t// Maximum lines to search from right\r\n\t\t\t\tvar rangeRightMin = 0;\r\n\t\t\t\tif ( lines.length >= this.config.clipLinesRightMax ) {\r\n\t\t\t\t\trangeRightMin = lines[lines.length - this.config.clipLinesRightMax];\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Find last heading from right\r\n\t\t\t\tif ( rangeRight === null ) {\r\n\t\t\t\t\tfor ( var j = headings.length - 1; j >= 0; j -- ) {\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\theadings[j] < textLength - this.config.clipHeadingRight ||\r\n\t\t\t\t\t\t\theadings[j] < rangeRightMin\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\trangeRight = headings[j];\r\n\t\t\t\t\t\trangeRightType = 'heading';\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Find last paragraph from right\r\n\t\t\t\tif ( rangeRight === null ) {\r\n\t\t\t\t\tfor ( var j = paragraphs.length - 1; j >= 0 ; j -- ) {\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\tparagraphs[j] < textLength - this.config.clipParagraphRightMax ||\r\n\t\t\t\t\t\t\tparagraphs[j] < rangeRightMin\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ( paragraphs[j] < textLength - this.config.clipParagraphRightMin ) {\r\n\t\t\t\t\t\t\trangeRight = paragraphs[j];\r\n\t\t\t\t\t\t\trangeRightType = 'paragraph';\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Find last line break from right\r\n\t\t\t\tif ( rangeRight === null ) {\r\n\t\t\t\t\tfor ( var j = lines.length - 1; j >= 0; j -- ) {\r\n\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\tlines[j] < textLength - this.config.clipLineRightMax ||\r\n\t\t\t\t\t\t\tlines[j] < rangeRightMin\r\n\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif ( lines[j] < textLength - this.config.clipLineRightMin ) {\r\n\t\t\t\t\t\t\trangeRight = lines[j];\r\n\t\t\t\t\t\t\trangeRightType = 'line';\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Find last blank from right\r\n\t\t\t\tif ( rangeRight === null ) {\r\n\t\t\t\t\tvar startPos = textLength - this.config.clipBlankRightMax;\r\n\t\t\t\t\tif ( startPos < rangeRightMin ) {\r\n\t\t\t\t\t\tstartPos = rangeRightMin;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tthis.config.regExp.clipBlank.lastIndex = startPos;\r\n\t\t\t\t\tvar lastPos = null;\r\n\t\t\t\t\twhile ( ( regExpMatch = this.config.regExp.clipBlank.exec( text ) ) !== null ) {\r\n\t\t\t\t\t\tif ( regExpMatch.index > textLength - this.config.clipBlankRightMin ) {\r\n\t\t\t\t\t\t\tif ( lastPos !== null ) {\r\n\t\t\t\t\t\t\t\trangeRight = lastPos;\r\n\t\t\t\t\t\t\t\trangeRightType = 'blank';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tlastPos = regExpMatch.index;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Fixed number of chars from right\r\n\t\t\t\tif ( rangeRight === null ) {\r\n\t\t\t\t\tif ( textLength - this.config.clipCharsRight > rangeRightMin ) {\r\n\t\t\t\t\t\trangeRight = textLength - this.config.clipCharsRight;\r\n\t\t\t\t\t\trangeRightType = 'chars';\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Fixed number of lines from right\r\n\t\t\t\tif ( rangeRight === null ) {\r\n\t\t\t\t\trangeRight = rangeRightMin;\r\n\t\t\t\t\trangeRightType = 'fixed';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Check if we skip clipping if ranges are close together\r\n\t\t\tif ( rangeLeft !== null && rangeRight !== null ) {\r\n\r\n\t\t\t\t// Skip if overlapping ranges\r\n\t\t\t\tif ( rangeLeft > rangeRight ) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Skip if chars too close\r\n\t\t\t\tvar skipChars = rangeRight - rangeLeft;\r\n\t\t\t\tif ( skipChars < this.config.clipSkipChars ) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Skip if lines too close\r\n\t\t\t\tvar skipLines = 0;\r\n\t\t\t\tvar linesLength = lines.length;\r\n\t\t\t\tfor ( var j = 0; j < linesLength; j ++ ) {\r\n\t\t\t\t\tif ( lines[j] > rangeRight || skipLines > this.config.clipSkipLines ) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ( lines[j] > rangeLeft ) {\r\n\t\t\t\t\t\tskipLines ++;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif ( skipLines < this.config.clipSkipLines ) {\r\n\t\t\t\t\tcontinue;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Skip if nothing to clip\r\n\t\t\tif ( rangeLeft === null && rangeRight === null ) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\r\n\t\t\t// Split left text\r\n\t\t\tvar textLeft = null;\r\n\t\t\tvar omittedLeft = null;\r\n\t\t\tif ( rangeLeft !== null ) {\r\n\t\t\t\ttextLeft = text.slice( 0, rangeLeft );\r\n\r\n\t\t\t\t// Remove trailing empty lines\r\n\t\t\t\ttextLeft = textLeft.replace( this.config.regExp.clipTrimNewLinesLeft, '' );\r\n\r\n\t\t\t\t// Get omission indicators, remove trailing blanks\r\n\t\t\t\tif ( rangeLeftType === 'chars' ) {\r\n\t\t\t\t\tomittedLeft = '~';\r\n\t\t\t\t\ttextLeft = textLeft.replace( this.config.regExp.clipTrimBlanksLeft, '' );\r\n\t\t\t\t}\r\n\t\t\t\telse if ( rangeLeftType === 'blank' ) {\r\n\t\t\t\t\tomittedLeft = ' ~';\r\n\t\t\t\t\ttextLeft = textLeft.replace( this.config.regExp.clipTrimBlanksLeft, '' );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Split right text\r\n\t\t\tvar textRight = null;\r\n\t\t\tvar omittedRight = null;\r\n\t\t\tif ( rangeRight !== null ) {\r\n\t\t\t\ttextRight = text.slice( rangeRight );\r\n\r\n\t\t\t\t// Remove leading empty lines\r\n\t\t\t\ttextRight = textRight.replace( this.config.regExp.clipTrimNewLinesRight, '' );\r\n\r\n\t\t\t\t// Get omission indicators, remove leading blanks\r\n\t\t\t\tif ( rangeRightType === 'chars' ) {\r\n\t\t\t\t\tomittedRight = '~';\r\n\t\t\t\t\ttextRight = textRight.replace( this.config.regExp.clipTrimBlanksRight, '' );\r\n\t\t\t\t}\r\n\t\t\t\telse if ( rangeRightType === 'blank' ) {\r\n\t\t\t\t\tomittedRight = '~ ';\r\n\t\t\t\t\ttextRight = textRight.replace( this.config.regExp.clipTrimBlanksRight, '' );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Remove split element\r\n\t\t\tfragments.splice( fragment, 1 );\r\n\t\t\tfragmentsLength --;\r\n\r\n\t\t\t// Add left text to fragments list\r\n\t\t\tif ( rangeLeft !== null ) {\r\n\t\t\t\tfragments.splice( fragment ++, 0, { text: textLeft, type: '=', color: null } );\r\n\t\t\t\tfragmentsLength ++;\r\n\t\t\t\tif ( omittedLeft !== null ) {\r\n\t\t\t\t\tfragments.splice( fragment ++, 0,\t{ text: '', type: omittedLeft, color: null } );\r\n\t\t\t\t\tfragmentsLength ++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Add fragment container and separator to list\r\n\t\t\tif ( rangeLeft !== null && rangeRight !== null ) {\r\n\t\t\t\tfragments.splice( fragment ++, 0, { text: '', type: ']', color: null } );\r\n\t\t\t\tfragments.splice( fragment ++, 0, { text: '', type: ',', color: null } );\r\n\t\t\t\tfragments.splice( fragment ++, 0, { text: '', type: '[', color: null } );\r\n\t\t\t\tfragmentsLength += 3;\r\n\t\t\t}\r\n\r\n\t\t\t// Add right text to fragments list\r\n\t\t\tif ( rangeRight !== null ) {\r\n\t\t\t\tif ( omittedRight !== null ) {\r\n\t\t\t\t\tfragments.splice( fragment ++, 0, { text: '', type: omittedRight, color: null } );\r\n\t\t\t\t\tfragmentsLength ++;\r\n\t\t\t\t}\r\n\t\t\t\tfragments.splice( fragment ++, 0, { text: textRight, type: '=', color: null } );\r\n\t\t\t\tfragmentsLength ++;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Debug log\r\n\t\tif ( this.config.debug === true ) {\r\n\t\t\tthis.debugFragments( 'Fragments' );\r\n\t\t}\r\n\r\n\t\treturn;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Create html formatted diff code from diff fragments.\r\n\t *\r\n\t * @param[in] array fragments Fragments array, abstraction layer for diff code\r\n\t * @param string|undefined version\r\n\t *   Output version: 'new' or 'old': only text from new or old version, used for unit tests\r\n\t * @param[out] string html Html code of diff\r\n\t */\r\n\tthis.getDiffHtml = function ( version ) {\r\n\r\n\t\tvar fragments = this.fragments;\r\n\r\n\t\t// No change, only one unchanged block in containers\r\n\t\tif ( fragments.length === 5 && fragments[2].type === '=' ) {\r\n\t\t\tthis.html = '';\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Cycle through fragments\r\n\t\tvar htmlFragments = [];\r\n\t\tvar fragmentsLength = fragments.length;\r\n\t\tfor ( var fragment = 0; fragment < fragmentsLength; fragment ++ ) {\r\n\t\t\tvar text = fragments[fragment].text;\r\n\t\t\tvar type = fragments[fragment].type;\r\n\t\t\tvar color = fragments[fragment].color;\r\n\t\t\tvar html = '';\r\n\r\n\t\t\t// Test if text is blanks-only or a single character\r\n\t\t\tvar blank = false;\r\n\t\t\tif ( text !== '' ) {\r\n\t\t\t\tblank = this.config.regExp.blankBlock.test( text );\r\n\t\t\t}\r\n\r\n\t\t\t// Add container start markup\r\n\t\t\tif ( type === '{' ) {\r\n\t\t\t\thtml = this.config.htmlCode.containerStart;\r\n\t\t\t}\r\n\r\n\t\t\t// Add container end markup\r\n\t\t\telse if ( type === '}' ) {\r\n\t\t\t\thtml = this.config.htmlCode.containerEnd;\r\n\t\t\t}\r\n\r\n\t\t\t// Add fragment start markup\r\n\t\t\tif ( type === '[' ) {\r\n\t\t\t\thtml = this.config.htmlCode.fragmentStart;\r\n\t\t\t}\r\n\r\n\t\t\t// Add fragment end markup\r\n\t\t\telse if ( type === ']' ) {\r\n\t\t\t\thtml = this.config.htmlCode.fragmentEnd;\r\n\t\t\t}\r\n\r\n\t\t\t// Add fragment separator markup\r\n\t\t\telse if ( type === ',' ) {\r\n\t\t\t\thtml = this.config.htmlCode.separator;\r\n\t\t\t}\r\n\r\n\t\t\t// Add omission markup\r\n\t\t\tif ( type === '~' ) {\r\n\t\t\t\thtml = this.config.htmlCode.omittedChars;\r\n\t\t\t}\r\n\r\n\t\t\t// Add omission markup\r\n\t\t\tif ( type === ' ~' ) {\r\n\t\t\t\thtml = ' ' + this.config.htmlCode.omittedChars;\r\n\t\t\t}\r\n\r\n\t\t\t// Add omission markup\r\n\t\t\tif ( type === '~ ' ) {\r\n\t\t\t\thtml = this.config.htmlCode.omittedChars + ' ';\r\n\t\t\t}\r\n\r\n\t\t\t// Add colored left-pointing block start markup\r\n\t\t\telse if ( type === '(<' ) {\r\n\t\t\t\tif ( version !== 'old' ) {\r\n\r\n\t\t\t\t\t// Get title\r\n\t\t\t\t\tvar title;\r\n\t\t\t\t\tif ( this.config.noUnicodeSymbols === true ) {\r\n\t\t\t\t\t\ttitle = this.config.msg['wiked-diff-block-left-nounicode'];\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\ttitle = this.config.msg['wiked-diff-block-left'];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Get html\r\n\t\t\t\t\tif ( this.config.coloredBlocks === true ) {\r\n\t\t\t\t\t\thtml = this.config.htmlCode.blockColoredStart;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\thtml = this.config.htmlCode.blockStart;\r\n\t\t\t\t\t}\r\n\t\t\t\t\thtml = this.htmlCustomize( html, color, title );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Add colored right-pointing block start markup\r\n\t\t\telse if ( type === '(>' ) {\r\n\t\t\t\tif ( version !== 'old' ) {\r\n\r\n\t\t\t\t\t// Get title\r\n\t\t\t\t\tvar title;\r\n\t\t\t\t\tif ( this.config.noUnicodeSymbols === true ) {\r\n\t\t\t\t\t\ttitle = this.config.msg['wiked-diff-block-right-nounicode'];\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\ttitle = this.config.msg['wiked-diff-block-right'];\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Get html\r\n\t\t\t\t\tif ( this.config.coloredBlocks === true ) {\r\n\t\t\t\t\t\thtml = this.config.htmlCode.blockColoredStart;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\thtml = this.config.htmlCode.blockStart;\r\n\t\t\t\t\t}\r\n\t\t\t\t\thtml = this.htmlCustomize( html, color, title );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Add colored block end markup\r\n\t\t\telse if ( type === ' )' ) {\r\n\t\t\t\tif ( version !== 'old' ) {\r\n\t\t\t\t\thtml = this.config.htmlCode.blockEnd;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Add '=' (unchanged) text and moved block\r\n\t\t\tif ( type === '=' ) {\r\n\t\t\t\ttext = this.htmlEscape( text );\r\n\t\t\t\tif ( color !== null ) {\r\n\t\t\t\t\tif ( version !== 'old' ) {\r\n\t\t\t\t\t\thtml = this.markupBlanks( text, true );\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\thtml = this.markupBlanks( text );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Add '-' text\r\n\t\t\telse if ( type === '-' ) {\r\n\t\t\t\tif ( version !== 'new' ) {\r\n\r\n\t\t\t\t\t// For old version skip '-' inside moved group\r\n\t\t\t\t\tif ( version !== 'old' || color === null ) {\r\n\t\t\t\t\t\ttext = this.htmlEscape( text );\r\n\t\t\t\t\t\ttext = this.markupBlanks( text, true );\r\n\t\t\t\t\t\tif ( blank === true ) {\r\n\t\t\t\t\t\t\thtml = this.config.htmlCode.deleteStartBlank;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\thtml = this.config.htmlCode.deleteStart;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\thtml += text + this.config.htmlCode.deleteEnd;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Add '+' text\r\n\t\t\telse if ( type === '+' ) {\r\n\t\t\t\tif ( version !== 'old' ) {\r\n\t\t\t\t\ttext = this.htmlEscape( text );\r\n\t\t\t\t\ttext = this.markupBlanks( text, true );\r\n\t\t\t\t\tif ( blank === true ) {\r\n\t\t\t\t\t\thtml = this.config.htmlCode.insertStartBlank;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\thtml = this.config.htmlCode.insertStart;\r\n\t\t\t\t\t}\r\n\t\t\t\t\thtml += text + this.config.htmlCode.insertEnd;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Add '<' and '>' code\r\n\t\t\telse if ( type === '<' || type === '>' ) {\r\n\t\t\t\tif ( version !== 'new' ) {\r\n\r\n\t\t\t\t\t// Display as deletion at original position\r\n\t\t\t\t\tif ( this.config.showBlockMoves === false || version === 'old' ) {\r\n\t\t\t\t\t\ttext = this.htmlEscape( text );\r\n\t\t\t\t\t\ttext = this.markupBlanks( text, true );\r\n\t\t\t\t\t\tif ( version === 'old' ) {\r\n\t\t\t\t\t\t\tif ( this.config.coloredBlocks === true ) {\r\n\t\t\t\t\t\t\t\thtml =\r\n\t\t\t\t\t\t\t\t\tthis.htmlCustomize( this.config.htmlCode.blockColoredStart, color ) +\r\n\t\t\t\t\t\t\t\t\ttext +\r\n\t\t\t\t\t\t\t\t\tthis.config.htmlCode.blockEnd;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\thtml =\r\n\t\t\t\t\t\t\t\t\tthis.htmlCustomize( this.config.htmlCode.blockStart, color ) +\r\n\t\t\t\t\t\t\t\t\ttext +\r\n\t\t\t\t\t\t\t\t\tthis.config.htmlCode.blockEnd;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tif ( blank === true ) {\r\n\t\t\t\t\t\t\t\thtml =\r\n\t\t\t\t\t\t\t\t\tthis.config.htmlCode.deleteStartBlank +\r\n\t\t\t\t\t\t\t\t\ttext +\r\n\t\t\t\t\t\t\t\t\tthis.config.htmlCode.deleteEnd;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\thtml = this.config.htmlCode.deleteStart + text + this.config.htmlCode.deleteEnd;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Display as mark\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tif ( type === '<' ) {\r\n\t\t\t\t\t\t\tif ( this.config.coloredBlocks === true ) {\r\n\t\t\t\t\t\t\t\thtml = this.htmlCustomize( this.config.htmlCode.markLeftColored, color, text );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\thtml = this.htmlCustomize( this.config.htmlCode.markLeft, color, text );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tif ( this.config.coloredBlocks === true ) {\r\n\t\t\t\t\t\t\t\thtml = this.htmlCustomize( this.config.htmlCode.markRightColored, color, text );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\thtml = this.htmlCustomize( this.config.htmlCode.markRight, color, text );\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Add reFill change marker\r\n\t\t\telse if ( type === 'r' ) {\r\n\t\t\t\tvar markerType = fragments[fragment].markerType;\r\n\t\t\t\tif ( markerType === 'c' ) {\r\n\t\t\t\t\thtml = this.htmlCustomize( this.config.htmlCode.refillChange, color, text );\r\n\t\t\t\t} else if ( markerType === 'e' ) {\r\n\t\t\t\t\thtml = this.htmlCustomize( this.config.htmlCode.refillError, color, text );\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\thtmlFragments.push( html );\r\n\t\t}\r\n\r\n\t\t// Join fragments\r\n\t\tthis.html = htmlFragments.join( '' );\r\n\r\n\t\treturn;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Customize html code fragments.\r\n\t * Replaces:\r\n\t *   {number}:    class/color/block/mark/id number\r\n\t *   {title}:     title attribute (popup)\r\n\t *   {nounicode}: noUnicodeSymbols fallback\r\n\t *   input: html, number: block number, title: title attribute (popup) text\r\n\t *\r\n\t * @param string html Html code to be customized\r\n\t * @return string Customized html code\r\n\t */\r\n\tthis.htmlCustomize = function ( html, number, title ) {\r\n\r\n\t\t// Replace {number} with class/color/block/mark/id number\r\n\t\thtml = html.replace( /\\{number\\}/g, number);\r\n\r\n\t\t// Replace {nounicode} with wikEdDiffNoUnicode class name\r\n\t\tif ( this.config.noUnicodeSymbols === true ) {\r\n\t\t\thtml = html.replace( /\\{nounicode\\}/g, ' wikEdDiffNoUnicode');\r\n\t\t}\r\n\t\telse {\r\n\t\t\thtml = html.replace( /\\{nounicode\\}/g, '');\r\n\t\t}\r\n\r\n\t\t// Shorten title text, replace {title}\r\n\t\tif ( title !== undefined ) {\r\n\t\t\tvar max = 512;\r\n\t\t\tvar end = 128;\r\n\t\t\tvar gapMark = ' [...] ';\r\n\t\t\tif ( title.length > max ) {\r\n\t\t\t\ttitle =\r\n\t\t\t\t\ttitle.substr( 0, max - gapMark.length - end ) +\r\n\t\t\t\t\tgapMark +\r\n\t\t\t\t\ttitle.substr( title.length - end );\r\n\t\t\t}\r\n\t\t\ttitle = this.htmlEscape( title );\r\n\t\t\ttitle = title.replace( /\\t/g, '&nbsp;&nbsp;');\r\n\t\t\ttitle = title.replace( /  /g, '&nbsp;&nbsp;');\r\n\t\t\thtml = html.replace( /\\{title\\}/, title);\r\n\t\t}\r\n\t\treturn html;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Replace html-sensitive characters in output text with character entities.\r\n\t *\r\n\t * @param string html Html code to be escaped\r\n\t * @return string Escaped html code\r\n\t */\r\n\tthis.htmlEscape = function ( html ) {\r\n\r\n\t\thtml = html.replace( /&/g, '&amp;');\r\n\t\thtml = html.replace( /</g, '&lt;');\r\n\t\thtml = html.replace( />/g, '&gt;');\r\n\t\thtml = html.replace( /\"/g, '&quot;');\r\n\t\treturn html;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Markup tabs, newlines, and spaces in diff fragment text.\r\n\t *\r\n\t * @param bool highlight Highlight newlines and spaces in addition to tabs\r\n\t * @param string html Text code to be marked-up\r\n\t * @return string Marked-up text\r\n\t */\r\n\tthis.markupBlanks = function ( html, highlight ) {\r\n\r\n\t\tif ( highlight === true ) {\r\n\t\t\thtml = html.replace( / /g, this.config.htmlCode.space);\r\n\t\t\thtml = html.replace( /\\n/g, this.config.htmlCode.newline);\r\n\t\t}\r\n\t\thtml = html.replace( /\\t/g, this.config.htmlCode.tab);\r\n\t\treturn html;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Count real words in text.\r\n\t *\r\n\t * @param string text Text for word counting\r\n\t * @return int Number of words in text\r\n\t */\r\n\tthis.wordCount = function ( text ) {\r\n\r\n\t\treturn ( text.match( this.config.regExp.countWords ) || [] ).length;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Test diff code for consistency with input versions.\r\n\t * Prints results to debug console.\r\n\t *\r\n\t * @param[in] WikEdDiffText newText, oldText Text objects\r\n\t */\r\n\tthis.unitTests = function () {\r\n\r\n\t\t// Check if output is consistent with new text\r\n\t\tthis.getDiffHtml( 'new' );\r\n\t\tvar diff = this.html.replace( /<[^>]*>/g, '');\r\n\t\tvar text = this.htmlEscape( this.newText.text );\r\n\t\tif ( diff !== text ) {\r\n\t\t\tconsole.log(\r\n\t\t\t\t'Error: wikEdDiff unit test failure: diff not consistent with new text version!'\r\n\t\t\t);\r\n\t\t\tthis.error = true;\r\n\t\t\tconsole.log( 'new text:\\n', text );\r\n\t\t\tconsole.log( 'new diff:\\n', diff );\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.log( 'OK: wikEdDiff unit test passed: diff consistent with new text.' );\r\n\t\t}\r\n\r\n\t\t// Check if output is consistent with old text\r\n\t\tthis.getDiffHtml( 'old' );\r\n\t\tvar diff = this.html.replace( /<[^>]*>/g, '');\r\n\t\tvar text = this.htmlEscape( this.oldText.text );\r\n\t\tif ( diff !== text ) {\r\n\t\t\tconsole.log(\r\n\t\t\t\t'Error: wikEdDiff unit test failure: diff not consistent with old text version!'\r\n\t\t\t);\r\n\t\t\tthis.error = true;\r\n\t\t\tconsole.log( 'old text:\\n', text );\r\n\t\t\tconsole.log( 'old diff:\\n', diff );\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.log( 'OK: wikEdDiff unit test passed: diff consistent with old text.' );\r\n\t\t}\r\n\r\n\t\treturn;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Dump blocks object to browser console.\r\n\t *\r\n\t * @param string name Block name\r\n\t * @param[in] array blocks Blocks table object\r\n\t */\r\n\tthis.debugBlocks = function ( name, blocks ) {\r\n\r\n\t\tif ( blocks === undefined ) {\r\n\t\t\tblocks = this.blocks;\r\n\t\t}\r\n\t\tvar dump =\r\n\t\t\t'\\ni \\toldBl \\tnewBl \\toldNm \\tnewNm \\toldSt \\tcount \\tuniq' +\r\n\t\t\t'\\twords \\tchars \\ttype \\tsect \\tgroup \\tfixed \\tmoved \\ttext\\n';\r\n\t\tvar blocksLength = blocks.length;\r\n\t\tfor ( var i = 0; i < blocksLength; i ++ ) {\r\n\t\t\tdump +=\r\n\t\t\t\ti + ' \\t' + blocks[i].oldBlock + ' \\t' + blocks[i].newBlock + ' \\t' +\r\n\t\t\t\tblocks[i].oldNumber + ' \\t' + blocks[i].newNumber + ' \\t' + blocks[i].oldStart + ' \\t' +\r\n\t\t\t\tblocks[i].count + ' \\t' + blocks[i].unique + ' \\t' + blocks[i].words + ' \\t' +\r\n\t\t\t\tblocks[i].chars + ' \\t' + blocks[i].type + ' \\t' + blocks[i].section + ' \\t' +\r\n\t\t\t\tblocks[i].group + ' \\t' + blocks[i].fixed + ' \\t' + blocks[i].moved + ' \\t' +\r\n\t\t\t\tthis.debugShortenText( blocks[i].text ) + '\\n';\r\n\t\t}\r\n\t\tconsole.log( name + ':\\n' + dump );\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Dump groups object to browser console.\r\n\t *\r\n\t * @param string name Group name\r\n\t * @param[in] array groups Groups table object\r\n\t */\r\n\tthis.debugGroups = function ( name, groups ) {\r\n\r\n\t\tif ( groups === undefined ) {\r\n\t\t\tgroups = this.groups;\r\n\t\t}\r\n\t\tvar dump =\r\n\t\t\t'\\ni \\toldNm \\tblSta \\tblEnd \\tuniq \\tmaxWo' +\r\n\t\t\t'\\twords \\tchars \\tfixed \\toldNm \\tmFrom \\tcolor\\n';\r\n\t\tvar groupsLength = groupsLength;\r\n\t\tfor ( var i = 0; i < groups.length; i ++ ) {\r\n\t\t\tdump +=\r\n\t\t\t\ti + ' \\t' + groups[i].oldNumber + ' \\t' + groups[i].blockStart + ' \\t' +\r\n\t\t\t\tgroups[i].blockEnd + ' \\t' + groups[i].unique + ' \\t' + groups[i].maxWords + ' \\t' +\r\n\t\t\t\tgroups[i].words + ' \\t' + groups[i].chars + ' \\t' + groups[i].fixed + ' \\t' +\r\n\t\t\t\tgroups[i].oldNumber + ' \\t' + groups[i].movedFrom + ' \\t' + groups[i].color + '\\n';\r\n\t\t}\r\n\t\tconsole.log( name + ':\\n' + dump );\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Dump fragments array to browser console.\r\n\t *\r\n\t * @param string name Fragments name\r\n\t * @param[in] array fragments Fragments array\r\n\t */\r\n\tthis.debugFragments = function ( name ) {\r\n\r\n\t\tvar fragments = this.fragments;\r\n\t\tvar dump = '\\ni \\ttype \\tcolor \\ttext\\n';\r\n\t\tvar fragmentsLength = fragments.length;\r\n\t\tfor ( var i = 0; i < fragmentsLength; i ++ ) {\r\n\t\t\tdump +=\r\n\t\t\t\ti + ' \\t\"' + fragments[i].type + '\" \\t' + fragments[i].color + ' \\t' +\r\n\t\t\t\tthis.debugShortenText( fragments[i].text, 120, 40 ) + '\\n';\r\n\t\t}\r\n\t\tconsole.log( name + ':\\n' + dump );\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Dump borders array to browser console.\r\n\t *\r\n\t * @param string name Arrays name\r\n\t * @param[in] array border Match border array\r\n\t */\r\n\tthis.debugBorders = function ( name, borders ) {\r\n\r\n\t\tvar dump = '\\ni \\t[ new \\told ]\\n';\r\n\t\tvar bordersLength = borders.length;\r\n\t\tfor ( var i = 0; i < bordersLength; i ++ ) {\r\n\t\t\tdump += i + ' \\t[ ' + borders[i][0] + ' \\t' + borders[i][1] + ' ]\\n';\r\n\t\t}\r\n\t\tconsole.log( name, dump );\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Shorten text for dumping.\r\n\t *\r\n\t * @param string text Text to be shortened\r\n\t * @param int max Max length of (shortened) text\r\n\t * @param int end Length of trailing fragment of shortened text\r\n\t * @return string Shortened text\r\n\t */\r\n\tthis.debugShortenText = function ( text, max, end ) {\r\n\r\n\t\tif ( typeof text !== 'string' ) {\r\n\t\t\ttext = text.toString();\r\n\t\t}\r\n\t\ttext = text.replace( /\\n/g, '\\\\n');\r\n\t\ttext = text.replace( /\\t/g, '  ');\r\n\t\tif ( max === undefined ) {\r\n\t\t\tmax = 50;\r\n\t\t}\r\n\t\tif ( end === undefined ) {\r\n\t\t\tend = 15;\r\n\t\t}\r\n\t\tif ( text.length > max ) {\r\n\t\t\ttext = text.substr( 0, max - 1 - end ) + '…' + text.substr( text.length - end );\r\n\t\t}\r\n\t\treturn '\"' + text + '\"';\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Start timer 'label', analogous to JavaScript console timer.\r\n\t * Usage: this.time( 'label' );\r\n\t *\r\n\t * @param string label Timer label\r\n\t * @param[out] array timer Current time in milliseconds (float)\r\n\t */\r\n\tthis.time = function ( label ) {\r\n\r\n\t\tthis.timer[label] = new Date().getTime();\r\n\t\treturn;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Stop timer 'label', analogous to JavaScript console timer.\r\n\t * Logs time in milliseconds since start to browser console.\r\n\t * Usage: this.timeEnd( 'label' );\r\n\t *\r\n\t * @param string label Timer label\r\n\t * @param bool noLog Do not log result\r\n\t * @return float Time in milliseconds\r\n\t */\r\n\tthis.timeEnd = function ( label, noLog ) {\r\n\r\n\t\tvar diff = 0;\r\n\t\tif ( this.timer[label] !== undefined ) {\r\n\t\t\tvar start = this.timer[label];\r\n\t\t\tvar stop = new Date().getTime();\r\n\t\t\tdiff = stop - start;\r\n\t\t\tthis.timer[label] = undefined;\r\n\t\t\tif ( noLog !== true ) {\r\n\t\t\t\tconsole.log( label + ': ' + diff.toFixed( 2 ) + ' ms' );\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn diff;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Log recursion timer results to browser console.\r\n\t * Usage: this.timeRecursionEnd();\r\n\t *\r\n\t * @param string text Text label for output\r\n\t * @param[in] array recursionTimer Accumulated recursion times\r\n\t */\r\n\tthis.timeRecursionEnd = function ( text ) {\r\n\r\n\t\tif ( this.recursionTimer.length > 1 ) {\r\n\r\n\t\t\t// Subtract times spent in deeper recursions\r\n\t\t\tvar timerEnd = this.recursionTimer.length - 1;\r\n\t\t\tfor ( var i = 0; i < timerEnd; i ++ ) {\r\n\t\t\t\tthis.recursionTimer[i] -= this.recursionTimer[i + 1];\r\n\t\t\t}\r\n\r\n\t\t\t// Log recursion times\r\n\t\t\tvar timerLength = this.recursionTimer.length;\r\n\t\t\tfor ( var i = 0; i < timerLength; i ++ ) {\r\n\t\t\t\tconsole.log( text + ' recursion ' + i + ': ' + this.recursionTimer[i].toFixed( 2 ) + ' ms' );\r\n\t\t\t}\r\n\t\t}\r\n\t\tthis.recursionTimer = [];\r\n\t\treturn;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Log variable values to debug console.\r\n\t * Usage: this.debug( 'var', var );\r\n\t *\r\n\t * @param string name Object identifier\r\n\t * @param mixed|undefined name Object to be logged\r\n\t */\r\n\tthis.debug = function ( name, object ) {\r\n\r\n\t\tif ( object === undefined ) {\r\n\t\t\tconsole.log( name );\r\n\t\t}\r\n\t\telse {\r\n\t\t\tconsole.log( name + ': ' + object );\r\n\t\t}\r\n\t\treturn;\r\n\t};\r\n\r\n\r\n/**\r\n * Add script to document head.\r\n *\r\n * @param string code JavaScript code\r\n */\r\n\tthis.addScript = function ( code ) {\r\n\r\n\t\tif ( document.getElementById( 'wikEdDiffBlockHandler' ) === null ) {\r\n\t\t\tvar script = document.createElement( 'script' );\r\n\t\t\tscript.id = 'wikEdDiffBlockHandler';\r\n\t\t\tif ( script.innerText !== undefined ) {\r\n\t\t\t\tscript.innerText = code;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tscript.textContent = code;\r\n\t\t\t}\r\n\t\t\tdocument.getElementsByTagName( 'head' )[0].appendChild( script );\r\n\t\t}\r\n\t\treturn;\r\n\t};\r\n\r\n\r\n/**\r\n * Add stylesheet to document head, cross-browser >= IE6.\r\n *\r\n * @param string css CSS code\r\n */\r\n\tthis.addStyleSheet = function ( css ) {\r\n\r\n\t\tif ( document.getElementById( 'wikEdDiffStyles' ) === null ) {\r\n\r\n\t\t\t// Replace mark symbols\r\n\t\t\tcss = css.replace( /\\{cssMarkLeft\\}/g, this.config.cssMarkLeft);\r\n\t\t\tcss = css.replace( /\\{cssMarkRight\\}/g, this.config.cssMarkRight);\r\n\r\n\t\t\tvar style = document.createElement( 'style' );\r\n\t\t\tstyle.id = 'wikEdDiffStyles';\r\n\t\t\tstyle.type = 'text/css';\r\n\t\t\tif ( style.styleSheet !== undefined ) {\r\n\t\t\t\tstyle.styleSheet.cssText = css;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tstyle.appendChild( document.createTextNode( css ) );\r\n\t\t\t}\r\n\t\t\tdocument.getElementsByTagName( 'head' )[0].appendChild( style );\r\n\t\t}\r\n\t\treturn;\r\n\t};\r\n\r\n\r\n/**\r\n * Recursive deep copy from target over source for customization import.\r\n *\r\n * @param object source Source object\r\n * @param object target Target object\r\n */\r\n\tthis.deepCopy = function ( source, target ) {\r\n\r\n\t\tfor ( var key in source ) {\r\n\t\t\tif ( Object.prototype.hasOwnProperty.call( source, key ) === true ) {\r\n\t\t\t\tif ( typeof source[key] === 'object' ) {\r\n\t\t\t\t\tthis.deepCopy( source[key], target[key] );\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\ttarget[key] = source[key];\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn;\r\n\t};\r\n\r\n\t// Initialze WikEdDiff object\r\n\tthis.init();\r\n};\r\n\r\n\r\n/**\r\n * Data and methods for single text version (old or new one).\r\n *\r\n * @class WikEdDiffText\r\n */\r\nWikEdDiff.WikEdDiffText = function ( text, parent ) {\r\n\r\n\t/** @var WikEdDiff parent Parent object for configuration settings and debugging methods */\r\n\tthis.parent = parent;\r\n\r\n\t/** @var string text Text of this version */\r\n\tthis.text = null;\r\n\r\n\t/** @var array tokens Tokens list */\r\n\tthis.tokens = [];\r\n\r\n\t/** @var int first, last First and last index of tokens list */\r\n\tthis.first = null;\r\n\tthis.last = null;\r\n\r\n\t/** @var array words Word counts for version text */\r\n\tthis.words = {};\r\n\r\n\r\n\t/**\r\n\t * Constructor, initialize text object.\r\n\t *\r\n\t * @param string text Text of version\r\n\t * @param WikEdDiff parent Parent, for configuration settings and debugging methods\r\n\t */\r\n\tthis.init = function () {\r\n\r\n\t\tif ( typeof text !== 'string' ) {\r\n\t\t\ttext = text.toString();\r\n\t\t}\r\n\r\n\t\t// IE / Mac fix\r\n\t\tthis.text = text.replace( /\\r\\n?/g, '\\n');\r\n\r\n\t\t// Parse and count words and chunks for identification of unique real words\r\n\t\tif ( this.parent.config.timer === true ) {\r\n\t\t\tthis.parent.time( 'wordParse' );\r\n\t\t}\r\n\t\tthis.wordParse( this.parent.config.regExp.countWords );\r\n\t\tthis.wordParse( this.parent.config.regExp.countChunks );\r\n\t\tif ( this.parent.config.timer === true ) {\r\n\t\t\tthis.parent.timeEnd( 'wordParse' );\r\n\t\t}\r\n\t\treturn;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Parse and count words and chunks for identification of unique words.\r\n\t *\r\n\t * @param string regExp Regular expression for counting words\r\n\t * @param[in] string text Text of version\r\n\t * @param[out] array words Number of word occurrences\r\n\t */\r\n\tthis.wordParse = function ( regExp ) {\r\n\r\n\t\tvar regExpMatch = this.text.match( regExp );\r\n\t\tif ( regExpMatch !== null ) {\r\n\t\t\tvar matchLength = regExpMatch.length;\r\n\t\t\tfor (var i = 0; i < matchLength; i ++) {\r\n\t\t\t\tvar word = regExpMatch[i];\r\n\t\t\t\tif ( Object.prototype.hasOwnProperty.call( this.words, word ) === false ) {\r\n\t\t\t\t\tthis.words[word] = 1;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.words[word] ++;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Split text into paragraph, line, sentence, chunk, word, or character tokens.\r\n\t *\r\n\t * @param string level Level of splitting: paragraph, line, sentence, chunk, word, or character\r\n\t * @param int|null token Index of token to be split, otherwise uses full text\r\n\t * @param[in] string text Full text to be split\r\n\t * @param[out] array tokens Tokens list\r\n\t * @param[out] int first, last First and last index of tokens list\r\n\t */\r\n\tthis.splitText = function ( level, token ) {\r\n\r\n\t\tvar prev = null;\r\n\t\tvar next = null;\r\n\t\tvar current = this.tokens.length;\r\n\t\tvar first = current;\r\n\t\tvar text = '';\r\n\r\n\t\t// Split full text or specified token\r\n\t\tif ( token === undefined ) {\r\n\t\t\ttext = this.text;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tprev = this.tokens[token].prev;\r\n\t\t\tnext = this.tokens[token].next;\r\n\t\t\ttext = this.tokens[token].token;\r\n\t\t}\r\n\r\n\t\t// Split text into tokens, regExp match as separator\r\n\t\tvar number = 0;\r\n\t\tvar split = [];\r\n\t\tvar regExpMatch;\r\n\t\tvar lastIndex = 0;\r\n\t\tvar regExp = this.parent.config.regExp.split[level];\r\n\t\twhile ( ( regExpMatch = regExp.exec( text ) ) !== null ) {\r\n\t\t\tif ( regExpMatch.index > lastIndex ) {\r\n\t\t\t\tsplit.push( text.substring( lastIndex, regExpMatch.index ) );\r\n\t\t\t}\r\n\t\t\tsplit.push( regExpMatch[0] );\r\n\t\t\tlastIndex = regExp.lastIndex;\r\n\t\t}\r\n\t\tif ( lastIndex < text.length ) {\r\n\t\t\tsplit.push( text.substring( lastIndex ) );\r\n\t\t}\r\n\r\n\t\t// Cycle through new tokens\r\n\t\tvar splitLength = split.length;\r\n\t\tfor ( var i = 0; i < splitLength; i ++ ) {\r\n\r\n\t\t\t// Insert current item, link to previous\r\n\t\t\tthis.tokens.push( {\r\n\t\t\t\ttoken:   split[i],\r\n\t\t\t\tprev:    prev,\r\n\t\t\t\tnext:    null,\r\n\t\t\t\tlink:    null,\r\n\t\t\t\tnumber:  null,\r\n\t\t\t\tunique:  false\r\n\t\t\t} );\r\n\t\t\tnumber ++;\r\n\r\n\t\t\t// Link previous item to current\r\n\t\t\tif ( prev !== null ) {\r\n\t\t\t\tthis.tokens[prev].next = current;\r\n\t\t\t}\r\n\t\t\tprev = current;\r\n\t\t\tcurrent ++;\r\n\t\t}\r\n\r\n\t\t// Connect last new item and existing next item\r\n\t\tif ( number > 0 && token !== undefined ) {\r\n\t\t\tif ( prev !== null ) {\r\n\t\t\t\tthis.tokens[prev].next = next;\r\n\t\t\t}\r\n\t\t\tif ( next !== null ) {\r\n\t\t\t\tthis.tokens[next].prev = prev;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Set text first and last token index\r\n\t\tif ( number > 0 ) {\r\n\r\n\t\t\t// Initial text split\r\n\t\t\tif ( token === undefined ) {\r\n\t\t\t\tthis.first = 0;\r\n\t\t\t\tthis.last = prev;\r\n\t\t\t}\r\n\r\n\t\t\t// First or last token has been split\r\n\t\t\telse {\r\n\t\t\t\tif ( token === this.first ) {\r\n\t\t\t\t\tthis.first = first;\r\n\t\t\t\t}\r\n\t\t\t\tif ( token === this.last ) {\r\n\t\t\t\t\tthis.last = prev;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Split unique unmatched tokens into smaller tokens.\r\n\t *\r\n\t * @param string level Level of splitting: line, sentence, chunk, or word\r\n\t * @param[in] array tokens Tokens list\r\n\t */\r\n\tthis.splitRefine = function ( regExp ) {\r\n\r\n\t\t// Cycle through tokens list\r\n\t\tvar i = this.first;\r\n\t\twhile ( i !== null ) {\r\n\r\n\t\t\t// Refine unique unmatched tokens into smaller tokens\r\n\t\t\tif ( this.tokens[i].link === null ) {\r\n\t\t\t\tthis.splitText( regExp, i );\r\n\t\t\t}\r\n\t\t\ti = this.tokens[i].next;\r\n\t\t}\r\n\t\treturn;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Enumerate text token list before detecting blocks.\r\n\t *\r\n\t * @param[out] array tokens Tokens list\r\n\t */\r\n\tthis.enumerateTokens = function () {\r\n\r\n\t\t// Enumerate tokens list\r\n\t\tvar number = 0;\r\n\t\tvar i = this.first;\r\n\t\twhile ( i !== null ) {\r\n\t\t\tthis.tokens[i].number = number;\r\n\t\t\tnumber ++;\r\n\t\t\ti = this.tokens[i].next;\r\n\t\t}\r\n\t\treturn;\r\n\t};\r\n\r\n\r\n\t/**\r\n\t * Dump tokens object to browser console.\r\n\t *\r\n\t * @param string name Text name\r\n\t * @param[in] int first, last First and last index of tokens list\r\n\t * @param[in] array tokens Tokens list\r\n\t */\r\n\tthis.debugText = function ( name ) {\r\n\r\n\t\tvar tokens = this.tokens;\r\n\t\tvar dump = 'first: ' + this.first + '\\tlast: ' + this.last + '\\n';\r\n\t\tdump += '\\ni \\tlink \\t(prev \\tnext) \\tuniq \\t#num \\t\"token\"\\n';\r\n\t\tvar i = this.first;\r\n\t\twhile ( i !== null ) {\r\n\t\t\tdump +=\r\n\t\t\t\ti + ' \\t' + tokens[i].link + ' \\t(' + tokens[i].prev + ' \\t' + tokens[i].next + ') \\t' +\r\n\t\t\t\ttokens[i].unique + ' \\t#' + tokens[i].number + ' \\t' +\r\n\t\t\t\tparent.debugShortenText( tokens[i].token ) + '\\n';\r\n\t\t\ti = tokens[i].next;\r\n\t\t}\r\n\t\tconsole.log( name + ':\\n' + dump );\r\n\t\treturn;\r\n\t};\r\n\r\n\t// Initialize WikEdDiffText object\r\n\tthis.init();\r\n};\r\n\r\n// </syntaxhighlight>\r\n\r\n//module.exports.WikEdDiff = WikEdDiff;\r\n\r\nmodule.exports = {  \r\n    WikEdDiff: WikEdDiff\r\n}","import React, { Component } from 'react';\r\n//import WikEdDiff from '../WikEdDiff';\r\nlet WikEdDiff = require('../WikEdDiff');\r\n\r\nconst Comparision = (orig, changed) => {\r\n\tlet wpDiff = WikEdDiff.WikEdDiff;\r\n\tlet diff1 = new wpDiff();\r\n\tconst diff = diff1.diff(orig, changed);\r\n\r\n\treturn <div dangerouslySetInnerHTML={{__html: diff}} />\r\n};\r\n\r\nexport default Comparision;","import React from 'react';\r\n\r\nconst urlSafeTitle = (title) => {\r\n\treturn encodeURI(title.replace(/ /gi, '_'))\r\n};\r\n\r\nconst ArticleTitle = (title, wiki) => {\r\n\t\r\n\twiki = wiki && wiki.replace('wiki', '')\r\n\r\n\tconst urlSafeWikititle = urlSafeTitle(title);\r\n\t\r\n\treturn <span>\r\n\t\t<a href={'https://' + wiki + '.wikipedia.org/wiki/' + urlSafeWikititle} target='_blank' rel=\"noopener noreferrer\">{title}</a> <span style={{fontSize:'50%'}}>(\r\n\t\t\t<a href={'https://' + wiki + '.wikipedia.org/w/index.php?title=' + urlSafeWikititle+'&action=edit'} target='_blank' rel=\"noopener noreferrer\">edit</a>\r\n\t\t\t{' '}|{' '}\r\n\t\t\t<a href={'https://' + wiki + '.wikipedia.org/w/index.php?title=' + urlSafeWikititle+'&action=history'} target='_blank' rel=\"noopener noreferrer\">history</a>\r\n\t\t)</span>\r\n\t</span>;\r\n};\r\n\r\nexport default ArticleTitle;","import React, { Component } from 'react';\r\n//import WikEdDiff from '../WikEdDiff';\r\n//let WikEdDiff = require('../WikEdDiff'); \r\nimport Comparision from '../components/comparision';\r\nimport ArticleTitle from './articleTitle';\r\nimport InfoboxView from './infoboxView';\r\nimport { toast } from 'react-toastify';\r\n\r\nexport default class Task extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.state = {\r\n\t\t\ttextAreaText: \"\",\r\n\t\t\torigText: \"\",\r\n\t\t\tloading: true,\r\n\t\t\terror: false,\r\n\t\t\tisAuth: false,\r\n\t\t\tstatus: '',\r\n\t\t\tarticleEditing: false,\r\n\t\t\tsavingProcess: false//saglabāšanas process, lai diseiblotu pogas\r\n\t\t};\r\n\t\tthis.handleChange = this.handleChange.bind(this);\r\n\t\tthis.saveArticle = this.saveArticle.bind(this);\r\n\t\tthis.setAsIncorrect = this.setAsIncorrect.bind(this);\r\n\t\tthis.toggleArticleEditing = this.toggleArticleEditing.bind(this);\r\n\t\tthis.toggleArticleEditing1 = this.toggleArticleEditing1.bind(this);\r\n\t\tthis.setTextareaText = this.setTextareaText.bind(this);\r\n\t}\r\n\r\n\tsaveArticle = (result) => (event) => {\r\n\t\tconst { isAuth } = this.props;\r\n\r\n\t\tif (!isAuth) {\r\n\t\t\ttoast.warn(\"You have to log-in to save actions\", { autoClose: 5000 });\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.props.saveArticleData({result, textForSave: this.state.textAreaText});\r\n\t}\r\n\r\n\tsetAsIncorrect() {\r\n\t\tthis.props.goToNextArticle();\r\n\t}\r\n\r\n\tsetTextareaText() {\r\n\t\tif (typeof this.props.articleParams.changedText !== 'undefined') {\r\n\t\t\tconst textToAdd = this.props.articleParams.changedText;\r\n\t\t\t\r\n\t\t\tthis.setState({textAreaText: textToAdd});\r\n\t\t}\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.props.setArticleData(this.setTextareaText)\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps) {\r\n\t\tif (this.props.article !== prevProps.article || this.props.task !== prevProps.task) {\r\n\t\t\tthis.props.setArticleData(this.setTextareaText);\r\n\t\t\tthis.toggleArticleEditing(false);\r\n\t\t\t//this.setTextareaText();\r\n\t\t}\r\n\t}\r\n\r\n\ttoggleArticleEditing(newValue = !this.state.articleEditing) {\r\n\t\tthis.setState({ articleEditing: newValue });\r\n\t}\r\n\r\n\ttoggleArticleEditing1() {\r\n\t\tthis.setState({ articleEditing: !this.state.articleEditing });\r\n\t}\r\n\r\n\thandleChange(event) {\r\n\t\tthis.setState({ textAreaText: event.target.value });\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst { article, loading, articleParams: { origText, changedText, status }, isAuth, task, lang } = this.props;\r\n\t\tconst { articleEditing, textAreaText } = this.state;\r\n\t\tconst error = false;\r\n\r\n\t\tconst savingProcess = false;\r\n\t\t\r\n\t\treturn <div>\r\n\t\t\t{error ? <div>Error!</div> : <div>{loading ? <div>Loading</div> : <div><h3>{article && article !== '' ? ArticleTitle(article, lang) : \"\"}</h3>\r\n\t\t\t\t{!isAuth && <div className=\"alert alert-primary\" role=\"alert\">\r\n\t\t\t\t\tYou have to <a href=\"//tools.wmflabs.org/booster/login\" className=\"alert-link\">log-in</a> to save actions!\r\n\t\t\t\t</div>}\r\n\t\t\t\t<div className=\"btn-group actionButtons\" role=\"group\">\r\n\t\t\t\t\t<button disabled={savingProcess} type=\"button\" className=\"btn btn-outline-success\" onClick={this.saveArticle('success')}>Save</button>\r\n\t\t\t\t\t<button disabled={savingProcess} type=\"button\" className=\"btn btn-outline-info\" onClick={this.props.goToNextArticle}>Skip</button>\r\n\t\t\t\t\t<button disabled={savingProcess} type=\"button\" className=\"btn btn-outline-danger\" onClick={this.saveArticle('error')}>No action needed</button>\r\n\t\t\t\t\t{<button disabled={savingProcess} type=\"button\" className=\"btn btn-outline-info\" onClick={this.toggleArticleEditing1}>Make changes</button>}\r\n\t\t\t\t</div>\r\n\t\t\t\t{status === 'noaction' ? <div className=\"noActionNeeded\">No action needed for this article (press \"Save\")</div> : <div><h4>Edits</h4>\r\n\t\t\t\t\t{origText === textAreaText ? <div className=\"noActionNeeded\">No edit was made</div> : Comparision(origText, textAreaText)}</div>}\r\n\t\t\t\t{articleEditing ? <div>\r\n\t\t\t\t\t<h4>Edit text</h4>\r\n\t\t\t\t\tYou have the option to edit text before saving it to Wikipedia:\r\n\t\t\t\t<textarea className=\"form-control\" rows={10} value={textAreaText} onChange={this.handleChange} />\r\n\t\t\t\t</div> : \"\"}</div>\r\n\r\n\t\t\t}</div>}\r\n\t\t</div>;\r\n\t}\r\n}","export const GET_TASKS = 'GET_TASKS';\r\nexport const SET_TASK = 'SET_TASK';\r\nexport const SET_ARTICLE_LIST = 'SET_ARTICLE_LIST';\r\nexport const REMOVE_FROM_LIST = 'REMOVE_FROM_LIST';\r\nexport const SET_ARTICLE_LIST_LOADING = 'SET_ARTICLE_LIST_LOADING';\r\nexport const SET_ARTICLE = 'SET_ARTICLE';\r\nexport const SET_ARTICLE_DATA = 'SET_ARTICLE_DATA';\r\nexport const SET_ARTICLE_LOADING = 'SET_ARTICLE_LOADING';\r\nexport const SET_ARTICLE_SAVING = 'SET_ARTICLE_SAVING';\r\nexport const HANDLE_TEXT_CHANGE = 'HANDLE_TEXT_CHANGE';\r\n\r\nexport const setArticle = ({article, key}) => ({//article - title, key - ID\r\n\ttype: SET_ARTICLE,\r\n\tarticle,\r\n\tkey\r\n});\r\n\r\nexport const hadleTextChange = (newText) => ({\r\n\ttype: HANDLE_TEXT_CHANGE,\r\n\tnewText\r\n})\r\n\r\nexport const setArticleData = ({origText,status, changedText}) => ({\r\n\ttype: SET_ARTICLE_DATA,\r\n\tpayload: {\r\n\t\torigText,status, changedText\r\n\t}\r\n});\r\n\r\nexport const setArticleLoading = (status) => ({\r\n\ttype: SET_ARTICLE_LOADING,\r\n\tpayload: status\r\n});\r\n\r\nexport const setArticleSaving = (status) => ({\r\n\ttype: SET_ARTICLE_SAVING,\r\n\tpayload: status\r\n});\r\n\r\nexport const setArticleListLoading = (status) => ({\r\n\ttype: SET_ARTICLE_LIST_LOADING,\r\n\tpayload: status\r\n});\r\n\r\nexport const getTasks = (taskData) => ({\r\n\ttype: GET_TASKS,\r\n\tpayload: taskData\r\n});\r\n\r\nexport const setTask = (id) => ({\r\n\ttype: SET_TASK,\r\n\tid\r\n});\r\n\r\nexport const setArticlesToList = (list) => ({\r\n\ttype: SET_ARTICLE_LIST,\r\n\tlist\r\n});\r\n\r\nexport const removeArticleFromList = (article) => ({\r\n\ttype: REMOVE_FROM_LIST,\r\n\tarticle\r\n});","export const urlendpoint = (process.env.NODE_ENV === 'development')\r\n    ? 'http://localhost:5000/'//'http://127.0.0.1:5000/'\r\n\t: '/';\r\n//'http://127.0.0.1:5000/'\r\n","import { connect } from 'react-redux';\r\nimport Task from '../components/task';\r\nimport { setArticleData, setArticleLoading, setArticle, setArticleSaving, hadleTextChange } from '../actions/tasks';\r\n\r\n\r\nimport { toast } from 'react-toastify';\r\n\r\nimport { urlendpoint } from '../config';\r\n\r\nconst mapStateToProps = (state) => ({\r\n\tlang: state.app.wiki,\r\n\tisAuth: state.auth.isAuth,\r\n\tarticle: state.tasks.currentArticle.name,\r\n\tloading: state.tasks.articleLoading,\r\n\tarticleParams: state.tasks.currentArticle.params,\r\n\ttask: state.tasks.taskId//pēc tam izņemt\r\n});\r\n\r\nconst mapDispatchToProps = (dispatch) => ({\r\n\tsetArticleData: (cb) => {\r\n\t\tdispatch(handleArticleSet(cb));\r\n\t},\r\n\tgoToNextArticle: () => {\r\n\t\tdispatch(setArticle({}));\r\n\t},\r\n\tsaveArticleData: (data) => {\r\n\t\tdispatch(handleArticleSave(data));\r\n\t},\r\n\tsetChangedText: (newText) => {\r\n\t\tdispatch(hadleTextChange(newText));\r\n\t}\r\n});\r\n\r\nconst handleArticleSet = (cb) => {\r\n\treturn function (dispatch, getState) {\r\n\t\tdispatch(setArticleLoading(true));\r\n\r\n\t\tconst state = getState();\r\n\r\n\t\tconst currTask = state.tasks.taskId;\r\n\t\tconst articleTitle = state.tasks.currentArticle.name;\r\n\t\tconst lang = state.app.wiki;\r\n\r\n\t\tlet url = `${urlendpoint}task/${lang}/${currTask}/${articleTitle}`;\r\n\r\n\t\tif (currTask === 101) {\r\n\t\t\turl = `${urlendpoint}typo/fix/${articleTitle}`;\r\n\t\t}\r\n\r\n\t\treturn fetch(url)\r\n\t\t\t.then(\r\n\t\t\t\tresponse => response.json(),\r\n\t\t\t\terror => console.log('An error occurred.', error)\r\n\t\t\t)\r\n\t\t\t.then(json => {\r\n\r\n\t\t\t\tconst { status, origText, changedText, message } = json;\r\n\r\n\t\t\t\tconst finalStatus = origText == null || changedText == null ? 'noaction' : status;\r\n\r\n\t\t\t\tlet origTextFinal = origText ? origText : '';\r\n\t\t\t\tlet changedTextFinal = changedText ? changedText : '';\r\n\r\n\t\t\t\tdispatch(setArticleData({ origText: origTextFinal, status: finalStatus, changedText: changedTextFinal }));\r\n\r\n\t\t\t\tdispatch(setArticleLoading(false));\r\n\r\n\t\t\t\tcb();\r\n\t\t\t})\r\n\t}\r\n}\r\n\r\nconst handleArticleSave = (props) => {\r\n\treturn function (dispatch, getState) {\r\n\t\tdispatch(setArticleSaving(true));\r\n\r\n\t\tconst state = getState();\r\n\r\n\t\tconst currTask = state.tasks.taskId;\r\n\t\tconst lang = state.app.wiki;\r\n\r\n\t\tconst { name: articleTitle, params: { changedText, status } } = state.tasks.currentArticle;\r\n\r\n\t\tconst { result, textForSave } = props;//ok/error\r\n\r\n\t\tconst dataToSend = {\r\n\t\t\twiki: lang.replace('wiki', ''),\r\n\t\t\tjob: currTask,\r\n\t\t\tstatus,//check for 'noaction'\r\n\t\t\tarticle: articleTitle,//articleID == null ? 0 : articleID,\r\n\t\t\tresult,\r\n\t\t\twikitext: changedText == null ? '' : textForSave\r\n\t\t};\r\n\r\n\t\treturn fetch(urlendpoint + 'save', { method: \"POST\", headers: { \"Content-Type\": \"application/json\" }, body: JSON.stringify(dataToSend) })\r\n\t\t\t.then(\r\n\t\t\t\tresponse => response.json(),\r\n\t\t\t\terror => console.log('An error occurred.', error)\r\n\t\t\t)\r\n\t\t\t.then(data => {\r\n\t\t\t\tdispatch(setArticleSaving(false));\r\n\r\n\t\t\t\tif (data.status === 'ok' || data.status === 'info') {\r\n\t\t\t\t\ttoast.info('Saved!', { autoClose: 3000 });\r\n\t\t\t\t\tdispatch(setArticle({}));\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttoast.warn('An error occurred.', { autoClose: 4500 });\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(data => {\r\n\t\t\t\tdispatch(setArticleSaving(false));\r\n\t\t\t\ttoast.warn('An error occurred.', { autoClose: 4500 });\r\n\t\t\t});\r\n\t}\r\n}\r\n\r\nexport default connect(\r\n\tmapStateToProps,\r\n\tmapDispatchToProps\r\n)(Task);\r\n","import { connect } from 'react-redux';\r\nimport ArticleList from '../components/articleList';\r\nimport {setArticle} from '../actions/tasks';\r\n\r\nconst mapStateToProps = (state) => ({\r\n\tarticles: state.tasks.articles,\r\n\tarticleId: state.tasks.currentArticle.id\r\n});\r\n\r\nconst mapDispatchToProps = (dispatch) => ({\r\n\tselectArticle: (article, key) => {\r\n\t\tdispatch(setArticle({article, key}));\r\n\t},\r\n});\r\n\r\nexport default connect(\r\n\tmapStateToProps,\r\n  \tmapDispatchToProps\r\n)(ArticleList);","import React from 'react';\r\n\r\nexport default function ArticleList({articles, articleId, selectArticle}) {\r\n\treturn <div id=\"articleList\">\r\n\t<div id=\"articleListTitle\"><h3>Article list</h3></div>\r\n\t\t{articles.length>0 ? articles.map((article, key) => <div key={key} onClick={() => selectArticle(article, key)} className={articleId === key ? \"currentArticle\" : \"articleItem\"}>{article}</div>) : \"\"}\r\n\t</div>;\r\n};","import React, { Component } from 'react';\r\nimport Task from '../containers/Task';\r\nimport ArticleList from \"../containers/ArticleList\";\r\nimport './taskPage.scss';\r\n\r\nexport default class TaskPage extends Component {\r\n\tsetup() {\r\n\t\tconst { id } = this.props.match.params;\r\n\t\tthis.props.setTask(id);\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.setup();\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps) {\r\n\t\tif (this.props.match.params.id !== prevProps.match.params.id) {\r\n\t\t\tthis.setup();\r\n\t\t}\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst { loading, articles } = this.props;\r\n\t\tconst error = false;\r\n\r\n\t\treturn (<div>{error ? <div>Error</div> : <div>{loading ? \"Loading\" : <div>{articles.length > 0 ? <div>\r\n\t\t\t<div id=\"taskPageFormat\">\r\n\t\t\t\t<div>\r\n\t\t\t\t\t<ArticleList />\r\n\t\t\t\t</div>\r\n\t\t\t\t<div id=\"taskArea\">\r\n\t\t\t\t\t<Task />\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div> : \"No articles!\"}</div>}</div>}\r\n\t\t</div>\r\n\r\n\t\t);\r\n\t}\r\n}\r\n// article={articles[articleId]} task={taskId} goToNextArticle={this.goToNextArticle}","export const SET_WIKI_LANGUAGE = 'SET_WIKI_LANGUAGE';\r\n\r\nexport const setWikiLanguage = (language) => ({\r\n\ttype: SET_WIKI_LANGUAGE,\r\n\tlanguage\r\n});\r\n\r\nexport const SET_WIKI_OPTIONS = 'SET_WIKI_OPTIONS';\r\n\r\nexport const setWikiOptions = (data) => ({\r\n\ttype: SET_WIKI_OPTIONS,\r\n\tdata\r\n});\r\n\r\nexport const NULLIFY_APP_STATE = 'NULLIFY_APP_STATE';\r\n\r\nexport const nullifyAppState = () => ({\r\n\ttype: NULLIFY_APP_STATE\r\n});","import { connect } from 'react-redux';\r\nimport TaskPage from '../components/TaskPage';\r\nimport {setTask, setArticlesToList, setArticleListLoading} from '../actions/tasks';\r\nimport { setWikiLanguage } from '../actions/app';\r\n\r\nimport { withRouter } from \"react-router\";\r\n\r\nimport { urlendpoint } from '../config';\r\n/*\r\n\r\nconst defaultState = {\r\n\ttaskId: null,\r\n\tdescription: [],\r\n\tarticlesLoading: false,\r\n\tarticles: []\r\n};\r\n\r\n*/\r\n\r\nconst mapStateToProps = (state) => ({\r\n\tarticles: state.tasks.articles,\r\n\tloading: state.tasks.articlesLoading,\r\n\tarticleId: state.tasks.currentArticle.id,\r\n\ttaskId: state.tasks.taskId//pēc tam izņemt\r\n});\r\n\r\nconst mapDispatchToProps = (dispatch, ownProps) => ({\r\n\tsetTask: (id) => {\r\n\t\tdispatch(setTask(id));\r\n\r\n\t\tdispatch(setArticleList(ownProps.match.params.lang));\r\n\t},\r\n});\r\n\r\nconst setArticleList = (langProp) => {\r\n\treturn function(dispatch, getState) {\r\n\t\tdispatch(setArticleListLoading(true));\r\n\r\n\t\tconst state = getState();\r\n\r\n\t\tif (state.app.wiki === null) {\r\n\t\t\tdispatch(setWikiLanguage(langProp));\r\n\t\t}\r\n\r\n\t\tconst currTask = state.tasks.taskId;\r\n\t\tconst lang = state.app.wiki;\r\n\r\n\t  return fetch(`${urlendpoint}task/${lang}/${currTask}/articles`)\r\n\t\t.then(\r\n\t\t  response => response.json(),\r\n\t\t  error => console.log('An error occurred.', error)\r\n\t\t)\r\n\t\t.then(json => {\r\n\t\t\tdispatch(setArticlesToList(json));\r\n\t\t\tdispatch(setArticleListLoading(false));\r\n\t\t})\r\n\t}\r\n}\r\n\r\nexport default withRouter(connect(\r\n\tmapStateToProps,\r\n  \tmapDispatchToProps\r\n)(TaskPage));","import React, { useEffect } from 'react';\r\nimport { connect } from 'react-redux';\r\nimport { setWikiLanguage, nullifyAppState } from '../actions/app';\r\nimport { getTasks } from '../actions/tasks';\r\n\r\nimport { withRouter } from \"react-router\";\r\n\r\nimport { urlendpoint } from '../config';\r\n\r\nimport './mainPage.scss';\r\n\r\n//https://daveceddia.com/access-redux-store-outside-react/\r\n\r\nconst MainPage = (props) => {\r\n\tconst handleClick = (id, hasArticles) => (event) => {\r\n\t\tif (hasArticles === null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\twindow.location = `#/${wiki}/task/${id}`;\r\n\t}\r\n\r\n\tconst handleClickWiki = (wiki) => (event) => {\r\n\t\twindow.location = '#/' + wiki;\r\n\t\tprops.setWikiLang(wiki);\r\n\t}\r\n\r\n\r\n\tuseEffect(() => {\r\n\t\tconst wikiLang = props.match.params.lang;\r\n\t\tif (wikiLang) {\r\n\t\t\tprops.setWikiLang(wikiLang);\r\n\t\t} else {\r\n\t\t\tprops.setInitialState();\r\n\t\t}\r\n\t}, [props.match.params.lang]);\r\n\r\n\tconst { tasks, wiki, wikis } = props;\r\n\r\n\treturn <div className=\"container\">\r\n\t\t<h2><i>WikiBooster</i></h2>\r\n\t\t{wikis.length > 0 && wiki === null &&\r\n\t\t\t<>\r\n\t\t\t\tChoose Wikipedia to work on!\r\n\t\t<div className=\"wikis\">\r\n\t\t\t\t\t{wikis.map((wikiLang, key) => <div className=\"myCard\" key={key} style={{ cursor: 'pointer' }} onClick={handleClickWiki(wikiLang)}>{wikiLang}</div>)}\r\n\t\t\t\t</div>\r\n\t\t\t</>\r\n\t\t}\r\n\r\n\t\t{wiki && <>{tasks.length > 0 ?\r\n\t\t\t<div className=\"tasks\">\r\n\t\t\t\t{tasks.map((task, key) => <div className=\"myCard\" key={key}><span className={\"title\" + (task.hasArticles ? ' clickable' : '')} onClick={handleClick(task.url_id, task.hasArticles)}>{task.task}</span><br /><span className=\"description\">{task.description}</span>{task.hasArticles == null && <span className=\"noArticles\">no articles</span>}</div>)}\r\n\t\t\t</div> : \"No tasks currently available for this Wikipedia\"}</>\r\n\t\t}\r\n\t</div>\r\n};\r\n\r\nconst mapStateToProps = (state) => ({\r\n\ttasks: state.tasks.description,\r\n\twikis: state.app.wikis,\r\n\twiki: state.app.wiki\r\n});\r\n\r\nconst mapDispatchToProps = (dispatch) => ({\r\n\tsetWikiLang: (lang) => {\r\n\t\tdispatch(setWikiLanguage(lang));\r\n\r\n\t\tdispatch(setInitialAppData());\r\n\t},\r\n\tsetInitialState: () => {\r\n\t\tdispatch(nullifyAppState());\r\n\t}\r\n});\r\n\r\nconst setInitialAppData = () => {\r\n\treturn function (dispatch, getState) {\r\n\t\tconst state = getState();\r\n\r\n\t\tconst currLanguage = state.app.wiki;\r\n\r\n\t\treturn fetch(`${urlendpoint}tasks/${currLanguage}`)\r\n\t\t\t.then(\r\n\t\t\t\tresponse => response.json(),\r\n\t\t\t\terror => console.log('An error occurred.', error)\r\n\t\t\t)\r\n\t\t\t.then(json =>\r\n\t\t\t\tdispatch(getTasks(json))\r\n\t\t\t)\r\n\t}\r\n}\r\n\r\nexport default withRouter(connect(\r\n\tmapStateToProps,\r\n\tmapDispatchToProps\r\n)(MainPage));","import React, { Component } from 'react';\r\nimport { toast } from 'react-toastify';\r\nimport { urlendpoint } from '../config';\r\n\r\nimport { withRouter } from \"react-router\";\r\n\r\nclass TypoRow extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.state = {\r\n\t\t\tloading: false,\r\n\t\t\terror: false,\r\n\t\t\tdata: {},\r\n\t\t\t/* tests: [\r\n\t\t\t\t{test: '', expected: '', result: true, actual: ''}\r\n\t\t\t] */\r\n\t\t};\r\n\t}\r\n\r\n\tsetupDate = () => {\r\n\t\tthis.setState({\r\n\t\t\tdata: this.props.data\r\n\t\t})\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.setupDate();\r\n\t}\r\n\r\n\thandleChange = (key, section = 'data') => (event) => {\r\n\t\tlet value = event.target.type === 'checkbox' ? event.target.checked : event.target.value;\r\n\r\n\t\tthis.setState({\r\n\t\t\t[section]: {\r\n\t\t\t\t...this.state[section],\r\n\t\t\t\t[key]: value\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\thandleTestChange = (key, section = 'data') => (event) => {\r\n\t\tlet value = event.target.type === 'checkbox' ? event.target.checked : event.target.value;\r\n\r\n\t\tlet tests = [...this.state.tests];\r\n\t\tlet item = { ...tests[key] };\r\n\t\titem[section] = value;\r\n\t\ttests[key] = item;\r\n\r\n\t\tthis.setState({ tests }, () => console.log(this.state, key, section));\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps) {/* \r\n\t\tif (this.props.match.params.lang !== prevProps.match.params.lang) {\r\n\t\t\tthis.setupDate();\r\n\t\t} */\r\n\t}\r\n\r\n\taddNewTest = () => {\r\n\t\tthis.setState(state => {\r\n\t\t\tconst list = [...state.tests, { test: '', expected: '', result: true, actual: '' }];\r\n\t\t\treturn {\r\n\t\t\t\ttests: list\r\n\t\t\t};\r\n\t\t});\r\n\t}\r\n\r\n\tsaveData = () => {\r\n\t\tconst { search_for, id } = this.state.data;\r\n\t\tif (search_for.trim() === '') {\r\n\t\t\ttoast.warn(\"Add at least search phrase\", { autoClose: 5000 });\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tconsole.log(this.props.match.params)\r\n\t\tconst dataToSend = Object.assign({}, this.state.data, { wiki: this.props.match.params.lang });\r\n\r\n\t\tfetch(`${urlendpoint}save_typo`, { method: \"POST\", headers: { \"Content-Type\": \"application/json\" }, body: JSON.stringify(dataToSend) })\r\n\t\t\t.then(\r\n\t\t\t\tresponse => response.json(),\r\n\t\t\t\terror => console.log('An error occurred.', error)\r\n\t\t\t)\r\n\t\t\t.then(json => {\r\n\t\t\t\tif (json.status === 'ok') {\r\n\t\t\t\t\ttoast.success(\"Typo saved!\", { autoClose: 4000 });\r\n\t\t\t\t\tconst dataToSendToParent = Object.assign({}, this.state.data, { id: json.id, isNew: id == 0, rowID: this.props.row });\r\n\r\n\t\t\t\t\tthis.props.onDataUpdate(dataToSendToParent);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t)\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst { data } = this.state;\r\n\r\n\t\treturn <div style={{ width: '99%' }}>\r\n\t\t\t<div className=\"form-row\">\r\n\t\t\t\t<div className=\"form-group col-md-4\">\r\n\t\t\t\t\t<label for=\"inputTitle\">Title</label>\r\n\t\t\t\t\t<input type=\"text\" className=\"form-control\" id=\"inputTitle\" value={data.name} onChange={this.handleChange('name')} />\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"form-group col-md-4\">\r\n\t\t\t\t\t<label for=\"inputFrom\">What to search for?</label>\r\n\t\t\t\t\t<input type=\"text\" className=\"form-control\" id=\"inputFrom\" value={data.search_for} onChange={this.handleChange('search_for')} />\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"form-group col-md-4\">\r\n\t\t\t\t\t<label for=\"inputTo\">What to replace with?</label>\r\n\t\t\t\t\t<input type=\"text\" className=\"form-control\" id=\"inputTo\" value={data.replace_with} onChange={this.handleChange('replace_with')} />\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<div className=\"form-row\">\r\n\t\t\t\t<div className=\"form-group col-md-4\">\r\n\t\t\t\t\t<label for=\"inputComment\">Comment</label>\r\n\t\t\t\t\t<textarea className=\"form-control\" id=\"inputComment\" value={data.comment} onChange={this.handleChange('comment')}></textarea>\r\n\t\t\t\t</div>\r\n\t\t\t\t{/* regex: false, case: false, wholeWorld:true, active: true, dump: false, minor: true */}\r\n\t\t\t\t<div className=\"form-group col-md-4\">\r\n\t\t\t\t\t<div className=\"form-check\">\r\n\t\t\t\t\t\t<input className=\"form-check-input\" type=\"checkbox\" id=\"activeCheck\" checked={data.active} onChange={this.handleChange('active')} />\r\n\t\t\t\t\t\t<label className=\"form-check-label\" for=\"activeCheck\">Active</label>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"form-check\">\r\n\t\t\t\t\t\t<input className=\"form-check-input\" type=\"checkbox\" id=\"regexCheck\" checked={data.regex} onChange={this.handleChange('regex')} />\r\n\t\t\t\t\t\t<label className=\"form-check-label\" for=\"regexCheck\">Is regex</label>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"form-check\">\r\n\t\t\t\t\t\t<input className=\"form-check-input\" type=\"checkbox\" id=\"caseCheck\" checked={data.case} onChange={this.handleChange('case')} />\r\n\t\t\t\t\t\t<label className=\"form-check-label\" for=\"caseCheck\">Case sensitive</label>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"form-group col-md-4\">\r\n\t\t\t\t\t<div className=\"form-check\">\r\n\t\t\t\t\t\t<input className=\"form-check-input\" type=\"checkbox\" id=\"wholeWorldCheck\" checked={data.whole} onChange={this.handleChange('whole')} />\r\n\t\t\t\t\t\t<label className=\"form-check-label\" for=\"wholeWorldCheck\">Match whole words</label>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"form-check\">\r\n\t\t\t\t\t\t<input className=\"form-check-input\" type=\"checkbox\" id=\"dumpCheck\" checked={data.dumpsearch} onChange={this.handleChange('dumpsearch')} />\r\n\t\t\t\t\t\t<label className=\"form-check-label\" for=\"dumpCheck\">Search dump</label>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t\t<div className=\"form-check\">\r\n\t\t\t\t\t\t<input className=\"form-check-input\" type=\"checkbox\" id=\"minorCheck\" checked={data.minor} onChange={this.handleChange('minor')} />\r\n\t\t\t\t\t\t<label className=\"form-check-label\" for=\"minorCheck\">Is minor</label>\r\n\t\t\t\t\t</div>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t{/* <h4>Test-cases <span style={{fontSize:'small'}}>(<span style={{cursor:'pointer'}} onClick={this.addNewTest} title=\"add new test-case\">+</span>)</span></h4>\r\n\t\t\t{tests.map((test, key) => <div className=\"form-row\">\r\n\t\t\t\t<div className=\"form-group col-md-4\">\r\n\t\t\t\t\t<label for={`inputTest${key}Text`}>Test text</label>\r\n\t\t\t\t\t<textarea className=\"form-control\" id={`inputTest${key}Text`} value={test.test} onChange={this.handleTestChange(key,'test')}></textarea>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"form-group col-md-4\">\r\n\t\t\t\t\t<label for={`inputTest${key}Expected`}>Expected text</label>\r\n\t\t\t\t\t<textarea className=\"form-control\" id={`inputTest${key}Expected`} value={test.expected} onChange={this.handleTestChange(key,'expected')}></textarea>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"form-group col-md-4\">\r\n\t\t\t\t\t<label for={`inputTest${key}Actual`}>Actual text</label>\r\n\t\t\t\t\t<textarea className=\"form-control\" id={`inputTest${key}Actual`} value={test.actual}></textarea>\r\n\t\t\t\t</div>\r\n\t\t\t</div>)} */}\r\n\r\n\t\t\t<button type=\"button\" className=\"btn btn-primary\" onClick={this.saveData}>Save</button>\r\n\t\t</div>;\r\n\t}\r\n}\r\n\r\nexport default withRouter(TypoRow);","import React, { Component } from 'react';\r\nimport { toast } from 'react-toastify';\r\nimport ReactTable from \"react-table\";\r\nimport TypoRow from \"./TypoRow\";\r\nimport \"react-table/react-table.css\";\r\nimport { urlendpoint } from '../config';\r\n\r\nlet setAll = (obj, val) => Object.keys(obj).forEach(k => obj[k] = val);\r\n\r\nconst cleanValue = (typoObject) => {\r\n\tlet typoObject2 = Object.keys(typoObject).reduce(\r\n\t\t(accumulator, current) => {\r\n\t\t  accumulator[current] = null; \r\n\t\t  return accumulator\r\n\t\t}, {});\r\n\tconsole.log(typoObject2);\r\n\ttypoObject2.id = 0;\r\n\treturn typoObject2;\r\n}\r\n\r\nexport default class TypoManagement extends Component {\r\n\tconstructor(props) {\r\n\t\tsuper(props);\r\n\t\tthis.state = {\r\n\t\t\tloading: false,\r\n\t\t\terror: false,\r\n\t\t\tdata: [],\r\n\t\t\tpage:0,\r\n\t\t\texpanded: {}\r\n\t\t};\r\n\t}\r\n\r\n\tsetupDate = () => {\r\n\t\tconst wiki = this.props.match.params.lang;\r\n\r\n\t\t/* this.setState({\r\n\t\t\tdata: [{ \"active\": 1, \"case\": null, \"comment\": null, \"dumpsearch\": null, \"minor\": null, \"name\": \"pa retam\", \"regex\": 1, \"replace_with\": \"\\\\1a retam\", \"search_for\": \"([Pp])aretam\", \"test_cases\": null, \"whole\": null, id:1 }]\r\n\t\t}) */\r\n\r\n\t\tfetch(`${urlendpoint}typo/${wiki}`)\r\n\t\t\t.then(\r\n\t\t\t\tresponse => response.json(),\r\n\t\t\t\terror => console.log('An error occurred.', error)\r\n\t\t\t)\r\n\t\t\t.then(json =>\r\n\t\t\t\t\r\n\t\t\t\tthis.setState({\r\n\t\t\t\t\tdata: json\r\n\t\t\t\t})\r\n\t\t\t)\r\n\r\n\r\n\t}\r\n\r\n\tsetAsIncorrect() {\r\n\t\tthis.props.goToNextArticle();\r\n\t}\r\n\r\n\tcomponentDidMount() {\r\n\t\tthis.setupDate();\r\n\t}\r\n\r\n\tcomponentDidUpdate(prevProps) {\r\n\t\tif (this.props.match.params.lang !== prevProps.match.params.lang) {\r\n\t\t\tthis.setupDate();\r\n\t\t}\r\n\t}\r\n\r\n\taddNew = () => {\r\n\t\tconst {page, data, expanded } = this.state;\r\n\t\tconst numberOfRows = data.length;\r\n\r\n\t\tconst lastPage = Math.round(numberOfRows/10);\r\n\t\t\r\n\t\tthis.setState({\r\n\t\t\tdata: [\r\n\t\t\t\t...this.state.data,\r\n\t\t\t\tcleanValue(this.state.data[0])\r\n\t\t\t],\r\n\t\t\texpanded: {\r\n\t\t\t\t...this.state.expanded,\r\n\t\t\t\t[numberOfRows]:{}\r\n\t\t\t},\r\n\t\t\t//page:lastPage\r\n\t\t})\r\n\t}\r\n\r\n\thandleDataUpdate = (typoData) => {\r\n\t\t/* const {active, rowID, name, replace_with, search_for, id, isNew} = typoData;\r\n\t\tconst {data} = this.state;\r\n\t\t */\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst { error, loading, data } = this.state;\r\n\r\n\t\tif (error) {\r\n\t\t\treturn <div>Error!</div>\r\n\t\t}\r\n\r\n\t\tif (loading) {\r\n\t\t\treturn <div>Loading...</div>\r\n\t\t}\r\n\r\n\t\treturn <div>{data && data.length > 0 && <>\r\n\t\t\t<ReactTable\r\n\t\t\t\tdata={data}\r\n\t\t\t\tcolumns={[\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tHeader: \"Name\",\r\n\t\t\t\t\t\taccessor: \"name\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tHeader: \"What to search for?\",\r\n\t\t\t\t\t\taccessor: \"search_for\"\r\n\t\t\t\t\t},\r\n\t\t\t\t\t{\r\n\t\t\t\t\t\tHeader: \"What to replace with\",\r\n\t\t\t\t\t\taccessor: \"replace_with\"\r\n\t\t\t\t\t}\r\n\t\t\t\t]}\r\n\t\t\t\tdefaultPageSize={10}\r\n\t\t\t\tclassName=\"-striped -highlight\"\r\n\t\t\t\tSubComponent={(row) => {\r\n\t\t\t\t\treturn <TypoRow data={row.row._original} onDataUpdate={this.handleDataUpdate} row={row.index} />\r\n\t\t\t\t}}\r\n\t\t\t\tpage={this.state.page}\r\n\t\t\t\texpanded={this.state.expanded}\r\n\t\t\t\tonPageChange={page => this.setState({ page })}\r\n\t\t\t\tonExpandedChange={expanded => this.setState({ expanded })}\r\n\t\t\t/>\r\n\t\t</>}\r\n\t\t<button onClick={this.addNew} type=\"button\" className=\"btn btn-primary\">Add new typo!</button>\r\n\t\t</div>;\r\n\t}\r\n}","import React from 'react';\r\nimport { Navbar, Nav, NavDropdown, Tooltip, OverlayTrigger } from 'react-bootstrap';\r\n\r\nconst Header = (props) => {\r\n\t//\r\n\tconst { isAuth, username, tasks, wikis, wiki } = props;\r\n\r\n\tconst wikiLang = wiki && wiki.replace('wiki', '');\r\n\r\n\tconst taskList = tasks\r\n\t\t.filter(item => item.hasArticles !== null)\r\n\t\t.map((item, key) => <NavDropdown.Item key={key} href={`#/${wiki}/task/${item.url_id}`}>{item.nav_title}</NavDropdown.Item>);\r\n\r\n\tconst wikiList = wikis\r\n\t\t//.filter(item => item.hasArticles !== null)\r\n\t\t.map((item, key) => <NavDropdown.Item key={key} href={`#/${item}`}>{item}</NavDropdown.Item>);\r\n\r\n\treturn <Navbar expand=\"lg\" bg=\"dark\" variant=\"dark\">\r\n\t\t<Navbar.Brand href=\"#/\">WikiBooster</Navbar.Brand>\r\n\t\t<Navbar.Toggle aria-controls=\"navbar-nav\" />\r\n\t\t<Navbar.Collapse id=\"navbar-nav\">\r\n\t\t\t<Nav>\r\n\t\t\t\t<NavDropdown title=\"Wikis\" id=\"nav-wikis\">\r\n\t\t\t\t\t{wikiList}\r\n\t\t\t\t</NavDropdown>\r\n\t\t\t\t{wiki !== null && taskList.length > 0 &&\r\n\t\t\t\t\t<NavDropdown title=\"Tasks\" id=\"nav-tasks\">\r\n\t\t\t\t\t\t{taskList}\r\n\t\t\t\t\t</NavDropdown>}\r\n\t\t\t</Nav>\r\n\t\t\t<Nav className=\"ml-auto\">\r\n\t\t\t\t<OverlayTrigger\r\n\t\t\t\t\tplacement=\"bottom\"\r\n\t\t\t\t\tdelay={{ show: 200 }}\r\n\t\t\t\t\toverlay={<Tooltip id=\"t-github\">Github</Tooltip>}\r\n\t\t\t\t>\r\n\t\t\t\t\t<Nav.Link href=\"https://github.com/kosovojs/wikibooster\" target=\"_blank\" rel=\"noopener noreferrer\"><i className=\"fab fa-github spaced fa-lg\"></i></Nav.Link>\r\n\t\t\t\t</OverlayTrigger>\r\n\t\t\t</Nav>\r\n\t\t\t<Nav>\r\n\t\t\t\t{isAuth ? <>\r\n\t\t\t\t\t<NavDropdown title={`Hi, ${username}!`} id=\"nav-tasks\">\r\n\t\t\t\t\t\t{wiki && <NavDropdown.Item href={`//${wikiLang}.wikipedia.org/wiki/Special:Contributions/${username}`}>Contributions</NavDropdown.Item>}\r\n\t\t\t\t\t\t<NavDropdown.Item href=\"/booster/logout\"><i className=\"fas fa-sign-out-alt\"></i> Logout</NavDropdown.Item>\r\n\t\t\t\t\t</NavDropdown>\r\n\t\t\t\t</> : <Nav.Link href=\"/booster/login\"><i className=\"fas fa-sign-in-alt\"></i> Login</Nav.Link>}\r\n\t\t\t</Nav>\r\n\t\t</Navbar.Collapse>\r\n\t</Navbar>;\r\n};\r\n\r\nexport default Header;","import { connect } from 'react-redux';\r\nimport Header from '../components/Header';\r\n\r\nconst mapStateToProps = (state) => ({\r\n\tisAuth: state.auth.isAuth,\r\n\tusername: state.auth.username,\r\n\ttasks: state.tasks.description,\r\n\twiki: state.app.wiki,\r\n\twikis: state.app.wikis\r\n});\r\n\r\nexport default connect(\r\n\tmapStateToProps\r\n)(Header);","import { connect } from 'react-redux';\r\nimport TaskPage from '../components/TaskPage';\r\nimport {setTask, setArticlesToList, setArticleListLoading} from '../actions/tasks';\r\nimport { setWikiLanguage } from '../actions/app';\r\n\r\nimport { withRouter } from \"react-router\";\r\n\r\nimport { urlendpoint } from '../config';\r\n/*\r\n\r\nconst defaultState = {\r\n\ttaskId: null,\r\n\tdescription: [],\r\n\tarticlesLoading: false,\r\n\tarticles: []\r\n};\r\n\r\n*/\r\n\r\nconst mapStateToProps = (state) => ({\r\n\tarticles: state.tasks.articles,\r\n\tloading: state.tasks.articlesLoading,\r\n\tarticleId: state.tasks.currentArticle.id,\r\n\ttaskId: state.tasks.taskId//pēc tam izņemt\r\n});\r\n\r\nconst mapDispatchToProps = (dispatch, ownProps) => ({\r\n\tsetTask: (id) => {\r\n\t\tdispatch(setTask(101));\r\n\r\n\t\tdispatch(setArticleList(ownProps.match.params.lang));\r\n\t},\r\n});\r\n\r\nconst setArticleList = (langProp) => {\r\n\treturn function(dispatch, getState) {\r\n\t\tdispatch(setArticleListLoading(true));\r\n\r\n\t\tdispatch(setWikiLanguage('lvwiki'));\r\n\r\n\t  return fetch(`${urlendpoint}typo/articles`)\r\n\t\t.then(\r\n\t\t  response => response.json(),\r\n\t\t  error => console.log('An error occurred.', error)\r\n\t\t)\r\n\t\t.then(json => {\r\n\t\t\tdispatch(setArticlesToList(json));\r\n\t\t\tdispatch(setArticleListLoading(false));\r\n\t\t})\r\n\t}\r\n}\r\n\r\nexport default withRouter(connect(\r\n\tmapStateToProps,\r\n  \tmapDispatchToProps\r\n)(TaskPage));\r\n","import 'bootstrap/dist/css/bootstrap.css';\r\nimport React, { useEffect } from 'react';\r\nimport { HashRouter as Router, Route, Switch  } from 'react-router-dom';\r\n//import ArticleList from './components/articleList';\r\nimport TaskPage from '../containers/TaskPage';\r\nimport MainPage from './mainPage';\r\nimport TypoManagement from './TypoManagement';\r\nimport Header from '../containers/Header';\r\n//import {Footer} from '../Footer';\r\n\r\nimport { ToastContainer } from 'react-toastify';\r\nimport 'react-toastify/dist/ReactToastify.css';\r\nimport TypoPage from '../containers/TypoPage';\r\n\r\nconst NotFound = ({ location }) => (\r\n\t<div>\r\n\t  <h3>Did not found page <code>{location.pathname}</code></h3>\r\n\t</div>\r\n);\r\n\r\nfunction App(props) {\r\n\t//https://stackoverflow.com/questions/38563679/react-redux-dispatch-action-on-app-load-init\r\n   useEffect(() => props.initialLoad(), []);\r\n\r\n  return (\r\n\t<Router>\r\n\t\t  <Header />\r\n\t\t<Switch>\r\n\t\t  <Route exact path=\"/typofix\" component={TypoPage} />\r\n\t\t  <Route exact path=\"/:lang?\" component={MainPage} />\r\n\t\t  <Route exact path=\"/:lang/task/:id\" component={TaskPage} />\r\n\t\t  <Route exact path=\"/:lang/typo\" component={TypoManagement} />\r\n\t\t  <Route component={NotFound} />\r\n\t\t</Switch>\r\n\t\t<ToastContainer\r\n\t\tposition=\"bottom-right\"\r\n\t\tautoClose={2500}\r\n\t\thideProgressBar={false}\r\n\t\tnewestOnTop={false}\r\n\t\tcloseOnClick\r\n\t\trtl={false}\r\n\t\tpauseOnVisibilityChange\r\n\t\tdraggable={false}\r\n\t\tpauseOnHover\r\n\t\t/>\r\n\t\t{/* <Footer /> */}\r\n\t</Router>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import { connect } from 'react-redux';\r\nimport App from '../components/App';\r\nimport { setWikiLanguage, setWikiOptions } from '../actions/app';\r\nimport { checkAuth } from '../actions/auth';\r\n\r\nimport { urlendpoint } from '../config';\r\n\r\nconst DEFAULT_LANG = 'lv';\r\n\r\nconst mapDispatchToProps = (dispatch) => ({\r\n\tinitialLoad: () => {\r\n\t\tdispatch(setWikiLanguages());\r\n\t\t//dispatch(setWikiLanguage(DEFAULT_LANG));\r\n\r\n\t\t//dispatch(setInitialAppData());\r\n\r\n\t\tdispatch(checkAuth());\r\n\t},\r\n});\r\n\r\nconst setWikiLanguages = () => {\r\n\treturn function (dispatch, getState) {\r\n\r\n\t\treturn fetch(`${urlendpoint}wikis`)\r\n\t\t\t.then(\r\n\t\t\t\tresponse => response.json(),\r\n\t\t\t\terror => console.log('An error occurred.', error)\r\n\t\t\t)\r\n\t\t\t.then(json =>\r\n\t\t\t\tdispatch(setWikiOptions(json))\r\n\t\t\t)\r\n\t}\r\n}\r\n\r\nexport default connect(\r\n\tnull,\r\n\tmapDispatchToProps\r\n)(App);\r\n","import {urlendpoint} from '../config';\r\n\r\nexport const LOGIN = 'LOGIN';\r\nexport const LOGOUT = 'LOGOUT';\r\n\r\nexport const login = (username) => ({\r\n\ttype: LOGIN,\r\n\tusername\r\n});\r\n\r\nexport const logout = () => ({\r\n\ttype: LOGOUT\r\n});\r\n\r\nexport const checkAuth = () => {\r\n\treturn function(dispatch) {\r\n\t  return fetch(`${urlendpoint}info`)\r\n\t\t\t.then(\r\n\t\t\t\tresponse => response.json(),\r\n\t\t\t\terror => console.log('An error occurred.', error)\r\n\t\t\t)\r\n\t\t\t.then(json => {\r\n\t\t\t\tif (json.status === 'ok') {\r\n\t\t\t\t\tdispatch(login(json.username));\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t)\r\n\t}\r\n}\r\n","import { SET_WIKI_LANGUAGE, SET_WIKI_OPTIONS, NULLIFY_APP_STATE } from '../actions/app'\r\n\r\nconst defaultState = {\r\n\twiki: null,\r\n\twikis: []\r\n};\r\n\r\nconst app = (state = defaultState, action) => {\r\n\tswitch (action.type) {\r\n\t\tcase SET_WIKI_LANGUAGE: {\r\n\t\t\tconst { language } = action;\r\n\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\twiki: language\r\n\t\t\t};\r\n\t\t}\r\n\t\tcase SET_WIKI_OPTIONS: {\r\n\t\t\tconst { data } = action;\r\n\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\twikis: data\r\n\t\t\t};\r\n\t\t}\r\n\t\tcase NULLIFY_APP_STATE: {\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\twiki: null\r\n\t\t\t};\r\n\t\t}\r\n\t\tdefault:\r\n\t\t\treturn state\r\n\t}\r\n};\r\n\r\nexport default app;","import {LOGIN} from '../actions/auth';\r\n\r\nconst defaultState = {\r\n\tisAuth: false,\r\n\tusername: '',\r\n\terror: false,\r\n\terrorMessage: ''\r\n};\r\n\r\nconst auth = (state = defaultState, action) => {\r\n\tswitch (action.type) {\r\n\t  case LOGIN: {\r\n\t\t  const {username} = action;\r\n\t\t  \r\n\t\t  return {\r\n\t\t\t  ...state,\r\n\t\t\t  username,\r\n\t\t\t  isAuth: true\r\n\t\t  };\r\n\t  }\r\n\t  default:\r\n\t\treturn state\r\n\t}\r\n};\r\n\r\nexport default auth;","import { GET_TASKS, SET_TASK, SET_ARTICLE_LIST, REMOVE_FROM_LIST, SET_ARTICLE_LIST_LOADING, SET_ARTICLE, SET_ARTICLE_DATA, SET_ARTICLE_LOADING, HANDLE_TEXT_CHANGE } from '../actions/tasks';\r\n\r\nconst defaultState = {\r\n\ttaskId: null,\r\n\tdescription: [],\r\n\tarticlesLoading: false,\r\n\tarticleLoading: false,\r\n\tarticles: [],\r\n\tcurrentArticle: {\r\n\t\tname: '',\r\n\t\tid: null,\r\n\t\tparams: {\r\n\t\t\torigText: '',\r\n\t\t\tstatus: null,\r\n\t\t\tchangedText: ''\r\n\t\t}\r\n\t}\r\n};\r\n\r\nconst tasks = (state = defaultState, action) => {\r\n\tswitch (action.type) {\r\n\t\tcase GET_TASKS: {\r\n\t\t\tconst { payload } = action;\r\n\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tdescription: payload\r\n\t\t\t};\r\n\t\t}\r\n\t\tcase HANDLE_TEXT_CHANGE: {\r\n\t\t\tconst { newText } = action;\r\n\r\n\t\t\tconst newState = {...state};\r\n\t\t\tnewState.currentArticle.params.changedText = newText;\r\n\r\n\t\t\treturn newState;\r\n\t\t}\r\n\t\tcase SET_TASK: {\r\n\t\t\tconst { id } = action;\r\n\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\ttaskId: id,\r\n\t\t\t\tarticles: []\r\n\t\t\t};\r\n\t\t}\r\n\t\tcase SET_ARTICLE_LIST: {\r\n\t\t\tconst { list } = action;\r\n\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tarticles: list,\r\n\t\t\t\tcurrentArticle: {\r\n\t\t\t\t\tname: list[0],\r\n\t\t\t\t\tid: 0,\r\n\t\t\t\t\tparams: {\r\n\t\t\t\t\t\torigText: '',\r\n\t\t\t\t\t\tstatus: null,\r\n\t\t\t\t\t\tchangedText: ''\r\n\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t\tcase SET_ARTICLE: {\r\n\t\t\tconst { article, key } = action;\r\n\r\n\t\t\tconst currentID = state.currentArticle.id;\r\n\r\n\t\t\tlet id = key;\r\n\r\n\t\t\tif (typeof id === 'undefined') {\r\n\r\n\t\t\t\tid = (state.articles.length - currentID === 1) ? 0 : currentID + 1;\r\n\t\t\t}\r\n\r\n\t\t\tconst title = typeof article === 'undefined' ? state.articles[id] : article;\r\n\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tcurrentArticle: {\r\n\t\t\t\t\t...state.currentArticle,\r\n\t\t\t\t\tname: title,\r\n\t\t\t\t\tid: id\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t\tcase SET_ARTICLE_DATA: {\r\n\t\t\tconst { payload: {\r\n\t\t\t\torigText, status, changedText\r\n\t\t\t} } = action;\r\n\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tcurrentArticle: {\r\n\t\t\t\t\t...state.currentArticle,\r\n\t\t\t\t\tparams: {\r\n\t\t\t\t\t\torigText,\r\n\t\t\t\t\t\tstatus,\r\n\t\t\t\t\t\tchangedText\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t}\r\n\t\tcase REMOVE_FROM_LIST: {\r\n\t\t\tconst { article: articleToRemove } = action;\r\n\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tarticles: state.articles.filter(article => article !== articleToRemove)\r\n\t\t\t};\r\n\t\t}\r\n\t\tcase SET_ARTICLE_LIST_LOADING: {\r\n\t\t\tconst { payload: newStatus } = action;\r\n\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tarticlesLoading: newStatus\r\n\t\t\t};\r\n\t\t}\r\n\t\tcase SET_ARTICLE_LOADING: {\r\n\t\t\tconst { payload: newStatus } = action;\r\n\r\n\t\t\treturn {\r\n\t\t\t\t...state,\r\n\t\t\t\tarticleLoading: newStatus\r\n\t\t\t};\r\n\t\t}\r\n\t\tdefault:\r\n\t\t\treturn state;\r\n\t}\r\n};\r\n\r\nexport default tasks;","import { combineReducers } from 'redux';\r\nimport app from './app';\r\n//import articles from './articles';\r\nimport auth from './auth';\r\nimport tasks from './tasks';\r\n\r\nexport default combineReducers({\r\n\tapp,\r\n\t//articles,\r\n\tauth,\r\n\ttasks\r\n})","import { createStore, applyMiddleware } from 'redux';\r\nimport thunkMiddleware from 'redux-thunk';\r\nimport { createLogger } from 'redux-logger';\r\nimport rootReducer from './reducers';\r\n\r\nconst loggerMiddleware = createLogger()\r\n\r\nconst store = createStore(rootReducer, {}, applyMiddleware(thunkMiddleware, loggerMiddleware));\r\n\r\nexport default store;","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport AppContainer from './containers/App';\r\n\r\nimport { Provider } from 'react-redux';\r\nimport store from './store';\r\n\r\nimport '@fortawesome/fontawesome-free/css/fontawesome.min.css';\r\nimport '@fortawesome/fontawesome-free/css/solid.css';\r\nimport '@fortawesome/fontawesome-free/css/brands.css';\r\n\r\nconst rootElement = document.getElementById('root')\r\n\r\nReactDOM.render(\r\n  <Provider store={store}>\r\n    <AppContainer />\r\n  </Provider>,\r\n  rootElement\r\n)"],"sourceRoot":""}